<html><!-- Mirrored from developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Using_AudioWorklet by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Feb 2023 04:49:13 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="../../../../../favicon-48x48.cbbd161b.png"><link rel="apple-touch-icon" href="../../../../../apple-touch-icon.6803c6f0.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="../../../../../manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="https://developer.mozilla.org/opensearch.xml" title="MDN Web Docs"><title>Background audio processing using AudioWorklet</title><link rel="alternate" title="AudioWorklet을 사용하는 백그라운드 오디오 프로세싱" href="https://developer.mozilla.org/ko/docs/Web/API/Web_Audio_API/Using_AudioWorklet" hreflang="ko"><link rel="alternate" title="Background audio processing using AudioWorklet" href="Using_AudioWorklet.html" hreflang="en"><meta name="robots" content="index, follow"><meta name="description" content="This article explains how to create an audio worklet processor and use it in a Web Audio application."><meta property="og:url" content="Using_AudioWorklet.html"><meta property="og:title" content="Background audio processing using AudioWorklet - Web APIs | MDN"><meta property="og:locale" content="en-US"><meta property="og:description" content="This article explains how to create an audio worklet processor and use it in a Web Audio application."><meta property="og:image" content="../../../../../mdn-social-share.cd6c4a5a.png"><meta property="twitter:card" content="summary_large_image"><link rel="canonical" href="Using_AudioWorklet.html"><style media="print">.article-actions-container,.document-toc-container,.language-menu,.main-menu-toggle,.mdn-cta-container,.on-github,.page-footer,.sidebar,.top-navigation-main,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><script src="../../../../../static/js/ga.js" defer=""></script><script defer="defer" src="../../../../../static/js/main.5c9d40d0.js"></script><link href="../../../../../static/css/main.7d378400.css" rel="stylesheet"></head><body><script>document.body.addEventListener("load",(t=>{t.target.classList.contains("interactive")&&t.target.setAttribute("data-readystate","complete")}),{capture:!0});const c={light:"#ffffff",dark:"#1b1b1b"};if(window&&document.documentElement)try{const t=window.localStorage.getItem("theme");t&&(document.documentElement.className=t,document.documentElement.style.backgroundColor=c[t])}catch(t){console.warn("Unable to read theme from localStorage",t)}</script><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#top-nav-search-input">Skip to search</a></li><li><a id="skip-select-language" href="#languages-switcher-button">Skip to select language</a></li></ul><div class="page-wrapper  category-api document-page"><div class="main-document-header-container"><header class="main-document-header-container top-navigation 
      
      "><div class="container "><div class="top-navigation-wrap"><a href="https://developer.mozilla.org/en-US/" class="logo" aria-label="MDN homepage"><svg id="mdn-docs-logo" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 694.9 104.4" style="enable-background:new 0 0 694.9 104.4" xml:space="preserve" role="img"><title>MDN Web Docs</title><style>.logo-m{fill:var(--text-link)}</style><g class="logo-m"><path d="M40.3 0 11.7 92.1H0L28.5 0h11.8zM50.7 0v92.1H40.3V0h10.4zM91 0 62.5 92.1H50.8L79.3 0H91zM101.4 0v92.1H91V0h10.4z"></path></g><path class="logo-m" d="M627.9 95.6h67v8.8h-67v-8.8z"></path><g style="fill:var(--text-primary)"><path d="M367 42h-4l-10.7 30.8h-5.5l-10.8-26h-.4l-10.5 26h-5.2L308.7 42h-3.8v-5.6H323V42h-6.5l6.8 20.4h.4l10.3-26h4.7l11.2 26h.5l5.7-20.3h-6.2v-5.6H367V42zM401.9 62c-.4 3.2-2 5.9-4.7 8.2-2.8 2.3-6.5 3.4-11.3 3.4-5.4 0-9.7-1.6-13.1-4.7-3.3-3.2-5-7.7-5-13.7 0-5.7 1.6-10.3 4.7-14s7.4-5.5 12.9-5.5c5.1 0 9.1 1.6 11.9 4.7s4.3 6.9 4.3 11.3c0 1.5-.2 3-.5 4.7h-25.6c.3 7.7 4 11.6 10.9 11.6 2.9 0 5.1-.7 6.5-2 1.5-1.4 2.5-3 3-4.9l6 .9zM394 51.3c.2-2.4-.4-4.7-1.8-6.9s-3.8-3.3-7-3.3c-3.1 0-5.3 1-6.9 3-1.5 2-2.5 4.4-2.8 7.2H394zM445 53.7c0 5-1.3 9.5-4 13.7s-6.9 6.2-12.7 6.2c-6 0-10.3-2.2-12.7-6.7-.1.4-.2 1.4-.4 2.9s-.3 2.5-.4 2.9h-7.3c.3-1.7.6-3.5.8-5.3.3-1.8.4-3.7.4-5.5V22.3h-6v-5.6H416v27c1.1-2.2 2.7-4.1 4.7-5.7 2-1.6 4.8-2.4 8.4-2.4 4.6 0 8.4 1.6 11.4 4.7 3 3.2 4.5 7.6 4.5 13.4zm-7.7.6c0-4.2-1-7.4-3-9.5-2-2.2-4.4-3.3-7.4-3.3-3.4 0-6 1.2-8 3.7-1.9 2.4-2.9 5-3 7.7V57c0 3 1 5.6 3 7.7s4.5 3.1 7.6 3.1c3.6 0 6.3-1.3 8.1-3.9 1.8-2.7 2.7-5.9 2.7-9.6zM506.5 72.8h-13.2v-7.2c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2 5.7 0 9.8 2.2 12.3 6.5V22.3h-8.6v-5.6h15.8v50.6h6v5.5zM493.2 56v-4.4c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zM546.3 54.6c0 5.6-1.8 10.2-5.3 13.7s-8.2 5.3-13.9 5.3-10.1-1.7-13.4-5.1c-3.3-3.4-5-7.9-5-13.5 0-5.3 1.6-9.9 4.7-13.7 3.2-3.8 7.9-5.7 14.2-5.7s11 1.9 14.1 5.7c3 3.7 4.6 8.1 4.6 13.3zm-7.7-.2c0-4-1-7.2-3-9.5s-4.8-3.5-8.2-3.5c-3.6 0-6.4 1.2-8.3 3.7s-2.9 5.6-2.9 9.5c0 3.7.9 6.8 2.8 9.4 1.9 2.6 4.6 3.9 8.3 3.9 3.6 0 6.4-1.3 8.4-3.8 1.9-2.6 2.9-5.8 2.9-9.7zM583.6 60.2c-.4 3.2-1.9 6.3-4.4 9.1-2.5 2.9-6.4 4.3-11.8 4.3-5.2 0-9.4-1.6-12.6-4.8-3.2-3.2-4.8-7.7-4.8-13.7 0-5.5 1.6-10.1 4.7-13.9 3.2-3.8 7.6-5.7 13.2-5.7 2.3 0 4.6.3 6.7.8 2.2.5 4.2 1.5 6.2 2.9l1.5 9.5-5.9.7-1.3-6.1c-2.1-1.2-4.5-1.8-7.2-1.8-3.5 0-6.1 1.2-7.7 3.7-1.7 2.5-2.5 5.7-2.5 9.6 0 4.1.9 7.3 2.7 9.5 1.8 2.3 4.4 3.4 7.8 3.4 5.2 0 8.2-2.9 9.2-8.8l6.2 1.3zM618.3 62.1c0 3.6-1.5 6.5-4.6 8.5s-7 3-11.7 3c-5.7 0-10.6-1.2-14.6-3.6l1.2-8.8 5.7.6-.2 4.7c1.1.5 2.3.9 3.6 1.1s2.6.3 3.9.3c2.4 0 4.5-.4 6.5-1.3 1.9-.9 2.9-2.2 2.9-4.1 0-1.8-.8-3.1-2.3-3.8s-3.5-1.3-5.8-1.7-4.6-.9-6.9-1.4c-2.3-.6-4.2-1.6-5.7-2.9-1.6-1.4-2.3-3.5-2.3-6.3 0-4.1 1.5-6.9 4.6-8.5s6.4-2.4 9.9-2.4c2.6 0 5 .3 7.2.9 2.2.6 4.3 1.4 6.1 2.4l.8 8.8-5.8.7-.8-5.7c-2.3-1-4.7-1.6-7.2-1.6-2.1 0-3.7.4-5.1 1.1-1.3.8-2 2-2 3.8 0 1.7.8 2.9 2.3 3.6 1.5.7 3.4 1.2 5.7 1.6 2.2.4 4.5.8 6.7 1.4 2.2.6 4.1 1.6 5.7 3 1.4 1.6 2.2 3.7 2.2 6.6zM197.6 73.2h-17.1v-5.5h3.8V51.9c0-3.7-.7-6.3-2.1-7.9-1.4-1.6-3.3-2.3-5.7-2.3-3.2 0-5.6 1.1-7.2 3.4s-2.4 4.6-2.5 6.9v15.6h6v5.5h-17.1v-5.5h3.8V51.9c0-3.8-.7-6.4-2.1-7.9-1.4-1.5-3.3-2.3-5.6-2.3-3.2 0-5.5 1.1-7.2 3.3-1.6 2.2-2.4 4.5-2.5 6.9v15.8h6.9v5.5h-20.2v-5.5h6V42.4h-6.1v-5.6h13.4v6.4c1.2-2.1 2.7-3.8 4.7-5.2 2-1.3 4.4-2 7.3-2s5.3.7 7.5 2.1c2.2 1.4 3.7 3.5 4.5 6.4 1.1-2.5 2.7-4.5 4.9-6.1s4.8-2.4 7.9-2.4c3.5 0 6.5 1.1 8.9 3.3s3.7 5.6 3.7 10.2v18.2h6.1v5.5zm42.5 0h-13.2V66c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2s9.8 2.2 12.3 6.5V22.7h-8.6v-5.6h15.8v50.6h6v5.5zm-13.3-16.8V52c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zm61.5 16.8H269v-5.5h6V51.9c0-3.7-.7-6.3-2.2-7.9-1.4-1.6-3.4-2.3-5.7-2.3-3.1 0-5.6 1-7.4 3s-2.8 4.4-2.9 7v15.9h6v5.5h-19.3v-5.5h6V42.4h-6.2v-5.6h13.6V43c2.6-4.6 6.8-6.9 12.7-6.9 3.6 0 6.7 1.1 9.2 3.3s3.7 5.6 3.7 10.2v18.2h6v5.4h-.2z"></path></g></svg></a><button title="Open main menu" type="button" class="button action has-icon main-menu-toggle" aria-haspopup="menu" aria-label="Open main menu" aria-expanded="false"><span class="button-wrap"><span class="icon icon-menu "></span><span class="visually-hidden">Open main menu</span></span></button></div><div class="top-navigation-main"><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button type="button" id="references-button" class="top-level-entry menu-toggle" aria-controls="references-menu" aria-expanded="false">References</button><a href="https://developer.mozilla.org/en-US/docs/Web" class="top-level-entry">References</a><ul id="references-menu" class="submenu references hidden inline-submenu-lg" aria-labelledby="references-button"><li class="apis-link-container mobile-only "><a href="https://developer.mozilla.org/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li><li class="html-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Structure of content on the web</p></div></a></li><li class="css-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Code used to describe document style</p></div></a></li><li class="javascript-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">General-purpose scripting language</p></div></a></li><li class="http-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP" class="submenu-item "><div class="submenu-icon http"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTTP</div><p class="submenu-item-description">Protocol for transmitting web resources</p></div></a></li><li class="apis-link-container "><a href="../../API.html" class="submenu-item "><div class="submenu-icon apis"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web APIs</div><p class="submenu-item-description">Interfaces for building web applications</p></div></a></li><li class="apis-link-container "><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Extensions</div><p class="submenu-item-description">Developing extensions for web browsers</p></div></a></li><li class="apis-link-container desktop-only "><a href="https://developer.mozilla.org/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li></ul></li><li class="top-level-entry-container"><button type="button" id="guides-button" class="top-level-entry menu-toggle" aria-controls="guides-menu" aria-expanded="false">Guides</button><a href="https://developer.mozilla.org/en-US/docs/Learn" class="top-level-entry">Guides</a><ul id="guides-menu" class="submenu guides hidden inline-submenu-lg" aria-labelledby="guides-button"><li class="apis-link-container mobile-only "><a href="https://developer.mozilla.org/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="apis-link-container desktop-only "><a href="https://developer.mozilla.org/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="html-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Learn to structure web content with HTML</p></div></a></li><li class="css-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Learn to style content using CSS</p></div></a></li><li class="javascript-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">Learn to run scripts in the browser</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Accessibility</div><p class="submenu-item-description">Learn to make the web accessible to all</p></div></a></li></ul></li><li class="top-level-entry-container"><button type="button" id="mdn-plus-button" class="top-level-entry menu-toggle" aria-controls="mdn-plus-menu" aria-expanded="false">MDN Plus</button><a href="https://developer.mozilla.org/en-US/plus" class="top-level-entry">MDN Plus</a><ul id="mdn-plus-menu" class="submenu mdn-plus hidden inline-submenu-lg" aria-labelledby="mdn-plus-button"><li class=" "><a href="https://developer.mozilla.org/en-US/plus" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview</div><p class="submenu-item-description">A customized MDN experience</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/updates" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Updates</div><p class="submenu-item-description">All browser compatibility updates at a glance</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/docs/features/overview" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Documentation</div><p class="submenu-item-description">Learn how to use MDN Plus</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/docs/faq" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">FAQ</div><p class="submenu-item-description">Frequently asked questions about MDN Plus</p></div></a></li></ul></li></ul></nav><div class="header-search"><form action="https://developer.mozilla.org/en-US/search" role="search" aria-haspopup="listbox" aria-owns="top-nav-search-menu" aria-expanded="false" class="search-form search-widget" id="top-nav-search-form"><label id="top-nav-search-label" for="top-nav-search-input" class="visually-hidden">Search MDN</label><input id="top-nav-search-input" aria-autocomplete="list" aria-controls="top-nav-search-menu" aria-labelledby="top-nav-search-label" autocomplete="off" type="search" class="search-input-field" name="q" placeholder="   " required="" value=""><button type="button" class="button action has-icon clear-search-button"><span class="button-wrap"><span class="icon icon-cancel "></span><span class="visually-hidden">Clear search input</span></span></button><button type="submit" class="button action has-icon search-button"><span class="button-wrap"><span class="icon icon-search "></span><span class="visually-hidden">Search</span></span></button><div id="top-nav-search-menu" role="listbox" aria-labelledby="top-nav-search-label"></div></form></div><div class="theme-switcher-menu"><button type="button" class="button action has-icon theme-switcher-menu small" aria-haspopup="menu"><span class="button-wrap"><span class="icon icon-theme-os-default "></span>Theme</span></button></div><ul class="auth-container"><li><a href="https://developer.mozilla.org/users/fxa/login/authenticate/?next=%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWeb_Audio_API%2FUsing_AudioWorklet" class="signin-link" rel="nofollow">Already a subscriber?</a></li><li><a class="button primary mdn-plus-subscribe-link" href="https://developer.mozilla.org/en-US/plus"><span class="button-wrap">Get MDN Plus</span></a></li></ul></div></div></header><div class="article-actions-container"><div class="container"><button type="button" class="button action has-icon sidebar-button" aria-label="Expand sidebar" aria-expanded="false" aria-controls="sidebar-quicklinks"><span class="button-wrap"><span class="icon icon-sidebar "></span></span></button><nav class="breadcrumbs-container" aria-label="Breadcrumb"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="https://developer.mozilla.org/en-US/docs/Web"><span property="name">References</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="../../API.html"><span property="name">Web APIs</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="../Web_Audio_API.html"><span property="name">Web Audio API</span></a><meta property="position" content="3"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="Using_AudioWorklet.html"><span property="name">Background audio processing using AudioWorklet</span></a><meta property="position" content="4"></li></ol></nav><div class="article-actions"><button type="button" class="button action has-icon article-actions-toggle" aria-label="Article actions"><span class="button-wrap"><span class="icon icon-ellipses "></span><span class="article-actions-dialog-heading">Article Actions</span></span></button><ul class="article-actions-entries"><li class="article-actions-entry"><div class="languages-switcher-menu open-on-focus-within"><button id="languages-switcher-button" type="button" class="button action small has-icon languages-switcher-menu" aria-haspopup="menu"><span class="button-wrap"><span class="icon icon-language "></span>English (US)</span></button></div></li></ul></div></div></div></div><div class="main-wrapper"><aside id="sidebar-quicklinks" class="sidebar"><button type="button" class="button action backdrop" aria-label="Collapse sidebar"><span class="button-wrap"></span></button><nav aria-label="Related Topics" class="sidebar-inner"><div class="in-nav-toc"><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#high_level_overview">High level overview</a></li><li class="document-toc-item "><a class="document-toc-link" href="#creating_an_audio_worklet_processor">Creating an audio worklet processor</a></li><li class="document-toc-item "><a class="document-toc-link" href="#lifetime_of_an_audio_worklet_processor">Lifetime of an audio worklet processor</a></li><li class="document-toc-item "><a class="document-toc-link" href="#creating_an_audio_processor_worklet_node">Creating an audio processor worklet node</a></li><li class="document-toc-item "><a class="document-toc-link" href="#supporting_audio_parameters">Supporting audio parameters</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></div><div><ol><li><strong><a href="../Web_Audio_API.html">Web Audio API</a></strong></li><li class="toggle"><details open=""><summary>Guides</summary><ol><li><a href="Using_Web_Audio_API.html">Using the Web Audio API</a></li><li><a href="Basic_concepts_behind_Web_Audio_API.html">Basic concepts behind Web Audio API</a></li><li><a href="Best_practices.html">Web Audio API best practices</a></li><li><a href="Advanced_techniques.html">Advanced techniques: Creating and sequencing audio</a></li><li><em><a href="Using_AudioWorklet.html" aria-current="page">Background audio processing using AudioWorklet</a></em></li><li><a href="Controlling_multiple_parameters_with_ConstantSourceNode.html">Controlling multiple parameters with ConstantSourceNode</a></li><li><a href="Migrating_from_webkitAudioContext.html">Migrating from webkitAudioContext</a></li><li><a href="Simple_synth.html">Example and tutorial: Simple synth keyboard</a></li><li><a href="Tools.html">Tools for analyzing Web Audio usage</a></li><li><a href="Using_IIR_filters.html">Using IIR filters</a></li><li><a href="Visualizations_with_Web_Audio_API.html">Visualizations with Web Audio API</a></li><li><a href="Web_audio_spatialization_basics.html">Web audio spatialization basics</a></li></ol></details></li><li class="toggle"><details open=""><summary>Interfaces</summary><ol><li><a href="../AnalyserNode.html"><code>AnalyserNode</code></a></li><li><a href="../AudioBuffer.html"><code>AudioBuffer</code></a></li><li><a href="../AudioBufferSourceNode.html"><code>AudioBufferSourceNode</code></a></li><li><a href="../AudioContext.html"><code>AudioContext</code></a></li><li><a href="../AudioDestinationNode.html"><code>AudioDestinationNode</code></a></li><li><a href="../AudioListener.html"><code>AudioListener</code></a></li><li><a href="../AudioNode.html"><code>AudioNode</code></a></li><li><a href="../AudioParam.html"><code>AudioParam</code></a></li><li><a href="../AudioProcessingEvent.html"><code>AudioProcessingEvent</code></a></li><li><a href="../AudioScheduledSourceNode.html"><code>AudioScheduledSourceNode</code></a></li><li><a href="../AudioSinkInfo.html"><code>AudioSinkInfo</code></a></li><li><a href="../AudioWorklet.html"><code>AudioWorklet</code></a></li><li><a href="../AudioWorkletGlobalScope.html"><code>AudioWorkletGlobalScope</code></a></li><li><a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a></li><li><a href="../AudioWorkletProcessor.html"><code>AudioWorkletProcessor</code></a></li><li><a href="../BaseAudioContext.html"><code>BaseAudioContext</code></a></li><li><a href="../BiquadFilterNode.html"><code>BiquadFilterNode</code></a></li><li><a href="../ChannelMergerNode.html"><code>ChannelMergerNode</code></a></li><li><a href="../ChannelSplitterNode.html"><code>ChannelSplitterNode</code></a></li><li><a href="../ConstantSourceNode.html"><code>ConstantSourceNode</code></a></li><li><a href="../ConvolverNode.html"><code>ConvolverNode</code></a></li><li><a href="../DelayNode.html"><code>DelayNode</code></a></li><li><a href="../DynamicsCompressorNode.html"><code>DynamicsCompressorNode</code></a></li><li><a href="../GainNode.html"><code>GainNode</code></a></li><li><a href="../IIRFilterNode.html"><code>IIRFilterNode</code></a></li><li><a href="../MediaElementAudioSourceNode.html"><code>MediaElementAudioSourceNode</code></a></li><li><a href="../MediaStreamAudioDestinationNode.html"><code>MediaStreamAudioDestinationNode</code></a></li><li><a href="../MediaStreamAudioSourceNode.html"><code>MediaStreamAudioSourceNode</code></a></li><li><a href="../OfflineAudioCompletionEvent.html"><code>OfflineAudioCompletionEvent</code></a></li><li><a href="../OfflineAudioContext.html"><code>OfflineAudioContext</code></a></li><li><a href="../OscillatorNode.html"><code>OscillatorNode</code></a></li><li><a href="../PannerNode.html"><code>PannerNode</code></a></li><li><a href="../PeriodicWave.html"><code>PeriodicWave</code></a></li><li><a href="../WaveShaperNode.html"><code>WaveShaperNode</code></a></li><li><a href="../StereoPannerNode.html"><code>StereoPannerNode</code></a></li></ol></details></li></ol></div></nav></aside><aside class="toc"><nav><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#high_level_overview">High level overview</a></li><li class="document-toc-item "><a class="document-toc-link" href="#creating_an_audio_worklet_processor">Creating an audio worklet processor</a></li><li class="document-toc-item "><a class="document-toc-link" href="#lifetime_of_an_audio_worklet_processor">Lifetime of an audio worklet processor</a></li><li class="document-toc-item "><a class="document-toc-link" href="#creating_an_audio_processor_worklet_node">Creating an audio processor worklet node</a></li><li class="document-toc-item "><a class="document-toc-link" href="#supporting_audio_parameters">Supporting audio parameters</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></nav></aside><main id="content" class="main-content  "><article class="main-page-content" lang="en-US"><h1>Background audio processing using AudioWorklet</h1><div class="section-content"><p>This article explains how to create an audio worklet processor and use it in a Web Audio application.</p>
<p>When the Web Audio API was first introduced to browsers, it included the ability to use JavaScript code to create custom audio processors that would be invoked to perform real-time audio manipulations. The drawback to <code>ScriptProcessorNode</code> was that it ran on the main thread, thus blocking everything else going on until it completed execution. This was far less than ideal, especially for something that can be as computationally expensive as audio processing.</p>
<p>Enter <a href="../AudioWorklet.html"><code>AudioWorklet</code></a>. An audio context's audio worklet is a <a href="../Worklet.html"><code>Worklet</code></a> which runs off the main thread, executing audio processing code added to it by calling the context's <a href="../Worklet/addModule.html" title="audioWorklet.addModule()"><code>audioWorklet.addModule()</code></a> method. Calling <code>addModule()</code> loads the specified JavaScript file, which should contain the implementation of the audio processor. With the processor registered, you can create a new <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a> which passes the audio through the processor's code when the node is linked into the chain of audio nodes along with any other audio nodes.</p>
<p>It's worth noting that because audio processing can often involve substantial computation, your processor may benefit greatly from being built using <a href="https://developer.mozilla.org/en-US/docs/WebAssembly">WebAssembly</a>, which brings near-native or fully native performance to web apps. Implementing your audio processing algorithm using WebAssembly can make it perform markedly better.</p></div><section aria-labelledby="high_level_overview"><a class="dashAnchor" name="//apple_ref/Section/High%20level%20overview"></a><h2 id="high_level_overview"><a href="#high_level_overview">High level overview</a></h2><div class="section-content"><p>Before we start looking at the use of AudioWorklet on a step-by-step basis, let's start with a brief high-level overview of what's involved.</p>
<ol>
  <li>Create module that defines an audio worklet processor class, based on <a href="../AudioWorkletProcessor.html"><code>AudioWorkletProcessor</code></a> which takes audio from one or more incoming sources, performs its operation on the data, and outputs the resulting audio data.</li>
  <li>Access the audio context's <a href="../AudioWorklet.html"><code>AudioWorklet</code></a> through its <a href="../BaseAudioContext/audioWorklet.html" title="audioWorklet"><code>audioWorklet</code></a> property, and call the audio worklet's <a href="../Worklet/addModule.html" title="addModule()"><code>addModule()</code></a> method to install the audio worklet processor module.</li>
  <li>As needed, create audio processing nodes by passing the processor's name (which is defined by the module) to the <a href="../AudioWorkletNode/AudioWorkletNode.html" title="AudioWorkletNode()"><code>AudioWorkletNode()</code></a> constructor.</li>
  <li>Set up any audio parameters the <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a> needs, or that you wish to configure. These are defined in the audio worklet processor module.</li>
  <li>Connect the created <code>AudioWorkletNode</code>s into your audio processing pipeline as you would any other node, then use your audio pipeline as usual.</li>
</ol>
<p>Throughout the remainder of this article, we'll look at these steps in more detail, with examples (including working examples you can try out on your own).</p>
<p>The example code found on this page is derived from <a href="../../../../../../mdn.github.io/webaudio-examples/audioworklet/index.html" class="external" target="_blank">this working example</a> which is part of MDN's <a href="https://github.com/mdn/webaudio-examples/" class="external" target="_blank">GitHub repository of Web Audio examples</a>. The example creates an oscillator node and adds white noise to it using an <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a> before playing the resulting sound out. Slider controls are available to allow controlling the gain of both the oscillator and the audio worklet's output.</p>
<p><a href="https://github.com/mdn/webaudio-examples/tree/master/audioworklet" class="external" target="_blank"><strong>See the code</strong></a></p>
<p><a href="../../../../../../mdn.github.io/webaudio-examples/audioworklet/index.html" class="external" target="_blank"><strong>Try it live</strong></a></p></div></section><section aria-labelledby="creating_an_audio_worklet_processor"><a class="dashAnchor" name="//apple_ref/Section/Creating%20an%20audio%20worklet%20processor"></a><h2 id="creating_an_audio_worklet_processor"><a href="#creating_an_audio_worklet_processor">Creating an audio worklet processor</a></h2><div class="section-content"><p>Fundamentally, an audio worklet processor (which we'll refer to usually as either an "audio processor" or as a "processor" because otherwise this article will be about twice as long) is implemented using a JavaScript module that defines and installs the custom audio processor class.</p></div></section><section aria-labelledby="structure_of_an_audio_worklet_processor"><h3 id="structure_of_an_audio_worklet_processor"><a href="#structure_of_an_audio_worklet_processor">Structure of an audio worklet processor</a></h3><div class="section-content"><p>An audio worklet processor is a JavaScript module which consists of the following:</p>
<ul>
  <li>A JavaScript class which defines the audio processor. This class extends the <a href="../AudioWorkletProcessor.html"><code>AudioWorkletProcessor</code></a> class.</li>
  <li>The audio processor class must implement a <a href="../AudioWorkletProcessor/process.html" title="process()"><code>process()</code></a> method, which receives incoming audio data and writes back out the data as manipulated by the processor.</li>
  <li>The module installs the new audio worklet processor class by calling <a href="../AudioWorkletGlobalScope/registerProcessor.html" title="registerProcessor()"><code>registerProcessor()</code></a>, specifying a name for the audio processor and the class that defines the processor.</li>
</ul>
<p>A single audio worklet processor module may define multiple processor classes, registering each of them with individual calls to <code>registerProcessor()</code>. As long as each has its own unique name, this will work just fine. It's also more efficient than loading multiple modules from over the network or even the user's local disk.</p></div></section><section aria-labelledby="basic_code_framework"><h3 id="basic_code_framework"><a href="#basic_code_framework">Basic code framework</a></h3><div class="section-content"><p>The barest framework of an audio processor class looks like this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">class</span> <span class="token class-name">MyAudioProcessor</span> <span class="token keyword">extends</span> <span class="token class-name">AudioWorkletProcessor</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">inputList<span class="token punctuation">,</span> outputList<span class="token punctuation">,</span> parameters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Using the inputs (or not, as needed),</span>
    <span class="token comment">// write the output into each of the outputs</span>
    <span class="token comment">// …</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">registerProcessor</span><span class="token punctuation">(</span><span class="token string">"my-audio-processor"</span><span class="token punctuation">,</span> MyAudioProcessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>After the implementation of the processor comes a call to the global function <a href="../AudioWorkletGlobalScope/registerProcessor.html" title="registerProcessor()"><code>registerProcessor()</code></a>, which is only available within the scope of the audio context's <a href="../AudioWorklet.html"><code>AudioWorklet</code></a>, which is the invoker of the processor script as a result of your call to <a href="../Worklet/addModule.html" title="audioWorklet.addModule()"><code>audioWorklet.addModule()</code></a>. This call to <code>registerProcessor()</code> registers your class as the basis for any <a href="../AudioWorkletProcessor.html"><code>AudioWorkletProcessor</code></a>s created when <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a>s are set up.</p>
<p>This is the barest framework and actually has no effect until code is added into <code>process()</code> to do something with those inputs and outputs. Which brings us to talking about those inputs and outputs.</p></div></section><section aria-labelledby="the_input_and_output_lists"><h3 id="the_input_and_output_lists"><a href="#the_input_and_output_lists">The input and output lists</a></h3><div class="section-content"><p>The lists of inputs and outputs can be a little confusing at first, even though they're actually very simple once you realize what's going on.</p>
<p>Let's start at the inside and work our way out. Fundamentally, the audio for a single audio channel (such as the left speaker or the subwoofer, for example) is represented as a <a href="../../JavaScript/Reference/Global_Objects/Float32Array.html"><code>Float32Array</code></a> whose values are the individual audio samples. By specification, each block of audio your <code>process()</code> function receives contains 128 frames (that is, 128 samples for each channel), but it is planned that <em>this value will change in the future</em>, and may in fact vary depending on circumstances, so you should <em>always</em> check the array's <a href="../../JavaScript/Reference/Global_Objects/TypedArray/length.html"><code>length</code></a> rather than assuming a particular size. It is, however, guaranteed that the inputs and outputs will have the same block length.</p>
<p>Each input can have a number of channels. A mono input has a single channel; stereo input has two channels. Surround sound might have six or more channels. So each input is, in turn, an array of channels. That is, an array of <code>Float32Array</code> objects.</p>
<p>Then, there can be multiple inputs, so the <code>inputList</code> is an array of arrays of <code>Float32Array</code> objects. Each input may have a different number of channels, and each channel has its own array of samples.</p>
<p>Thus, given the input list <code>inputList</code>:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> numberOfInputs <span class="token operator">=</span> inputList<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">const</span> firstInput <span class="token operator">=</span> inputList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> firstInputChannelCount <span class="token operator">=</span> firstInput<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">const</span> firstInputFirstChannel <span class="token operator">=</span> firstInput<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// (or inputList[0][0])</span>

<span class="token keyword">const</span> firstChannelByteCount <span class="token operator">=</span> firstInputFirstChannel<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">const</span> firstByteOfFirstChannel <span class="token operator">=</span> firstInputFirstChannel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// (or inputList[0][0][0])</span>
</code></pre></div>
<p>The output list is structured in exactly the same way; it's an array of outputs, each of which is an array of channels, each of which is an array of <code>Float32Array</code> objects, which contain the samples for that channel.</p>
<p>How you use the inputs and how you generate the outputs depends very much on your processor. If your processor is just a generator, it can ignore the inputs and just replace the contents of the outputs with the generated data. Or you can process each input independently, applying an algorithm to the incoming data on each channel of each input and writing the results into the corresponding outputs' channels (keeping in mind that the number of inputs and outputs may differ, and the channel counts on those inputs and outputs may also differ). Or you can take all the inputs and perform mixing or other computations that result in a single output being filled with data (or all the outputs being filled with the same data).</p>
<p>It's entirely up to you. This is a very powerful tool in your audio programming toolkit.</p></div></section><section aria-labelledby="processing_multiple_inputs"><h3 id="processing_multiple_inputs"><a href="#processing_multiple_inputs">Processing multiple inputs</a></h3><div class="section-content"><p>Let's take a look at an implementation of <code>process()</code> that can process multiple inputs, with each input being used to generate the corresponding output. Any excess inputs are ignored.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">inputList<span class="token punctuation">,</span> outputList<span class="token punctuation">,</span> parameters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sourceLimit <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>inputList<span class="token punctuation">.</span>length<span class="token punctuation">,</span> outputList<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> inputNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> inputNum <span class="token operator">&lt;</span> sourceLimit<span class="token punctuation">;</span> inputNum<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> inputList<span class="token punctuation">[</span>inputNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> output <span class="token operator">=</span> outputList<span class="token punctuation">[</span>inputNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> channelCount <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>length<span class="token punctuation">,</span> output<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> channelNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> channelNum <span class="token operator">&lt;</span> channelCount<span class="token punctuation">;</span> channelNum<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      input<span class="token punctuation">[</span>channelNum<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sample<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Manipulate the sample</span>
        output<span class="token punctuation">[</span>channelNum<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sample<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Note that when determining the number of sources to process and send through to the corresponding outputs, we use <a href="../../JavaScript/Reference/Global_Objects/Math/min.html"><code>Math.min()</code></a> to ensure that we only process as many channels as we have room for in the output list. The same check is performed when determining how many channels to process in the current input; we only process as many as there are room for in the destination output. This avoids errors due to overrunning these arrays.</p></div></section><section aria-labelledby="mixing_inputs"><h3 id="mixing_inputs"><a href="#mixing_inputs">Mixing inputs</a></h3><div class="section-content"><p>Many nodes perform <strong>mixing</strong> operations, where the inputs are combined in some way into a single output. This is demonstrated in the following example.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">inputList<span class="token punctuation">,</span> outputList<span class="token punctuation">,</span> parameters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sourceLimit <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>inputList<span class="token punctuation">.</span>length<span class="token punctuation">,</span> outputList<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> inputNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> inputNum <span class="token operator">&lt;</span> sourceLimit<span class="token punctuation">;</span> inputNum<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> input <span class="token operator">=</span> inputList<span class="token punctuation">[</span>inputNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> output <span class="token operator">=</span> outputList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> channelCount <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>length<span class="token punctuation">,</span> output<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> channelNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> channelNum <span class="token operator">&lt;</span> channelCount<span class="token punctuation">;</span> channelNum<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> input<span class="token punctuation">[</span>channelNum<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> sample <span class="token operator">=</span> output<span class="token punctuation">[</span>channelNum<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> input<span class="token punctuation">[</span>channelNum<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>sample <span class="token operator">&gt;</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          sample <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sample <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          sample <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        output<span class="token punctuation">[</span>channelNum<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sample<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This is similar code to the previous sample in many ways, but only the first output—<code>outputList[0]</code>—is altered. Each sample is added to the corresponding sample in the output buffer, with a simple code fragment in place to prevent the samples from exceeding the legal range of -1.0 to 1.0 by capping the values; there are other ways to avoid clipping that are perhaps less prone to distortion, but this is a simple example that's better than nothing.</p></div></section><section aria-labelledby="lifetime_of_an_audio_worklet_processor"><a class="dashAnchor" name="//apple_ref/Section/Lifetime%20of%20an%20audio%20worklet%20processor"></a><h2 id="lifetime_of_an_audio_worklet_processor"><a href="#lifetime_of_an_audio_worklet_processor">Lifetime of an audio worklet processor</a></h2><div class="section-content"><p>The only means by which you can influence the lifespan of your audio worklet processor is through the value returned by <code>process()</code>, which should be a Boolean value indicating whether or not to override the <a href="https://developer.mozilla.org/en-US/docs/Glossary/User_agent">user agent</a>'s decision-making as to whether or not your node is still in use.</p>
<p>In general, the lifetime policy of any audio node is simple: if the node is still considered to be actively processing audio, it will continue to be used. In the case of an <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a>, the node is considered to be active if its <code>process()</code> function returns <code>true</code> <em>and</em> the node is either generating content as a source for audio data, or is receiving data from one or more inputs.</p>
<p>Specifying a value of <code>true</code> as the result from your <code>process()</code> function in essence tells the Web Audio API that your processor needs to keep being called even if the API doesn't think there's anything left for you to do. In other words, <code>true</code> overrides the API's logic and gives you control over your processor's lifetime policy, keeping the processor's owning <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a> running even when it would otherwise decide to shut down the node.</p>
<p>Returning <code>false</code> from the <code>process()</code> method tells the API that it should follow its normal logic and shut down your processor node if it deems it appropriate to do so. If the API determines that your node is no longer needed, <code>process()</code> will not be called again.</p>
<div class="notecard note" id="sect1">
  <p><strong>Note:</strong> At this time, unfortunately, Chrome does not implement this algorithm in a manner that matches the current standard. Instead, it keeps the node alive if you return <code>true</code> and shuts it down if you return <code>false</code>. Thus for compatibility reasons you must always return <code>true</code> from <code>process()</code>, at least on Chrome. However, once <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=921354" class="external" target="_blank">this Chrome issue</a> is fixed, you will want to change this behavior if possible as it may have a slight negative impact on performance.</p>
</div></div></section><section aria-labelledby="creating_an_audio_processor_worklet_node"><a class="dashAnchor" name="//apple_ref/Section/Creating%20an%20audio%20processor%20worklet%20node"></a><h2 id="creating_an_audio_processor_worklet_node"><a href="#creating_an_audio_processor_worklet_node">Creating an audio processor worklet node</a></h2><div class="section-content"><p>To create an audio node that pumps blocks of audio data through an <a href="../AudioWorkletProcessor.html"><code>AudioWorkletProcessor</code></a>, you need to follow these simple steps:</p>
<ol>
  <li>Load and install the audio processor module</li>
  <li>Create an <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a>, specifying the audio processor module to use by its name</li>
  <li>Connect inputs to the <code>AudioWorkletNode</code> and its outputs to appropriate destinations (either other nodes or to the <a href="../AudioContext.html"><code>AudioContext</code></a> object's <a href="../BaseAudioContext/destination.html" title="destination"><code>destination</code></a> property.</li>
</ol>
<p>To use an audio worklet processor, you can use code similar to the following:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">let</span> audioContext <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createMyAudioProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>audioContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      audioContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> audioContext<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> audioContext<span class="token punctuation">.</span>audioWorklet<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span><span class="token string">"module-url/module.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AudioWorkletNode</span><span class="token punctuation">(</span>audioContext<span class="token punctuation">,</span> <span class="token string">"processor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>This <code>createMyAudioProcessor()</code> function creates and returns a new instance of <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a> configured to use your audio processor. It also handles creating the audio context if it hasn't already been done.</p>
<p>In order to ensure the context is usable, this starts by creating the context if it's not already available, then adds the module containing the processor to the worklet. Once that's done, it instantiates and returns a new <code>AudioWorkletNode</code>. Once you have that in hand, you connect it to other nodes and otherwise use it just like any other node.</p>
<p>You can then create a new audio processor node by doing this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">let</span> newProcessorNode <span class="token operator">=</span> <span class="token function">createMyAudioProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>If the returned value, <code>newProcessorNode</code>, is non-<code>null</code>, we have a valid audio context with its hiss processor node in place and ready to use.</p></div></section><section aria-labelledby="supporting_audio_parameters"><a class="dashAnchor" name="//apple_ref/Section/Supporting%20audio%20parameters"></a><h2 id="supporting_audio_parameters"><a href="#supporting_audio_parameters">Supporting audio parameters</a></h2><div class="section-content"><p>Just like any other Web Audio node, <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a> supports parameters, which are shared with the <a href="../AudioWorkletProcessor.html"><code>AudioWorkletProcessor</code></a> that does the actual work.</p></div></section><section aria-labelledby="adding_parameter_support_to_the_processor"><h3 id="adding_parameter_support_to_the_processor"><a href="#adding_parameter_support_to_the_processor">Adding parameter support to the processor</a></h3><div class="section-content"><p>To add parameters to an <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a>, you need to define them within your <a href="../AudioWorkletProcessor.html"><code>AudioWorkletProcessor</code></a>-based processor class in your module. This is done by adding the static getter <a href="../AudioWorkletProcessor/parameterDescriptors.html" title="parameterDescriptors"><code>parameterDescriptors</code></a> to your class. This function should return an array of <a href="../AudioParam.html"><code>AudioParam</code></a> objects, one for each parameter supported by the processor.</p>
<p>In the following implementation of <code>parameterDescriptors()</code>, the returned array has two <code>AudioParam</code> objects. The first defines <code>gain</code> as a value between 0 and 1, with a default value of 0.5. The second parameter is named <code>frequency</code> and defaults to 440.0, with a range from 27.5 to 4186.009, inclusively.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">parameterDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"gain"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minValue</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxValue</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"frequency"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> <span class="token number">440.0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minValue</span><span class="token operator">:</span> <span class="token number">27.5</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxValue</span><span class="token operator">:</span> <span class="token number">4186.009</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Accessing your processor node's parameters is as simple as looking them up in the <code>parameters</code> object passed into your implementation of <a href="../AudioWorkletProcessor/process.html" title="process()"><code>process()</code></a>. Within the <code>parameters</code> object are arrays, one for each of your parameters, and sharing the same names as your parameters.</p>
<dl>
  <dt id="a-rate_parameters">A-rate parameters</dt>
  <dd>
    <p>For a-rate parameters—parameters whose values automatically change over time—the parameter's entry in the <code>parameters</code> object is an array of <a href="../AudioParam.html"><code>AudioParam</code></a> objects, one for each frame in the block being processed. These values are to be applied to the corresponding frames.</p>
  </dd>
  <dt id="k-rate_parameters">K-rate parameters</dt>
  <dd>
    <p>K-rate parameters, on the other hand, can only change once per block, so the parameter's array has only a single entry. Use that value for every frame in the block.</p>
  </dd>
</dl>
<p>In the code below, we see a <code>process()</code> function that handles a <code>gain</code> parameter which can be used as either an a-rate or k-rate parameter. Our node only supports one input, so it just takes the first input in the list, applies the gain to it, and writes the resulting data to the first output's buffer.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">inputList<span class="token punctuation">,</span> outputList<span class="token punctuation">,</span> parameters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> inputList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> output <span class="token operator">=</span> outputList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> gain <span class="token operator">=</span> parameters<span class="token punctuation">.</span>gain<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> channelNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> channelNum <span class="token operator">&lt;</span> input<span class="token punctuation">.</span>length<span class="token punctuation">;</span> channel<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> inputChannel <span class="token operator">=</span> input<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> outputChannel <span class="token operator">=</span> output<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// If gain.length is 1, it's a k-rate parameter, so apply</span>
    <span class="token comment">// the first entry to every frame. Otherwise, apply each</span>
    <span class="token comment">// entry to the corresponding frame.</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>gain<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> inputChannel<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputChannel<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> inputChannel<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> gain<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> inputChannel<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputChannel<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> inputChannel<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> gain<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Here, if <code>gain.length</code> indicates that there's only a single value in the <code>gain</code> parameter's array of values, the first entry in the array is applied to every frame in the block. Otherwise, for each frame in the block, the corresponding entry in <code>gain[]</code> is applied.</p></div></section><section aria-labelledby="accessing_parameters_from_the_main_thread_script"><h3 id="accessing_parameters_from_the_main_thread_script"><a href="#accessing_parameters_from_the_main_thread_script">Accessing parameters from the main thread script</a></h3><div class="section-content"><p>Your main thread script can access the parameters just like it can any other node. To do so, first you need to get a reference to the parameter by calling the <a href="../AudioWorkletNode.html"><code>AudioWorkletNode</code></a>'s <a href="../AudioWorkletNode/parameters.html" title="parameters"><code>parameters</code></a> property's <a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!"><code>get()</code></a> method:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">let</span> gainParam <span class="token operator">=</span> myAudioWorkletNode<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"gain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>The value returned and stored in <code>gainParam</code> is the <a href="../AudioParam.html"><code>AudioParam</code></a> used to store the <code>gain</code> parameter. You can then change its value effective at a given time using the <a href="../AudioParam.html"><code>AudioParam</code></a> method <a href="../AudioParam/setValueAtTime.html" title="setValueAtTime()"><code>setValueAtTime()</code></a>.</p>
<p>Here, for example, we set the value to <code>newValue</code>, effective immediately.</p>
<div class="code-example"><pre class="brush: js notranslate"><code>gainParam<span class="token punctuation">.</span><span class="token function">setValueAtTime</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> audioContext<span class="token punctuation">.</span>currentTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>You can similarly use any of the other methods in the <a href="../AudioParam.html"><code>AudioParam</code></a> interface to apply changes over time, to cancel scheduled changes, and so forth.</p>
<p>Reading the value of a parameter is as simple as looking at its <a href="../AudioParam/value.html" title="value"><code>value</code></a> property:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">let</span> currentGain <span class="token operator">=</span> gainParam<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
</code></pre></div></div></section><section aria-labelledby="see_also"><a class="dashAnchor" name="//apple_ref/Section/See%20also"></a><h2 id="see_also"><a href="#see_also">See also</a></h2><div class="section-content"><ul>
  <li><a href="../Web_Audio_API.html">Web Audio API</a></li>
  <li><a href="https://developer.chrome.com/blog/audio-worklet/" class="external" target="_blank">Enter Audio Worklet</a> (Chrome Developers blog)</li>
</ul></div></section><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a content problem with this page?</h3><ul><li>Edit the page <a href="https://github.com/mdn/content/edit/main/files/en-us/web/api/web_audio_api/using_audioworklet/index.md" title="This will take you to GitHub, where you'll need to sign in first." target="_blank" rel="noopener noreferrer">on GitHub</a>.</li><li>Report the <a href="https://github.com/mdn/content/issues/new?template=page-report.yml&amp;mdn-url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWeb_Audio_API%2FUsing_AudioWorklet&amp;metadata=%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EPage+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Fapi%2Fweb_audio_api%2Fusing_audioworklet%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWeb_Audio_API%2FUsing_AudioWorklet%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fmain%2Ffiles%2Fen-us%2Fweb%2Fapi%2Fweb_audio_api%2Fusing_audioworklet%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2Fb6b763e3141472f93d9d88dae534d87748069256%0A*+Document+last+modified%3A+2022-12-14T20%3A55%3A49.000Z%0A%0A%3C%2Fdetails%3E" title="This will take you to GitHub to file a new issue." target="_blank" rel="noopener noreferrer">content issue</a>.</li><li>View the source <a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/web_audio_api/using_audioworklet/index.md?plain=1" title="Folder: en-us/web/api/web_audio_api/using_audioworklet (Opens in a new tab)" target="_blank" rel="noopener noreferrer">on GitHub</a>.</li></ul>Want to get more involved? Learn<!-- --> <a href="https://github.com/mdn/content/blob/main/CONTRIBUTING.md" title="This will take you to our contribution guidelines on GitHub." target="_blank" rel="noopener noreferrer">how to contribute</a>.</div><p class="last-modified-date">This page was last modified on<!-- --> <time datetime="2022-12-14T20:55:49.000Z">Dec 14, 2022</time> by<!-- --> <a href="Using_AudioWorklet/contributors.txt">MDN contributors</a>.</p></div></aside></article></main></div><footer id="nav-footer" class="page-footer"><div><a href="http://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Using_AudioWorklet">Background audio processing using AudioWorklet</a> by <a href="http://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Using_AudioWorklet$history">Mozilla Contributors</a> is licensed under <a href="http://creativecommons.org/licenses/by-sa/2.5/">CC-BY-SA 2.5</a>.</div></footer></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Background audio processing using AudioWorklet","mdn_url":"/en-US/docs/Web/API/Web_Audio_API/Using_AudioWorklet","locale":"en-US","native":"English (US)","sidebarHTML":"<ol><li><strong><a href=\"/en-US/docs/Web/API/Web_Audio_API\">Web Audio API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>Guides</summary><ol><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Using_Web_Audio_API\">Using the Web Audio API</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Basic_concepts_behind_Web_Audio_API\">Basic concepts behind Web Audio API</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Best_practices\">Web Audio API best practices</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Advanced_techniques\">Advanced techniques: Creating and sequencing audio</a></li><li><em><a href=\"/en-US/docs/Web/API/Web_Audio_API/Using_AudioWorklet\" aria-current=\"page\">Background audio processing using AudioWorklet</a></em></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Controlling_multiple_parameters_with_ConstantSourceNode\">Controlling multiple parameters with ConstantSourceNode</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Migrating_from_webkitAudioContext\">Migrating from webkitAudioContext</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Simple_synth\">Example and tutorial: Simple synth keyboard</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Tools\">Tools for analyzing Web Audio usage</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Using_IIR_filters\">Using IIR filters</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API\">Visualizations with Web Audio API</a></li><li><a href=\"/en-US/docs/Web/API/Web_Audio_API/Web_audio_spatialization_basics\">Web audio spatialization basics</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/AnalyserNode\"><code>AnalyserNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioBuffer\"><code>AudioBuffer</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioBufferSourceNode\"><code>AudioBufferSourceNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioContext\"><code>AudioContext</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioDestinationNode\"><code>AudioDestinationNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioListener\"><code>AudioListener</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioNode\"><code>AudioNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioParam\"><code>AudioParam</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioProcessingEvent\"><code>AudioProcessingEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioScheduledSourceNode\"><code>AudioScheduledSourceNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioSinkInfo\"><code>AudioSinkInfo</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioWorklet\"><code>AudioWorklet</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioWorkletGlobalScope\"><code>AudioWorkletGlobalScope</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a></li><li><a href=\"/en-US/docs/Web/API/AudioWorkletProcessor\"><code>AudioWorkletProcessor</code></a></li><li><a href=\"/en-US/docs/Web/API/BaseAudioContext\"><code>BaseAudioContext</code></a></li><li><a href=\"/en-US/docs/Web/API/BiquadFilterNode\"><code>BiquadFilterNode</code></a></li><li><a href=\"/en-US/docs/Web/API/ChannelMergerNode\"><code>ChannelMergerNode</code></a></li><li><a href=\"/en-US/docs/Web/API/ChannelSplitterNode\"><code>ChannelSplitterNode</code></a></li><li><a href=\"/en-US/docs/Web/API/ConstantSourceNode\"><code>ConstantSourceNode</code></a></li><li><a href=\"/en-US/docs/Web/API/ConvolverNode\"><code>ConvolverNode</code></a></li><li><a href=\"/en-US/docs/Web/API/DelayNode\"><code>DelayNode</code></a></li><li><a href=\"/en-US/docs/Web/API/DynamicsCompressorNode\"><code>DynamicsCompressorNode</code></a></li><li><a href=\"/en-US/docs/Web/API/GainNode\"><code>GainNode</code></a></li><li><a href=\"/en-US/docs/Web/API/IIRFilterNode\"><code>IIRFilterNode</code></a></li><li><a href=\"/en-US/docs/Web/API/MediaElementAudioSourceNode\"><code>MediaElementAudioSourceNode</code></a></li><li><a href=\"/en-US/docs/Web/API/MediaStreamAudioDestinationNode\"><code>MediaStreamAudioDestinationNode</code></a></li><li><a href=\"/en-US/docs/Web/API/MediaStreamAudioSourceNode\"><code>MediaStreamAudioSourceNode</code></a></li><li><a href=\"/en-US/docs/Web/API/OfflineAudioCompletionEvent\"><code>OfflineAudioCompletionEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/OfflineAudioContext\"><code>OfflineAudioContext</code></a></li><li><a href=\"/en-US/docs/Web/API/OscillatorNode\"><code>OscillatorNode</code></a></li><li><a href=\"/en-US/docs/Web/API/PannerNode\"><code>PannerNode</code></a></li><li><a href=\"/en-US/docs/Web/API/PeriodicWave\"><code>PeriodicWave</code></a></li><li><a href=\"/en-US/docs/Web/API/WaveShaperNode\"><code>WaveShaperNode</code></a></li><li><a href=\"/en-US/docs/Web/API/StereoPannerNode\"><code>StereoPannerNode</code></a></li></ol></details></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>This article explains how to create an audio worklet processor and use it in a Web Audio application.</p>\n<p>When the Web Audio API was first introduced to browsers, it included the ability to use JavaScript code to create custom audio processors that would be invoked to perform real-time audio manipulations. The drawback to <code>ScriptProcessorNode</code> was that it ran on the main thread, thus blocking everything else going on until it completed execution. This was far less than ideal, especially for something that can be as computationally expensive as audio processing.</p>\n<p>Enter <a href=\"/en-US/docs/Web/API/AudioWorklet\"><code>AudioWorklet</code></a>. An audio context's audio worklet is a <a href=\"/en-US/docs/Web/API/Worklet\"><code>Worklet</code></a> which runs off the main thread, executing audio processing code added to it by calling the context's <a href=\"/en-US/docs/Web/API/Worklet/addModule\" title=\"audioWorklet.addModule()\"><code>audioWorklet.addModule()</code></a> method. Calling <code>addModule()</code> loads the specified JavaScript file, which should contain the implementation of the audio processor. With the processor registered, you can create a new <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a> which passes the audio through the processor's code when the node is linked into the chain of audio nodes along with any other audio nodes.</p>\n<p>It's worth noting that because audio processing can often involve substantial computation, your processor may benefit greatly from being built using <a href=\"/en-US/docs/WebAssembly\">WebAssembly</a>, which brings near-native or fully native performance to web apps. Implementing your audio processing algorithm using WebAssembly can make it perform markedly better.</p>"}},{"type":"prose","value":{"id":"high_level_overview","title":"High level overview","isH3":false,"content":"<p>Before we start looking at the use of AudioWorklet on a step-by-step basis, let's start with a brief high-level overview of what's involved.</p>\n<ol>\n  <li>Create module that defines an audio worklet processor class, based on <a href=\"/en-US/docs/Web/API/AudioWorkletProcessor\"><code>AudioWorkletProcessor</code></a> which takes audio from one or more incoming sources, performs its operation on the data, and outputs the resulting audio data.</li>\n  <li>Access the audio context's <a href=\"/en-US/docs/Web/API/AudioWorklet\"><code>AudioWorklet</code></a> through its <a href=\"/en-US/docs/Web/API/BaseAudioContext/audioWorklet\" title=\"audioWorklet\"><code>audioWorklet</code></a> property, and call the audio worklet's <a href=\"/en-US/docs/Web/API/Worklet/addModule\" title=\"addModule()\"><code>addModule()</code></a> method to install the audio worklet processor module.</li>\n  <li>As needed, create audio processing nodes by passing the processor's name (which is defined by the module) to the <a href=\"/en-US/docs/Web/API/AudioWorkletNode/AudioWorkletNode\" title=\"AudioWorkletNode()\"><code>AudioWorkletNode()</code></a> constructor.</li>\n  <li>Set up any audio parameters the <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a> needs, or that you wish to configure. These are defined in the audio worklet processor module.</li>\n  <li>Connect the created <code>AudioWorkletNode</code>s into your audio processing pipeline as you would any other node, then use your audio pipeline as usual.</li>\n</ol>\n<p>Throughout the remainder of this article, we'll look at these steps in more detail, with examples (including working examples you can try out on your own).</p>\n<p>The example code found on this page is derived from <a href=\"https://mdn.github.io/webaudio-examples/audioworklet/\" class=\"external\" target=\"_blank\">this working example</a> which is part of MDN's <a href=\"https://github.com/mdn/webaudio-examples/\" class=\"external\" target=\"_blank\">GitHub repository of Web Audio examples</a>. The example creates an oscillator node and adds white noise to it using an <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a> before playing the resulting sound out. Slider controls are available to allow controlling the gain of both the oscillator and the audio worklet's output.</p>\n<p><a href=\"https://github.com/mdn/webaudio-examples/tree/master/audioworklet\" class=\"external\" target=\"_blank\"><strong>See the code</strong></a></p>\n<p><a href=\"https://mdn.github.io/webaudio-examples/audioworklet/\" class=\"external\" target=\"_blank\"><strong>Try it live</strong></a></p>"}},{"type":"prose","value":{"id":"creating_an_audio_worklet_processor","title":"Creating an audio worklet processor","isH3":false,"content":"<p>Fundamentally, an audio worklet processor (which we'll refer to usually as either an \"audio processor\" or as a \"processor\" because otherwise this article will be about twice as long) is implemented using a JavaScript module that defines and installs the custom audio processor class.</p>"}},{"type":"prose","value":{"id":"structure_of_an_audio_worklet_processor","title":"Structure of an audio worklet processor","isH3":true,"content":"<p>An audio worklet processor is a JavaScript module which consists of the following:</p>\n<ul>\n  <li>A JavaScript class which defines the audio processor. This class extends the <a href=\"/en-US/docs/Web/API/AudioWorkletProcessor\"><code>AudioWorkletProcessor</code></a> class.</li>\n  <li>The audio processor class must implement a <a href=\"/en-US/docs/Web/API/AudioWorkletProcessor/process\" title=\"process()\"><code>process()</code></a> method, which receives incoming audio data and writes back out the data as manipulated by the processor.</li>\n  <li>The module installs the new audio worklet processor class by calling <a href=\"/en-US/docs/Web/API/AudioWorkletGlobalScope/registerProcessor\" title=\"registerProcessor()\"><code>registerProcessor()</code></a>, specifying a name for the audio processor and the class that defines the processor.</li>\n</ul>\n<p>A single audio worklet processor module may define multiple processor classes, registering each of them with individual calls to <code>registerProcessor()</code>. As long as each has its own unique name, this will work just fine. It's also more efficient than loading multiple modules from over the network or even the user's local disk.</p>"}},{"type":"prose","value":{"id":"basic_code_framework","title":"Basic code framework","isH3":true,"content":"<p>The barest framework of an audio processor class looks like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyAudioProcessor</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AudioWorkletProcessor</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">inputList<span class=\"token punctuation\">,</span> outputList<span class=\"token punctuation\">,</span> parameters</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Using the inputs (or not, as needed),</span>\n    <span class=\"token comment\">// write the output into each of the outputs</span>\n    <span class=\"token comment\">// …</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">registerProcessor</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my-audio-processor\"</span><span class=\"token punctuation\">,</span> MyAudioProcessor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>After the implementation of the processor comes a call to the global function <a href=\"/en-US/docs/Web/API/AudioWorkletGlobalScope/registerProcessor\" title=\"registerProcessor()\"><code>registerProcessor()</code></a>, which is only available within the scope of the audio context's <a href=\"/en-US/docs/Web/API/AudioWorklet\"><code>AudioWorklet</code></a>, which is the invoker of the processor script as a result of your call to <a href=\"/en-US/docs/Web/API/Worklet/addModule\" title=\"audioWorklet.addModule()\"><code>audioWorklet.addModule()</code></a>. This call to <code>registerProcessor()</code> registers your class as the basis for any <a href=\"/en-US/docs/Web/API/AudioWorkletProcessor\"><code>AudioWorkletProcessor</code></a>s created when <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a>s are set up.</p>\n<p>This is the barest framework and actually has no effect until code is added into <code>process()</code> to do something with those inputs and outputs. Which brings us to talking about those inputs and outputs.</p>"}},{"type":"prose","value":{"id":"the_input_and_output_lists","title":"The input and output lists","isH3":true,"content":"<p>The lists of inputs and outputs can be a little confusing at first, even though they're actually very simple once you realize what's going on.</p>\n<p>Let's start at the inside and work our way out. Fundamentally, the audio for a single audio channel (such as the left speaker or the subwoofer, for example) is represented as a <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array\"><code>Float32Array</code></a> whose values are the individual audio samples. By specification, each block of audio your <code>process()</code> function receives contains 128 frames (that is, 128 samples for each channel), but it is planned that <em>this value will change in the future</em>, and may in fact vary depending on circumstances, so you should <em>always</em> check the array's <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray/length\"><code>length</code></a> rather than assuming a particular size. It is, however, guaranteed that the inputs and outputs will have the same block length.</p>\n<p>Each input can have a number of channels. A mono input has a single channel; stereo input has two channels. Surround sound might have six or more channels. So each input is, in turn, an array of channels. That is, an array of <code>Float32Array</code> objects.</p>\n<p>Then, there can be multiple inputs, so the <code>inputList</code> is an array of arrays of <code>Float32Array</code> objects. Each input may have a different number of channels, and each channel has its own array of samples.</p>\n<p>Thus, given the input list <code>inputList</code>:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> numberOfInputs <span class=\"token operator\">=</span> inputList<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> firstInput <span class=\"token operator\">=</span> inputList<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> firstInputChannelCount <span class=\"token operator\">=</span> firstInput<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> firstInputFirstChannel <span class=\"token operator\">=</span> firstInput<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// (or inputList[0][0])</span>\n\n<span class=\"token keyword\">const</span> firstChannelByteCount <span class=\"token operator\">=</span> firstInputFirstChannel<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> firstByteOfFirstChannel <span class=\"token operator\">=</span> firstInputFirstChannel<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// (or inputList[0][0][0])</span>\n</code></pre></div>\n<p>The output list is structured in exactly the same way; it's an array of outputs, each of which is an array of channels, each of which is an array of <code>Float32Array</code> objects, which contain the samples for that channel.</p>\n<p>How you use the inputs and how you generate the outputs depends very much on your processor. If your processor is just a generator, it can ignore the inputs and just replace the contents of the outputs with the generated data. Or you can process each input independently, applying an algorithm to the incoming data on each channel of each input and writing the results into the corresponding outputs' channels (keeping in mind that the number of inputs and outputs may differ, and the channel counts on those inputs and outputs may also differ). Or you can take all the inputs and perform mixing or other computations that result in a single output being filled with data (or all the outputs being filled with the same data).</p>\n<p>It's entirely up to you. This is a very powerful tool in your audio programming toolkit.</p>"}},{"type":"prose","value":{"id":"processing_multiple_inputs","title":"Processing multiple inputs","isH3":true,"content":"<p>Let's take a look at an implementation of <code>process()</code> that can process multiple inputs, with each input being used to generate the corresponding output. Any excess inputs are ignored.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">inputList<span class=\"token punctuation\">,</span> outputList<span class=\"token punctuation\">,</span> parameters</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> sourceLimit <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>inputList<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> outputList<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> inputNum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> inputNum <span class=\"token operator\">&lt;</span> sourceLimit<span class=\"token punctuation\">;</span> inputNum<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> inputList<span class=\"token punctuation\">[</span>inputNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> output <span class=\"token operator\">=</span> outputList<span class=\"token punctuation\">[</span>inputNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> channelCount <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> channelNum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> channelNum <span class=\"token operator\">&lt;</span> channelCount<span class=\"token punctuation\">;</span> channelNum<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      input<span class=\"token punctuation\">[</span>channelNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">sample<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Manipulate the sample</span>\n        output<span class=\"token punctuation\">[</span>channelNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sample<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Note that when determining the number of sources to process and send through to the corresponding outputs, we use <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/min\"><code>Math.min()</code></a> to ensure that we only process as many channels as we have room for in the output list. The same check is performed when determining how many channels to process in the current input; we only process as many as there are room for in the destination output. This avoids errors due to overrunning these arrays.</p>"}},{"type":"prose","value":{"id":"mixing_inputs","title":"Mixing inputs","isH3":true,"content":"<p>Many nodes perform <strong>mixing</strong> operations, where the inputs are combined in some way into a single output. This is demonstrated in the following example.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">inputList<span class=\"token punctuation\">,</span> outputList<span class=\"token punctuation\">,</span> parameters</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> sourceLimit <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>inputList<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> outputList<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> inputNum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> inputNum <span class=\"token operator\">&lt;</span> sourceLimit<span class=\"token punctuation\">;</span> inputNum<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> input <span class=\"token operator\">=</span> inputList<span class=\"token punctuation\">[</span>inputNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> output <span class=\"token operator\">=</span> outputList<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> channelCount <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> channelNum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> channelNum <span class=\"token operator\">&lt;</span> channelCount<span class=\"token punctuation\">;</span> channelNum<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> input<span class=\"token punctuation\">[</span>channelNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> sample <span class=\"token operator\">=</span> output<span class=\"token punctuation\">[</span>channelNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> input<span class=\"token punctuation\">[</span>channelNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sample <span class=\"token operator\">&gt;</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          sample <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sample <span class=\"token operator\">&lt;</span> <span class=\"token operator\">-</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          sample <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        output<span class=\"token punctuation\">[</span>channelNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> sample<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>This is similar code to the previous sample in many ways, but only the first output—<code>outputList[0]</code>—is altered. Each sample is added to the corresponding sample in the output buffer, with a simple code fragment in place to prevent the samples from exceeding the legal range of -1.0 to 1.0 by capping the values; there are other ways to avoid clipping that are perhaps less prone to distortion, but this is a simple example that's better than nothing.</p>"}},{"type":"prose","value":{"id":"lifetime_of_an_audio_worklet_processor","title":"Lifetime of an audio worklet processor","isH3":false,"content":"<p>The only means by which you can influence the lifespan of your audio worklet processor is through the value returned by <code>process()</code>, which should be a Boolean value indicating whether or not to override the <a href=\"/en-US/docs/Glossary/User_agent\">user agent</a>'s decision-making as to whether or not your node is still in use.</p>\n<p>In general, the lifetime policy of any audio node is simple: if the node is still considered to be actively processing audio, it will continue to be used. In the case of an <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a>, the node is considered to be active if its <code>process()</code> function returns <code>true</code> <em>and</em> the node is either generating content as a source for audio data, or is receiving data from one or more inputs.</p>\n<p>Specifying a value of <code>true</code> as the result from your <code>process()</code> function in essence tells the Web Audio API that your processor needs to keep being called even if the API doesn't think there's anything left for you to do. In other words, <code>true</code> overrides the API's logic and gives you control over your processor's lifetime policy, keeping the processor's owning <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a> running even when it would otherwise decide to shut down the node.</p>\n<p>Returning <code>false</code> from the <code>process()</code> method tells the API that it should follow its normal logic and shut down your processor node if it deems it appropriate to do so. If the API determines that your node is no longer needed, <code>process()</code> will not be called again.</p>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note:</strong> At this time, unfortunately, Chrome does not implement this algorithm in a manner that matches the current standard. Instead, it keeps the node alive if you return <code>true</code> and shuts it down if you return <code>false</code>. Thus for compatibility reasons you must always return <code>true</code> from <code>process()</code>, at least on Chrome. However, once <a href=\"https://bugs.chromium.org/p/chromium/issues/detail?id=921354\" class=\"external\" target=\"_blank\">this Chrome issue</a> is fixed, you will want to change this behavior if possible as it may have a slight negative impact on performance.</p>\n</div>"}},{"type":"prose","value":{"id":"creating_an_audio_processor_worklet_node","title":"Creating an audio processor worklet node","isH3":false,"content":"<p>To create an audio node that pumps blocks of audio data through an <a href=\"/en-US/docs/Web/API/AudioWorkletProcessor\"><code>AudioWorkletProcessor</code></a>, you need to follow these simple steps:</p>\n<ol>\n  <li>Load and install the audio processor module</li>\n  <li>Create an <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a>, specifying the audio processor module to use by its name</li>\n  <li>Connect inputs to the <code>AudioWorkletNode</code> and its outputs to appropriate destinations (either other nodes or to the <a href=\"/en-US/docs/Web/API/AudioContext\"><code>AudioContext</code></a> object's <a href=\"/en-US/docs/Web/API/BaseAudioContext/destination\" title=\"destination\"><code>destination</code></a> property.</li>\n</ol>\n<p>To use an audio worklet processor, you can use code similar to the following:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> audioContext <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createMyAudioProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>audioContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      audioContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AudioContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">await</span> audioContext<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">await</span> audioContext<span class=\"token punctuation\">.</span>audioWorklet<span class=\"token punctuation\">.</span><span class=\"token function\">addModule</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"module-url/module.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AudioWorkletNode</span><span class=\"token punctuation\">(</span>audioContext<span class=\"token punctuation\">,</span> <span class=\"token string\">\"processor-name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>This <code>createMyAudioProcessor()</code> function creates and returns a new instance of <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a> configured to use your audio processor. It also handles creating the audio context if it hasn't already been done.</p>\n<p>In order to ensure the context is usable, this starts by creating the context if it's not already available, then adds the module containing the processor to the worklet. Once that's done, it instantiates and returns a new <code>AudioWorkletNode</code>. Once you have that in hand, you connect it to other nodes and otherwise use it just like any other node.</p>\n<p>You can then create a new audio processor node by doing this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> newProcessorNode <span class=\"token operator\">=</span> <span class=\"token function\">createMyAudioProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>If the returned value, <code>newProcessorNode</code>, is non-<code>null</code>, we have a valid audio context with its hiss processor node in place and ready to use.</p>"}},{"type":"prose","value":{"id":"supporting_audio_parameters","title":"Supporting audio parameters","isH3":false,"content":"<p>Just like any other Web Audio node, <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a> supports parameters, which are shared with the <a href=\"/en-US/docs/Web/API/AudioWorkletProcessor\"><code>AudioWorkletProcessor</code></a> that does the actual work.</p>"}},{"type":"prose","value":{"id":"adding_parameter_support_to_the_processor","title":"Adding parameter support to the processor","isH3":true,"content":"<p>To add parameters to an <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a>, you need to define them within your <a href=\"/en-US/docs/Web/API/AudioWorkletProcessor\"><code>AudioWorkletProcessor</code></a>-based processor class in your module. This is done by adding the static getter <a href=\"/en-US/docs/Web/API/AudioWorkletProcessor/parameterDescriptors\" title=\"parameterDescriptors\"><code>parameterDescriptors</code></a> to your class. This function should return an array of <a href=\"/en-US/docs/Web/API/AudioParam\"><code>AudioParam</code></a> objects, one for each parameter supported by the processor.</p>\n<p>In the following implementation of <code>parameterDescriptors()</code>, the returned array has two <code>AudioParam</code> objects. The first defines <code>gain</code> as a value between 0 and 1, with a default value of 0.5. The second parameter is named <code>frequency</code> and defaults to 440.0, with a range from 27.5 to 4186.009, inclusively.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">static</span> <span class=\"token keyword\">get</span> <span class=\"token function\">parameterDescriptors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n   <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gain\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">defaultValue</span><span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">minValue</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">maxValue</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"frequency\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">defaultValue</span><span class=\"token operator\">:</span> <span class=\"token number\">440.0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">minValue</span><span class=\"token operator\">:</span> <span class=\"token number\">27.5</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">maxValue</span><span class=\"token operator\">:</span> <span class=\"token number\">4186.009</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Accessing your processor node's parameters is as simple as looking them up in the <code>parameters</code> object passed into your implementation of <a href=\"/en-US/docs/Web/API/AudioWorkletProcessor/process\" title=\"process()\"><code>process()</code></a>. Within the <code>parameters</code> object are arrays, one for each of your parameters, and sharing the same names as your parameters.</p>\n<dl>\n  <dt id=\"a-rate_parameters\">A-rate parameters</dt>\n  <dd>\n    <p>For a-rate parameters—parameters whose values automatically change over time—the parameter's entry in the <code>parameters</code> object is an array of <a href=\"/en-US/docs/Web/API/AudioParam\"><code>AudioParam</code></a> objects, one for each frame in the block being processed. These values are to be applied to the corresponding frames.</p>\n  </dd>\n  <dt id=\"k-rate_parameters\">K-rate parameters</dt>\n  <dd>\n    <p>K-rate parameters, on the other hand, can only change once per block, so the parameter's array has only a single entry. Use that value for every frame in the block.</p>\n  </dd>\n</dl>\n<p>In the code below, we see a <code>process()</code> function that handles a <code>gain</code> parameter which can be used as either an a-rate or k-rate parameter. Our node only supports one input, so it just takes the first input in the list, applies the gain to it, and writes the resulting data to the first output's buffer.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">inputList<span class=\"token punctuation\">,</span> outputList<span class=\"token punctuation\">,</span> parameters</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> inputList<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> output <span class=\"token operator\">=</span> outputList<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> gain <span class=\"token operator\">=</span> parameters<span class=\"token punctuation\">.</span>gain<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> channelNum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> channelNum <span class=\"token operator\">&lt;</span> input<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> channel<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> inputChannel <span class=\"token operator\">=</span> input<span class=\"token punctuation\">[</span>channel<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> outputChannel <span class=\"token operator\">=</span> output<span class=\"token punctuation\">[</span>channel<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If gain.length is 1, it's a k-rate parameter, so apply</span>\n    <span class=\"token comment\">// the first entry to every frame. Otherwise, apply each</span>\n    <span class=\"token comment\">// entry to the corresponding frame.</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>gain<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> inputChannel<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        outputChannel<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> inputChannel<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> gain<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> inputChannel<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        outputChannel<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> inputChannel<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> gain<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Here, if <code>gain.length</code> indicates that there's only a single value in the <code>gain</code> parameter's array of values, the first entry in the array is applied to every frame in the block. Otherwise, for each frame in the block, the corresponding entry in <code>gain[]</code> is applied.</p>"}},{"type":"prose","value":{"id":"accessing_parameters_from_the_main_thread_script","title":"Accessing parameters from the main thread script","isH3":true,"content":"<p>Your main thread script can access the parameters just like it can any other node. To do so, first you need to get a reference to the parameter by calling the <a href=\"/en-US/docs/Web/API/AudioWorkletNode\"><code>AudioWorkletNode</code></a>'s <a href=\"/en-US/docs/Web/API/AudioWorkletNode/parameters\" title=\"parameters\"><code>parameters</code></a> property's <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\"><code>get()</code></a> method:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> gainParam <span class=\"token operator\">=</span> myAudioWorkletNode<span class=\"token punctuation\">.</span>parameters<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gain\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The value returned and stored in <code>gainParam</code> is the <a href=\"/en-US/docs/Web/API/AudioParam\"><code>AudioParam</code></a> used to store the <code>gain</code> parameter. You can then change its value effective at a given time using the <a href=\"/en-US/docs/Web/API/AudioParam\"><code>AudioParam</code></a> method <a href=\"/en-US/docs/Web/API/AudioParam/setValueAtTime\" title=\"setValueAtTime()\"><code>setValueAtTime()</code></a>.</p>\n<p>Here, for example, we set the value to <code>newValue</code>, effective immediately.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>gainParam<span class=\"token punctuation\">.</span><span class=\"token function\">setValueAtTime</span><span class=\"token punctuation\">(</span>newValue<span class=\"token punctuation\">,</span> audioContext<span class=\"token punctuation\">.</span>currentTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>You can similarly use any of the other methods in the <a href=\"/en-US/docs/Web/API/AudioParam\"><code>AudioParam</code></a> interface to apply changes over time, to cancel scheduled changes, and so forth.</p>\n<p>Reading the value of a parameter is as simple as looking at its <a href=\"/en-US/docs/Web/API/AudioParam/value\" title=\"value\"><code>value</code></a> property:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> currentGain <span class=\"token operator\">=</span> gainParam<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"/en-US/docs/Web/API/Web_Audio_API\">Web Audio API</a></li>\n  <li><a href=\"https://developer.chrome.com/blog/audio-worklet/\" class=\"external\" target=\"_blank\">Enter Audio Worklet</a> (Chrome Developers blog)</li>\n</ul>"}}],"toc":[{"text":"High level overview","id":"high_level_overview"},{"text":"Creating an audio worklet processor","id":"creating_an_audio_worklet_processor"},{"text":"Lifetime of an audio worklet processor","id":"lifetime_of_an_audio_worklet_processor"},{"text":"Creating an audio processor worklet node","id":"creating_an_audio_processor_worklet_node"},{"text":"Supporting audio parameters","id":"supporting_audio_parameters"},{"text":"See also","id":"see_also"}],"summary":"This article explains how to create an audio worklet processor and use it in a Web Audio application.","popularity":0,"modified":"2022-12-14T20:55:49.000Z","other_translations":[{"title":"AudioWorklet을 사용하는 백그라운드 오디오 프로세싱","locale":"ko","native":"한국어"}],"source":{"folder":"en-us/web/api/web_audio_api/using_audioworklet","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/api/web_audio_api/using_audioworklet/index.md","last_commit_url":"https://github.com/mdn/content/commit/b6b763e3141472f93d9d88dae534d87748069256","filename":"index.md"},"short_title":"Background audio processing using AudioWorklet","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/Web_Audio_API","title":"Web Audio API"},{"uri":"/en-US/docs/Web/API/Web_Audio_API/Using_AudioWorklet","title":"Background audio processing using AudioWorklet"}],"pageTitle":"Background audio processing using AudioWorklet - Web APIs | MDN","noIndexing":false}}</script>
<!-- Mirrored from developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Using_AudioWorklet by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Feb 2023 04:49:13 GMT -->
</body></html>