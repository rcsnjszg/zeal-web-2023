<html><!-- Mirrored from developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Using_DTMF by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Feb 2023 04:49:48 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="../../../../../favicon-48x48.cbbd161b.png"><link rel="apple-touch-icon" href="../../../../../apple-touch-icon.6803c6f0.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="../../../../../manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="https://developer.mozilla.org/opensearch.xml" title="MDN Web Docs"><title>Using DTMF with WebRTC</title><meta name="robots" content="index, follow"><meta name="description" content="In order to more fully support audio/video conferencing, WebRTC supports sending DTMF to the remote peer on an RTCPeerConnection. This article offers a brief high-level overview of how DTMF works over WebRTC, then provides a guide for everyday developers about how to send DTMF over an RTCPeerConnection. The DTMF system is often referred to as &quot;touch tone,&quot; after an old trade name for the system."><meta property="og:url" content="Using_DTMF.html"><meta property="og:title" content="Using DTMF with WebRTC - Web APIs | MDN"><meta property="og:locale" content="en-US"><meta property="og:description" content="In order to more fully support audio/video conferencing, WebRTC supports sending DTMF to the remote peer on an RTCPeerConnection. This article offers a brief high-level overview of how DTMF works over WebRTC, then provides a guide for everyday developers about how to send DTMF over an RTCPeerConnection. The DTMF system is often referred to as &quot;touch tone,&quot; after an old trade name for the system."><meta property="og:image" content="../../../../../mdn-social-share.cd6c4a5a.png"><meta property="twitter:card" content="summary_large_image"><link rel="canonical" href="Using_DTMF.html"><style media="print">.article-actions-container,.document-toc-container,.language-menu,.main-menu-toggle,.mdn-cta-container,.on-github,.page-footer,.sidebar,.top-navigation-main,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><script src="../../../../../static/js/ga.js" defer=""></script><script defer="defer" src="../../../../../static/js/main.5c9d40d0.js"></script><link href="../../../../../static/css/main.7d378400.css" rel="stylesheet"></head><body><script>document.body.addEventListener("load",(t=>{t.target.classList.contains("interactive")&&t.target.setAttribute("data-readystate","complete")}),{capture:!0});const c={light:"#ffffff",dark:"#1b1b1b"};if(window&&document.documentElement)try{const t=window.localStorage.getItem("theme");t&&(document.documentElement.className=t,document.documentElement.style.backgroundColor=c[t])}catch(t){console.warn("Unable to read theme from localStorage",t)}</script><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#top-nav-search-input">Skip to search</a></li><li><a id="skip-select-language" href="#languages-switcher-button">Skip to select language</a></li></ul><div class="page-wrapper  category-api document-page"><div class="main-document-header-container"><header class="main-document-header-container top-navigation 
      
      "><div class="container "><div class="top-navigation-wrap"><a href="https://developer.mozilla.org/en-US/" class="logo" aria-label="MDN homepage"><svg id="mdn-docs-logo" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 694.9 104.4" style="enable-background:new 0 0 694.9 104.4" xml:space="preserve" role="img"><title>MDN Web Docs</title><style>.logo-m{fill:var(--text-link)}</style><g class="logo-m"><path d="M40.3 0 11.7 92.1H0L28.5 0h11.8zM50.7 0v92.1H40.3V0h10.4zM91 0 62.5 92.1H50.8L79.3 0H91zM101.4 0v92.1H91V0h10.4z"></path></g><path class="logo-m" d="M627.9 95.6h67v8.8h-67v-8.8z"></path><g style="fill:var(--text-primary)"><path d="M367 42h-4l-10.7 30.8h-5.5l-10.8-26h-.4l-10.5 26h-5.2L308.7 42h-3.8v-5.6H323V42h-6.5l6.8 20.4h.4l10.3-26h4.7l11.2 26h.5l5.7-20.3h-6.2v-5.6H367V42zM401.9 62c-.4 3.2-2 5.9-4.7 8.2-2.8 2.3-6.5 3.4-11.3 3.4-5.4 0-9.7-1.6-13.1-4.7-3.3-3.2-5-7.7-5-13.7 0-5.7 1.6-10.3 4.7-14s7.4-5.5 12.9-5.5c5.1 0 9.1 1.6 11.9 4.7s4.3 6.9 4.3 11.3c0 1.5-.2 3-.5 4.7h-25.6c.3 7.7 4 11.6 10.9 11.6 2.9 0 5.1-.7 6.5-2 1.5-1.4 2.5-3 3-4.9l6 .9zM394 51.3c.2-2.4-.4-4.7-1.8-6.9s-3.8-3.3-7-3.3c-3.1 0-5.3 1-6.9 3-1.5 2-2.5 4.4-2.8 7.2H394zM445 53.7c0 5-1.3 9.5-4 13.7s-6.9 6.2-12.7 6.2c-6 0-10.3-2.2-12.7-6.7-.1.4-.2 1.4-.4 2.9s-.3 2.5-.4 2.9h-7.3c.3-1.7.6-3.5.8-5.3.3-1.8.4-3.7.4-5.5V22.3h-6v-5.6H416v27c1.1-2.2 2.7-4.1 4.7-5.7 2-1.6 4.8-2.4 8.4-2.4 4.6 0 8.4 1.6 11.4 4.7 3 3.2 4.5 7.6 4.5 13.4zm-7.7.6c0-4.2-1-7.4-3-9.5-2-2.2-4.4-3.3-7.4-3.3-3.4 0-6 1.2-8 3.7-1.9 2.4-2.9 5-3 7.7V57c0 3 1 5.6 3 7.7s4.5 3.1 7.6 3.1c3.6 0 6.3-1.3 8.1-3.9 1.8-2.7 2.7-5.9 2.7-9.6zM506.5 72.8h-13.2v-7.2c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2 5.7 0 9.8 2.2 12.3 6.5V22.3h-8.6v-5.6h15.8v50.6h6v5.5zM493.2 56v-4.4c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zM546.3 54.6c0 5.6-1.8 10.2-5.3 13.7s-8.2 5.3-13.9 5.3-10.1-1.7-13.4-5.1c-3.3-3.4-5-7.9-5-13.5 0-5.3 1.6-9.9 4.7-13.7 3.2-3.8 7.9-5.7 14.2-5.7s11 1.9 14.1 5.7c3 3.7 4.6 8.1 4.6 13.3zm-7.7-.2c0-4-1-7.2-3-9.5s-4.8-3.5-8.2-3.5c-3.6 0-6.4 1.2-8.3 3.7s-2.9 5.6-2.9 9.5c0 3.7.9 6.8 2.8 9.4 1.9 2.6 4.6 3.9 8.3 3.9 3.6 0 6.4-1.3 8.4-3.8 1.9-2.6 2.9-5.8 2.9-9.7zM583.6 60.2c-.4 3.2-1.9 6.3-4.4 9.1-2.5 2.9-6.4 4.3-11.8 4.3-5.2 0-9.4-1.6-12.6-4.8-3.2-3.2-4.8-7.7-4.8-13.7 0-5.5 1.6-10.1 4.7-13.9 3.2-3.8 7.6-5.7 13.2-5.7 2.3 0 4.6.3 6.7.8 2.2.5 4.2 1.5 6.2 2.9l1.5 9.5-5.9.7-1.3-6.1c-2.1-1.2-4.5-1.8-7.2-1.8-3.5 0-6.1 1.2-7.7 3.7-1.7 2.5-2.5 5.7-2.5 9.6 0 4.1.9 7.3 2.7 9.5 1.8 2.3 4.4 3.4 7.8 3.4 5.2 0 8.2-2.9 9.2-8.8l6.2 1.3zM618.3 62.1c0 3.6-1.5 6.5-4.6 8.5s-7 3-11.7 3c-5.7 0-10.6-1.2-14.6-3.6l1.2-8.8 5.7.6-.2 4.7c1.1.5 2.3.9 3.6 1.1s2.6.3 3.9.3c2.4 0 4.5-.4 6.5-1.3 1.9-.9 2.9-2.2 2.9-4.1 0-1.8-.8-3.1-2.3-3.8s-3.5-1.3-5.8-1.7-4.6-.9-6.9-1.4c-2.3-.6-4.2-1.6-5.7-2.9-1.6-1.4-2.3-3.5-2.3-6.3 0-4.1 1.5-6.9 4.6-8.5s6.4-2.4 9.9-2.4c2.6 0 5 .3 7.2.9 2.2.6 4.3 1.4 6.1 2.4l.8 8.8-5.8.7-.8-5.7c-2.3-1-4.7-1.6-7.2-1.6-2.1 0-3.7.4-5.1 1.1-1.3.8-2 2-2 3.8 0 1.7.8 2.9 2.3 3.6 1.5.7 3.4 1.2 5.7 1.6 2.2.4 4.5.8 6.7 1.4 2.2.6 4.1 1.6 5.7 3 1.4 1.6 2.2 3.7 2.2 6.6zM197.6 73.2h-17.1v-5.5h3.8V51.9c0-3.7-.7-6.3-2.1-7.9-1.4-1.6-3.3-2.3-5.7-2.3-3.2 0-5.6 1.1-7.2 3.4s-2.4 4.6-2.5 6.9v15.6h6v5.5h-17.1v-5.5h3.8V51.9c0-3.8-.7-6.4-2.1-7.9-1.4-1.5-3.3-2.3-5.6-2.3-3.2 0-5.5 1.1-7.2 3.3-1.6 2.2-2.4 4.5-2.5 6.9v15.8h6.9v5.5h-20.2v-5.5h6V42.4h-6.1v-5.6h13.4v6.4c1.2-2.1 2.7-3.8 4.7-5.2 2-1.3 4.4-2 7.3-2s5.3.7 7.5 2.1c2.2 1.4 3.7 3.5 4.5 6.4 1.1-2.5 2.7-4.5 4.9-6.1s4.8-2.4 7.9-2.4c3.5 0 6.5 1.1 8.9 3.3s3.7 5.6 3.7 10.2v18.2h6.1v5.5zm42.5 0h-13.2V66c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2s9.8 2.2 12.3 6.5V22.7h-8.6v-5.6h15.8v50.6h6v5.5zm-13.3-16.8V52c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zm61.5 16.8H269v-5.5h6V51.9c0-3.7-.7-6.3-2.2-7.9-1.4-1.6-3.4-2.3-5.7-2.3-3.1 0-5.6 1-7.4 3s-2.8 4.4-2.9 7v15.9h6v5.5h-19.3v-5.5h6V42.4h-6.2v-5.6h13.6V43c2.6-4.6 6.8-6.9 12.7-6.9 3.6 0 6.7 1.1 9.2 3.3s3.7 5.6 3.7 10.2v18.2h6v5.4h-.2z"></path></g></svg></a><button title="Open main menu" type="button" class="button action has-icon main-menu-toggle" aria-haspopup="menu" aria-label="Open main menu" aria-expanded="false"><span class="button-wrap"><span class="icon icon-menu "></span><span class="visually-hidden">Open main menu</span></span></button></div><div class="top-navigation-main"><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button type="button" id="references-button" class="top-level-entry menu-toggle" aria-controls="references-menu" aria-expanded="false">References</button><a href="https://developer.mozilla.org/en-US/docs/Web" class="top-level-entry">References</a><ul id="references-menu" class="submenu references hidden inline-submenu-lg" aria-labelledby="references-button"><li class="apis-link-container mobile-only "><a href="https://developer.mozilla.org/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li><li class="html-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Structure of content on the web</p></div></a></li><li class="css-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Code used to describe document style</p></div></a></li><li class="javascript-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">General-purpose scripting language</p></div></a></li><li class="http-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP" class="submenu-item "><div class="submenu-icon http"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTTP</div><p class="submenu-item-description">Protocol for transmitting web resources</p></div></a></li><li class="apis-link-container "><a href="../../API.html" class="submenu-item "><div class="submenu-icon apis"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web APIs</div><p class="submenu-item-description">Interfaces for building web applications</p></div></a></li><li class="apis-link-container "><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Extensions</div><p class="submenu-item-description">Developing extensions for web browsers</p></div></a></li><li class="apis-link-container desktop-only "><a href="https://developer.mozilla.org/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li></ul></li><li class="top-level-entry-container"><button type="button" id="guides-button" class="top-level-entry menu-toggle" aria-controls="guides-menu" aria-expanded="false">Guides</button><a href="https://developer.mozilla.org/en-US/docs/Learn" class="top-level-entry">Guides</a><ul id="guides-menu" class="submenu guides hidden inline-submenu-lg" aria-labelledby="guides-button"><li class="apis-link-container mobile-only "><a href="https://developer.mozilla.org/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="apis-link-container desktop-only "><a href="https://developer.mozilla.org/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="html-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Learn to structure web content with HTML</p></div></a></li><li class="css-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Learn to style content using CSS</p></div></a></li><li class="javascript-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">Learn to run scripts in the browser</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Accessibility</div><p class="submenu-item-description">Learn to make the web accessible to all</p></div></a></li></ul></li><li class="top-level-entry-container"><button type="button" id="mdn-plus-button" class="top-level-entry menu-toggle" aria-controls="mdn-plus-menu" aria-expanded="false">MDN Plus</button><a href="https://developer.mozilla.org/en-US/plus" class="top-level-entry">MDN Plus</a><ul id="mdn-plus-menu" class="submenu mdn-plus hidden inline-submenu-lg" aria-labelledby="mdn-plus-button"><li class=" "><a href="https://developer.mozilla.org/en-US/plus" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview</div><p class="submenu-item-description">A customized MDN experience</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/updates" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Updates</div><p class="submenu-item-description">All browser compatibility updates at a glance</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/docs/features/overview" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Documentation</div><p class="submenu-item-description">Learn how to use MDN Plus</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/docs/faq" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">FAQ</div><p class="submenu-item-description">Frequently asked questions about MDN Plus</p></div></a></li></ul></li></ul></nav><div class="header-search"><form action="https://developer.mozilla.org/en-US/search" role="search" aria-haspopup="listbox" aria-owns="top-nav-search-menu" aria-expanded="false" class="search-form search-widget" id="top-nav-search-form"><label id="top-nav-search-label" for="top-nav-search-input" class="visually-hidden">Search MDN</label><input id="top-nav-search-input" aria-autocomplete="list" aria-controls="top-nav-search-menu" aria-labelledby="top-nav-search-label" autocomplete="off" type="search" class="search-input-field" name="q" placeholder="   " required="" value=""><button type="button" class="button action has-icon clear-search-button"><span class="button-wrap"><span class="icon icon-cancel "></span><span class="visually-hidden">Clear search input</span></span></button><button type="submit" class="button action has-icon search-button"><span class="button-wrap"><span class="icon icon-search "></span><span class="visually-hidden">Search</span></span></button><div id="top-nav-search-menu" role="listbox" aria-labelledby="top-nav-search-label"></div></form></div><div class="theme-switcher-menu"><button type="button" class="button action has-icon theme-switcher-menu small" aria-haspopup="menu"><span class="button-wrap"><span class="icon icon-theme-os-default "></span>Theme</span></button></div><ul class="auth-container"><li><a href="https://developer.mozilla.org/users/fxa/login/authenticate/?next=%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebRTC_API%2FUsing_DTMF" class="signin-link" rel="nofollow">Already a subscriber?</a></li><li><a class="button primary mdn-plus-subscribe-link" href="https://developer.mozilla.org/en-US/plus"><span class="button-wrap">Get MDN Plus</span></a></li></ul></div></div></header><div class="article-actions-container"><div class="container"><button type="button" class="button action has-icon sidebar-button" aria-label="Expand sidebar" aria-expanded="false" aria-controls="sidebar-quicklinks"><span class="button-wrap"><span class="icon icon-sidebar "></span></span></button><nav class="breadcrumbs-container" aria-label="Breadcrumb"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="https://developer.mozilla.org/en-US/docs/Web"><span property="name">References</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="../../API.html"><span property="name">Web APIs</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="../WebRTC_API.html"><span property="name">WebRTC API</span></a><meta property="position" content="3"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="Using_DTMF.html"><span property="name">Using DTMF with WebRTC</span></a><meta property="position" content="4"></li></ol></nav></div></div></div><div class="main-wrapper"><aside id="sidebar-quicklinks" class="sidebar"><button type="button" class="button action backdrop" aria-label="Collapse sidebar"><span class="button-wrap"></span></button><nav aria-label="Related Topics" class="sidebar-inner"><div class="in-nav-toc"><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#sending_dtmf_on_an_rtcpeerconnection">Sending DTMF on an RTCPeerConnection</a></li><li class="document-toc-item "><a class="document-toc-link" href="#simple_example">Simple example</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></div><div><ol><li><strong><a href="../WebRTC_API.html">WebRTC API</a></strong></li><li class="toggle"><details open=""><summary>Guides</summary><ol><li><a href="Protocols.html">Introduction to WebRTC protocols</a></li><li><a href="Connectivity.html">WebRTC connectivity</a></li><li><a href="Session_lifetime.html">Lifetime of a WebRTC session</a></li><li><a href="Signaling_and_video_calling.html">Signaling and video calling</a></li><li><a href="Using_data_channels.html">Using WebRTC data channels</a></li><li><em><a href="Using_DTMF.html" aria-current="page">Using DTMF with WebRTC</a></em></li><li><a href="../WebRTC_API.html#interoperability">WebRTC API</a></li><li><a href="Simple_RTCDataChannel_sample.html">A simple RTCDataChannel sample</a></li><li><a href="Build_a_phone_with_peerjs.html">Building an Internet-Connected Phone with PeerJS</a></li></ol></details></li><li class="toggle"><details open=""><summary>Interfaces</summary><ol><li><a href="../RTCPeerConnection.html"><code>RTCPeerConnection</code></a></li><li><a href="../RTCSessionDescription.html"><code>RTCSessionDescription</code></a></li><li><a href="../RTCIceCandidate.html"><code>RTCIceCandidate</code></a></li><li><a href="../RTCPeerConnectionIceEvent.html"><code>RTCPeerConnectionIceEvent</code></a></li><li><a href="../RTCPeerConnectionIceErrorEvent.html"><code>RTCPeerConnectionIceErrorEvent</code></a></li><li><a href="../RTCCertificate.html"><code>RTCCertificate</code></a></li><li><a href="../RTCRtpSender.html"><code>RTCRtpSender</code></a></li><li><a href="../RTCRtpReceiver.html"><code>RTCRtpReceiver</code></a></li><li><a href="../RTCRtpTransceiver.html"><code>RTCRtpTransceiver</code></a></li><li><a href="../RTCDtlsTransport.html"><code>RTCDtlsTransport</code></a></li><li><a href="../RTCIceTransport.html"><code>RTCIceTransport</code></a></li><li><a href="../RTCTrackEvent.html"><code>RTCTrackEvent</code></a></li><li><a href="../RTCSctpTransport.html"><code>RTCSctpTransport</code></a></li><li><a href="../RTCDataChannel.html"><code>RTCDataChannel</code></a></li><li><a href="../RTCDataChannelEvent.html"><code>RTCDataChannelEvent</code></a></li><li><a href="../RTCDTMFSender.html"><code>RTCDTMFSender</code></a></li><li><a href="../RTCDTMFToneChangeEvent.html"><code>RTCDTMFToneChangeEvent</code></a></li><li><a href="../RTCStatsReport.html"><code>RTCStatsReport</code></a></li><li><a href="../RTCErrorEvent.html"><code>RTCErrorEvent</code></a></li></ol></details></li><li class="toggle"><details open=""><summary>Properties</summary><ol><li><a href="../Navigator/mediaDevices.html"><code>Navigator.mediaDevices</code></a></li></ol></details></li><li class="toggle"><details open=""><summary>Methods</summary><ol><li><a href="../MediaDevices/getUserMedia.html"><code>MediaDevices.getUserMedia()</code></a></li></ol></details></li><li class="toggle"><details open=""><summary>Events</summary><ol><li><a href="../RTCDTMFSender/tonechange_event.html"><code>RTCDTMFSender</code>: <code>tonechange</code></a></li><li><a href="../RTCDataChannel/bufferedamountlow_event.html"><code>RTCDataChannel</code>: <code>bufferedamountlow</code></a></li><li><a href="../RTCDataChannel/close_event.html"><code>RTCDataChannel</code>: <code>close</code></a></li><li><a href="../RTCDataChannel/closing_event.html"><code>RTCDataChannel</code>: <code>closing</code></a></li><li><a href="../RTCDataChannel/error_event.html"><code>RTCDataChannel</code>: <code>error</code></a></li><li><a href="../RTCDataChannel/message_event.html"><code>RTCDataChannel</code>: <code>message</code></a></li><li><a href="../RTCDataChannel/open_event.html"><code>RTCDataChannel</code>: <code>open</code></a></li><li><a href="../RTCDtlsTransport/error_event.html"><code>RTCDtlsTransport</code>: <code>error</code></a></li><li><a href="../RTCDtlsTransport/statechange_event.html"><code>RTCDtlsTransport</code>: <code>statechange</code></a></li><li><a href="../RTCIceTransport/error_event.html"><code>RTCIceTransport</code>: <code>error</code></a></li><li><a href="../RTCIceTransport/gatheringstatechange_event.html"><code>RTCIceTransport</code>: <code>gatheringstatechange</code></a></li><li><a href="../RTCIceTransport/selectedcandidatepairchange_event.html"><code>RTCIceTransport</code>: <code>selectedcandidatepairchange</code></a></li><li><a href="../RTCIceTransport/statechange_event.html"><code>RTCIceTransport</code>: <code>statechange</code></a></li><li><a href="../RTCPeerConnection/connectionstatechange_event.html"><code>RTCPeerConnection</code>: <code>connectionstatechange</code></a></li><li><a href="../RTCPeerConnection/datachannel_event.html"><code>RTCPeerConnection</code>: <code>datachannel</code></a></li><li><a href="../RTCPeerConnection/icecandidate_event.html"><code>RTCPeerConnection</code>: <code>icecandidate</code></a></li><li><a href="../RTCPeerConnection/icecandidateerror_event.html"><code>RTCPeerConnection</code>: <code>icecandidateerror</code></a></li><li><a href="../RTCPeerConnection/iceconnectionstatechange_event.html"><code>RTCPeerConnection</code>: <code>iceconnectionstatechange</code></a></li><li><a href="../RTCPeerConnection/icegatheringstatechange_event.html"><code>RTCPeerConnection</code>: <code>icegatheringstatechange</code></a></li><li><a href="../RTCPeerConnection/negotiationneeded_event.html"><code>RTCPeerConnection</code>: <code>negotiationneeded</code></a></li><li><a href="../RTCPeerConnection/signalingstatechange_event.html"><code>RTCPeerConnection</code>: <code>signalingstatechange</code></a></li><li><a href="../RTCPeerConnection/track_event.html"><code>RTCPeerConnection</code>: <code>track</code></a></li><li><a href="../RTCSctpTransport/error_event.html"><code>RTCSctpTransport</code>: <code>error</code></a></li></ol></details></li></ol></div></nav></aside><aside class="toc"><nav><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#sending_dtmf_on_an_rtcpeerconnection">Sending DTMF on an RTCPeerConnection</a></li><li class="document-toc-item "><a class="document-toc-link" href="#simple_example">Simple example</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></nav></aside><main id="content" class="main-content  "><article class="main-page-content" lang="en-US"><h1>Using DTMF with WebRTC</h1><div class="section-content"><p>In order to more fully support audio/video conferencing, <a href="../WebRTC_API.html">WebRTC</a> supports sending <a href="https://developer.mozilla.org/en-US/docs/Glossary/DTMF">DTMF</a> to the remote peer on an <a href="../RTCPeerConnection.html"><code>RTCPeerConnection</code></a>. This article offers a brief high-level overview of how DTMF works over WebRTC, then provides a guide for everyday developers about how to send DTMF over an <code>RTCPeerConnection</code>. The DTMF system is often referred to as "touch tone," after an old trade name for the system.</p>
<p>WebRTC doesn't send DTMF codes as audio data. Instead, they're sent out-of-band, as RTP payloads. Note, however, that although it's possible to <em>send</em> DTMF using WebRTC, there is currently no way to detect or receive <em>incoming</em> DTMF. WebRTC currently ignores these payloads; this is because WebRTC's DTMF support is primarily intended for use with legacy telephone services that rely on DTMF tones to perform tasks such as:</p>
<ul>
  <li>Teleconferencing systems</li>
  <li>Menu systems</li>
  <li>Voicemail systems</li>
  <li>Entry of credit card or other payment information</li>
  <li>Passcode entry</li>
</ul>
<div class="notecard note" id="sect1">
  <p><strong>Note:</strong> While the DTMF is not sent to the remote peer as audio, browsers may choose to play the corresponding tone to the local user as part of their user experience, since users are typically used to hearing their phone play the tones audibly.</p>
</div></div><section aria-labelledby="sending_dtmf_on_an_rtcpeerconnection"><a class="dashAnchor" name="//apple_ref/Section/Sending%20DTMF%20on%20an%20RTCPeerConnection"></a><h2 id="sending_dtmf_on_an_rtcpeerconnection"><a href="#sending_dtmf_on_an_rtcpeerconnection">Sending DTMF on an RTCPeerConnection</a></h2><div class="section-content"><p>A given <a href="../RTCPeerConnection.html"><code>RTCPeerConnection</code></a> can have multiple media tracks sent or received on it. When you wish to transmit DTMF signals, you first need to decide which track to send them on, since DTMF is sent as a series of out-of-band payloads on the <a href="../RTCRtpSender.html"><code>RTCRtpSender</code></a> responsible for transmitting that track's data to the other peer.</p>
<p>Once the track is selected, you can obtain from its <code>RTCRtpSender</code> the <a href="../RTCDTMFSender.html"><code>RTCDTMFSender</code></a> object you'll use for sending DTMF. From there, you can call <a href="../RTCDTMFSender/insertDTMF.html"><code>RTCDTMFSender.insertDTMF()</code></a> to enqueue DTMF signals to be sent on the track to the other peer. The <code>RTCRtpSender</code> will then send the tones to the other peer as packets alongside the track's audio data.</p>
<p>Each time a tone is sent, the <code>RTCPeerConnection</code> receives a <a href="../RTCDTMFSender/tonechange_event.html"><code>tonechange</code></a> event with a <a href="../RTCDTMFToneChangeEvent/tone.html" title="tone"><code>tone</code></a> property specifying which tone finished playing, which is an opportunity to update interface elements, for example. When the tone buffer is empty, indicating that all the tones have been sent, a <code>tonechange</code> event with its <code>tone</code> property set to "" (an empty string) is delivered to the connection object.</p>
<p>If you'd like to know more about how this works, read <a href="https://datatracker.ietf.org/doc/html/rfc3550" class="external" target="_blank">RFC 3550: RTP: A Transport Protocol for Real-Time Applications</a> and <a href="https://datatracker.ietf.org/doc/html/rfc4733" class="external" target="_blank">RFC 4733: RTP Payload for DTMF Digits, Telephony Tones, and Telephony Signals</a>. The details of how DTMF payloads are handled on RTP are beyond the scope of this article. Instead, we'll focus on how to use DTMF within the context of an <a href="../RTCPeerConnection.html"><code>RTCPeerConnection</code></a> by studying how an example works.</p></div></section><section aria-labelledby="simple_example"><a class="dashAnchor" name="//apple_ref/Section/Simple%20example"></a><h2 id="simple_example"><a href="#simple_example">Simple example</a></h2><div class="section-content"><p>This simple example constructs two <a href="../RTCPeerConnection.html"><code>RTCPeerConnection</code></a>s, establishes a connection between them, then waits for the user to click a "Dial" button. When the button is clicked, a DTMF string is sent over the connection using <a href="../RTCDTMFSender/insertDTMF.html"><code>RTCDTMFSender.insertDTMF()</code></a>. Once the tones finish transmitting, the connection is closed.</p>
<div class="notecard note" id="sect2">
  <p><strong>Note:</strong> This example is obviously somewhat contrived, since normally the two <code>RTCPeerConnection</code> objects would exist on different devices, and signaling would be done over the network instead of it all being linked up inline as it is here.</p>
</div></div></section><section aria-labelledby="html"><h3 id="html"><a href="#html">HTML</a></h3><div class="section-content"><p>The HTML for this example is very basic; there are only three elements of importance:</p>
<ul>
  <li>An <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio"><code>&lt;audio&gt;</code></a> element to play the audio received by the <code>RTCPeerConnection</code> being "called."</li>
  <li>A <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button"><code>&lt;button&gt;</code></a> element to trigger creating and connecting the two <code>RTCPeerConnection</code> objects, then sending the DTMF tones.</li>
  <li>A <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> to receive and display log text to show status information.</li>
</ul>
<div class="code-example"><pre class="brush: html notranslate"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
  This example demonstrates the use of DTMF in WebRTC. Note that this example is
  "cheating" by generating both peers in one code stream, rather than having
  each be a truly separate entity.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>audio</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>audio<span class="token punctuation">"</span></span> <span class="token attr-name">autoplay</span> <span class="token attr-name">controls</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>audio</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dial<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dial<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Dial<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>log<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div></section><section aria-labelledby="javascript"><h3 id="javascript"><a href="#javascript">JavaScript</a></h3><div class="section-content"><p>Let's take a look at the JavaScript code next. Keep in mind that the process of establishing the connection is somewhat contrived here; you normally don't build both ends of the connection in the same document.</p>
<h4 id="global_variables">Global variables</h4>
<p>First, we establish global variables.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">let</span> dialString <span class="token operator">=</span> <span class="token string">"12024561111"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> callerPC <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> receiverPC <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> dtmfSender <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> hasAddTrack <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> mediaConstraints <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">audio</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">video</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> offerOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">offerToReceiveAudio</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">offerToReceiveVideo</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> dialButton <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> logElement <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre></div>
<p>These are, in order:</p>
<dl>
  <dt id="dialstring"><code>dialString</code></dt>
  <dd>
    <p>The DTMF string the caller will send when the "Dial" button is clicked.</p>
  </dd>
  <dt id="callerpc"><code>callerPC</code> and <code>receiverPC</code></dt>
  <dd>
    <p>The <a href="../RTCPeerConnection.html"><code>RTCPeerConnection</code></a> objects representing the caller and the receiver, respectively. These will be initialized when the call starts up, in our <code>connectAndDial()</code> function, as shown in <a href="#starting_the_connection_process">Starting the connection process</a> below.</p>
  </dd>
  <dt id="dtmfsender"><code>dtmfSender</code></dt>
  <dd>
    <p>The <a href="../RTCDTMFSender.html"><code>RTCDTMFSender</code></a> object for the connection. This will be obtained while setting up the connection, in the <code>gotStream()</code> function shown in <a href="#adding_the_audio_to_the_connection">Adding the audio to the connection</a>.</p>
  </dd>
  <dt id="hasaddtrack"><code>hasAddTrack</code></dt>
  <dd>
    <p>Because some browsers have not yet implemented <a href="../RTCPeerConnection/addTrack.html"><code>RTCPeerConnection.addTrack()</code></a>, therefore requiring the use of the obsolete <a href="../RTCPeerConnection/addStream.html" title="addStream()"><code>addStream()</code></a> method, we use this Boolean to determine whether or not the user agent supports <code>addTrack()</code>; if it doesn't, we'll fall back to <code>addStream()</code>. This gets figured out in <code>connectAndDial()</code>, as shown in <a href="#starting_the_connection_process">Starting the connection process</a>.</p>
  </dd>
  <dt id="mediaconstraints"><code>mediaConstraints</code></dt>
  <dd>
    <p>An object conforming to the <a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!"><code>MediaConstraints</code></a> dictionary specifying the constraints to use when starting the connection. We want an audio-only connection, so <code>video</code> is <code>false</code>, while <code>audio</code> is <code>true</code>.</p>
  </dd>
  <dt id="offeroptions"><code>offerOptions</code></dt>
  <dd>
    <p>An object providing options to specify when calling <a href="../RTCPeerConnection/createOffer.html"><code>RTCPeerConnection.createOffer()</code></a>. In this case, we state that we want to receive audio but not video.</p>
  </dd>
  <dt id="dialbutton"><code>dialButton</code> and <code>logElement</code></dt>
  <dd>
    <p>These variables will be used to store references to the dial button and the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> into which logging information will be written. They'll get set up when the page is first loaded. See <a href="#initialization">Initialization</a> below.</p>
  </dd>
</dl>
<h4 id="initialization">Initialization</h4>
<p>When the page loads, we do some basic setup: we fetch references to the dial button and the log output box elements, and we use <a href="../EventTarget/addEventListener.html" title="addEventListener()"><code>addEventListener()</code></a> to add an event listener to the dial button so that clicking it calls the <code>connectAndDial()</code> function to begin the connection process.</p>
<div class="code-example"><pre class="brush: js notranslate"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"load"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  logElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dialButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#dial"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  dialButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> connectAndDial<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h4 id="starting_the_connection_process">Starting the connection process</h4>
<p>When the dial button is clicked, <code>connectAndDial()</code> is called. This starts building the WebRTC connection in preparation for sending the DTMF codes.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">connectAndDial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  callerPC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  hasAddTrack <span class="token operator">=</span> callerPC<span class="token punctuation">.</span>addTrack <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

  callerPC<span class="token punctuation">.</span>onicecandidate <span class="token operator">=</span> handleCallerIceEvent<span class="token punctuation">;</span>
  callerPC<span class="token punctuation">.</span>onnegotiationneeded <span class="token operator">=</span> handleCallerNegotiationNeeded<span class="token punctuation">;</span>
  callerPC<span class="token punctuation">.</span>oniceconnectionstatechange <span class="token operator">=</span> handleCallerIceConnectionStateChange<span class="token punctuation">;</span>
  callerPC<span class="token punctuation">.</span>onsignalingstatechange <span class="token operator">=</span> handleCallerSignalingStateChangeEvent<span class="token punctuation">;</span>
  callerPC<span class="token punctuation">.</span>onicegatheringstatechange <span class="token operator">=</span> handleCallerGatheringStateChangeEvent<span class="token punctuation">;</span>

  receiverPC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  receiverPC<span class="token punctuation">.</span>onicecandidate <span class="token operator">=</span> handleReceiverIceEvent<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasAddTrack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    receiverPC<span class="token punctuation">.</span>ontrack <span class="token operator">=</span> handleReceiverTrackEvent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    receiverPC<span class="token punctuation">.</span>onaddstream <span class="token operator">=</span> handleReceiverAddStreamEvent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  navigator<span class="token punctuation">.</span>mediaDevices
    <span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>mediaConstraints<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>gotStream<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>After creating the <code>RTCPeerConnection</code> for the caller (<code>callerPC</code>), we look to see if it has an <a href="../RTCPeerConnection/addTrack.html" title="addTrack()"><code>addTrack()</code></a> method. If it does, we set <code>hasAddTrack</code> to <code>true</code>; otherwise, we set it to <code>false</code>. This variable will let the example operate even on browsers not yet implementing the newer <code>addTrack()</code> method; we'll do so by falling back to the older <a href="../RTCPeerConnection/addStream.html" title="addStream()"><code>addStream()</code></a> method.</p>
<p>Next, the event handlers for the caller are established. We'll cover these in detail later.</p>
<p>Then a second <code>RTCPeerConnection</code>, this one representing the receiving end of the call, is created and stored in <code>receiverPC</code>; its <code>onicecandidate</code> event handler is set up too.</p>
<p>If <code>addTrack()</code> is supported, we set up the receiver's <code>ontrack</code> event handler; otherwise, we set up <code>onaddstream</code>. The <a href="../RTCPeerConnection/track_event.html" title="track"><code>track</code></a> and <a href="../RTCPeerConnection/addstream_event.html" title="addstream"><code>addstream</code></a> events are sent when media is added to the connection.</p>
<p>Finally, we call <a href="../MediaDevices/getUserMedia.html" title="getUserMedia()"><code>getUserMedia()</code></a> to obtain access to the caller's microphone. If successful, the function <code>gotStream()</code> is called, otherwise we log the error because calling has failed.</p>
<h4 id="adding_the_audio_to_the_connection">Adding the audio to the connection</h4>
<p>As mentioned above, when the audio input from the microphone is obtained, <code>gotStream()</code> is called. Its job is to build the stream being sent to the receiver, so the actual process of starting to transmit can begin. It also gets access to the <code>RTCDTMFSender</code> we'll use to issue DTMF on the connection.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">gotStream</span><span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Got access to the microphone."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> audioTracks <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">getAudioTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasAddTrack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>audioTracks<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      audioTracks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> callerPC<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>track<span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token string">"Your browser doesn't support RTCPeerConnection.addTrack(). Falling "</span> <span class="token operator">+</span>
        <span class="token string">"back to the &lt;strong&gt;deprecated&lt;/strong&gt; addStream() method…"</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    callerPC<span class="token punctuation">.</span><span class="token function">addStream</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callerPC<span class="token punctuation">.</span>getSenders<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dtmfSender <span class="token operator">=</span> callerPC<span class="token punctuation">.</span><span class="token function">getSenders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dtmf<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token string">"Your browser doesn't support RTCPeerConnection.getSenders(), so "</span> <span class="token operator">+</span>
        <span class="token string">"falling back to use &lt;strong&gt;deprecated&lt;/strong&gt; createDTMFSender() "</span> <span class="token operator">+</span>
        <span class="token string">"instead."</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    dtmfSender <span class="token operator">=</span> callerPC<span class="token punctuation">.</span><span class="token function">createDTMFSender</span><span class="token punctuation">(</span>audioTracks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  dtmfSender<span class="token punctuation">.</span>ontonechange <span class="token operator">=</span> handleToneChangeEvent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>After setting <code>audioTracks</code> to be a list of the audio tracks on the stream from the user's microphone, it's time to add the media to the caller's <code>RTCPeerConnection</code>. If <code>addTrack()</code> is available on the <code>RTCPeerConnection</code>, we add each of the stream's audio tracks, one by one, to the connection using <a href="../RTCPeerConnection/addTrack.html"><code>RTCPeerConnection.addTrack()</code></a>. Otherwise we call <a href="../RTCPeerConnection/addStream.html"><code>RTCPeerConnection.addStream()</code></a> to add the stream to the call as a single unit.</p>
<p>Next we look to see if the <a href="../RTCPeerConnection/getSenders.html"><code>RTCPeerConnection.getSenders()</code></a> method is implemented. If it is, we call it on <code>callerPC</code> and get the first entry in the returned list of senders; this is the <a href="../RTCRtpSender.html"><code>RTCRtpSender</code></a> responsible for transmitting data for the first audio track on the call (which is the track we'll send DTMF over). We then obtain the <code>RTCRtpSender</code>'s <a href="../RTCRtpSender/dtmf.html" title="dtmf"><code>dtmf</code></a> property, which is an <a href="../RTCDTMFSender.html"><code>RTCDTMFSender</code></a> object that can send DTMF on the connection, from the caller to the receiver.</p>
<p>If <code>getSenders()</code> isn't available, we instead call <a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!"><code>RTCPeerConnection.createDTMFSender()</code></a> to get the <code>RTCDTMFSender</code> object. Although this method is obsolete, this example supports it as a fallback to let older browsers (and those not yet updated to support the current WebRTC DTMF API) run the example.</p>
<p>Finally, we set the DTMF sender's <a href="../RTCDTMFSender/tonechange_event.html" title="ontonechange"><code>ontonechange</code></a> event handler so we get notified each time a DTMF tone finishes playing.</p>
<p>You can find the log function at the bottom of the documentation.</p>
<h4 id="when_a_tone_finishes_playing">When a tone finishes playing</h4>
<p>Each time a DTMF tone finishes playing, a <a href="../RTCDTMFSender/tonechange_event.html"><code>tonechange</code></a> event is delivered to <code>callerPC</code>. The event listener for these is implemented as the <code>handleToneChangeEvent()</code> function.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleToneChangeEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>tone <span class="token operator">!==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Tone played: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>tone<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"All tones have played. Disconnecting."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callerPC<span class="token punctuation">.</span><span class="token function">getLocalStreams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      stream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    receiverPC<span class="token punctuation">.</span><span class="token function">getLocalStreams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      stream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    audio<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    audio<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    receiverPC<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callerPC<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The <a href="../RTCDTMFSender/tonechange_event.html"><code>tonechange</code></a> event is used both to indicate when an individual tone has played and when all tones have finished playing. The event's <a href="../RTCDTMFToneChangeEvent/tone.html" title="tone"><code>tone</code></a> property is a string indicating which tone just finished playing. If all tones have finished playing, <code>tone</code> is an empty string; when that's the case, <a href="../RTCDTMFSender/toneBuffer.html"><code>RTCDTMFSender.toneBuffer</code></a> is empty.</p>
<p>In this example, we log to the screen which tone just finished playing. In a more advanced application, you might update the user interface, for example, to indicate which note is currently playing.</p>
<p>On the other hand, if the tone buffer is empty, our example is designed to disconnect the call. This is done by stopping each stream on both the caller and the receiver by iterating over each <code>RTCPeerConnection</code>'s track list (as returned by its <a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!"><code>getTracks()</code></a> method) and calling each track's <a href="../MediaStreamTrack/stop.html" title="stop()"><code>stop()</code></a> method.</p>
<p>Once both the caller's and the receiver's media tracks are all stopped, we pause the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio"><code>&lt;audio&gt;</code></a> element and set its <a href="../HTMLMediaElement/srcObject.html" title="srcObject"><code>srcObject</code></a> to <code>null</code>. This detaches the audio stream from the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio"><code>&lt;audio&gt;</code></a> element.</p>
<p>Then, finally, each <code>RTCPeerConnection</code> is closed by calling its <a href="../RTCPeerConnection/close.html" title="close()"><code>close()</code></a> method.</p>
<h4 id="adding_candidates_to_the_caller">Adding candidates to the caller</h4>
<p>When the caller's <code>RTCPeerConnection</code> ICE layer comes up with a new candidate to propose, it issues an <a href="../RTCPeerConnection/icecandidate_event.html" title="icecandidate"><code>icecandidate</code></a> event to <code>callerPC</code>. The <code>icecandidate</code> event handler's job is to transmit the candidate to the receiver. In our example, we are directly controlling both the caller and the receiver, so we can just directly add the candidate to the receiver by calling its <a href="../RTCPeerConnection/addIceCandidate.html" title="addIceCandidate()"><code>addIceCandidate()</code></a> method. That's handled by <code>handleCallerIceEvent()</code>:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleCallerIceEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Adding candidate to receiver: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">.</span>candidate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    receiverPC
      <span class="token punctuation">.</span><span class="token function">addIceCandidate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RTCIceCandidate</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error adding candidate to receiver: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Caller is out of candidates."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>If the <a href="../RTCPeerConnection/icecandidate_event.html" title="icecandidate"><code>icecandidate</code></a> event has a non-<code>null</code> <code>candidate</code> property, we create a new <a href="../RTCIceCandidate.html"><code>RTCIceCandidate</code></a> object from the <code>event.candidate</code> string and "transmit" it to the receiver by calling <code>receiverPC.addIceCandidate()</code>, providing the new <code>RTCIceCandidate</code> as its input. If <code>addIceCandidate()</code> fails, the <code>catch()</code> clause outputs the error to our log box.</p>
<p>If <code>event.candidate</code> is <code>null</code>, that indicates that there are no more candidates available, and we log that information.</p>
<h4 id="dialing_once_the_connection_is_open">Dialing once the connection is open</h4>
<p>Our design requires that when the connection is established, we immediately send the DTMF string. To accomplish that, we watch for the caller to receive an <a href="../RTCPeerConnection/iceconnectionstatechange_event.html" title="iceconnectionstatechange"><code>iceconnectionstatechange</code></a> event. This event is sent when one of a number of changes occurs to the state of the ICE connection process, including the successful establishment of a connection.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleCallerIceConnectionStateChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Caller's connection state changed to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>callerPC<span class="token punctuation">.</span>iceConnectionState<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callerPC<span class="token punctuation">.</span>iceConnectionState <span class="token operator">===</span> <span class="token string">"connected"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sending DTMF: "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dialString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dtmfSender<span class="token punctuation">.</span><span class="token function">insertDTMF</span><span class="token punctuation">(</span>dialString<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The <code>iceconnectionstatechange</code> event doesn't actually include within it the new state, so we get the connection process's current state from <code>callerPC</code>'s <a href="../RTCPeerConnection/iceConnectionState.html"><code>RTCPeerConnection.iceConnectionState</code></a> property. After logging the new state, we look to see if the state is <code>"connected"</code>. If so, we log the fact that we're about to send the DTMF, then we call <a href="../RTCDTMFSender/insertDTMF.html" title="dtmf.insertDTMF()"><code>dtmf.insertDTMF()</code></a> to send the DTMF on the same track as the audio data method on the <code>RTCDTMFSender</code> object we <a href="#adding_the_audio_to_the_connection">previously stored</a> in <code>dtmfSender</code>.</p>
<p>Our call to <code>insertDTMF()</code> specifies not only the DTMF to send (<code>dialString</code>), but also the length of each tone in milliseconds (400 ms) and the amount of time between tones (50 ms).</p>
<h4 id="negotiating_the_connection">Negotiating the connection</h4>
<p>When the calling <a href="../RTCPeerConnection.html"><code>RTCPeerConnection</code></a> begins to receive media (after the microphone's stream is added to it), a <a href="../RTCPeerConnection/negotiationneeded_event.html" title="negotiationneeded"><code>negotiationneeded</code></a> event is delivered to the caller, letting it know that it's time to start negotiating the connection with the receiver. As previously mentioned, our example is simplified somewhat because we control both the caller and the receiver, so <code>handleCallerNegotiationNeeded()</code> is able to quickly construct the connection by chaining the required calls together for both the caller and receiver, as shown below.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleCallerNegotiationNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Negotiating…"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  callerPC
    <span class="token punctuation">.</span><span class="token function">createOffer</span><span class="token punctuation">(</span>offerOptions<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">offer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Setting caller's local description: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offer<span class="token punctuation">.</span>sdp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> callerPC<span class="token punctuation">.</span><span class="token function">setLocalDescription</span><span class="token punctuation">(</span>offer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">"Setting receiver's remote description to the same as caller's local"</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> receiverPC<span class="token punctuation">.</span><span class="token function">setRemoteDescription</span><span class="token punctuation">(</span>callerPC<span class="token punctuation">.</span>localDescription<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Creating answer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> receiverPC<span class="token punctuation">.</span><span class="token function">createAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">answer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Setting receiver's local description to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answer<span class="token punctuation">.</span>sdp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> receiverPC<span class="token punctuation">.</span><span class="token function">setLocalDescription</span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Setting caller's remote description to match"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> callerPC<span class="token punctuation">.</span><span class="token function">setRemoteDescription</span><span class="token punctuation">(</span>receiverPC<span class="token punctuation">.</span>localDescription<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error during negotiation: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Since the various methods involved in negotiating the connection return <a href="../../JavaScript/Reference/Global_Objects/Promise.html"><code>promise</code></a>s, we can chain them together like this:</p>
<ol>
  <li>Call <a href="../RTCPeerConnection/createOffer.html" title="callerPC.createOffer()"><code>callerPC.createOffer()</code></a> to get an offer.</li>
  <li>Then take that offer and set the caller's local description to match by calling <a href="../RTCPeerConnection/setLocalDescription.html" title="callerPC.setLocalDescription()"><code>callerPC.setLocalDescription()</code></a>.</li>
  <li>Then "transmit" the offer to the receiver by calling <a href="../RTCPeerConnection/setRemoteDescription.html" title="receiverPC.setRemoteDescription()"><code>receiverPC.setRemoteDescription()</code></a>. This configures the receiver so that it knows how the caller is configured.</li>
  <li>Then the receiver creates an answer by calling <a href="../RTCPeerConnection/createAnswer.html" title="receiverPC.createAnswer()"><code>receiverPC.createAnswer()</code></a>.</li>
  <li>Then the receiver sets its local description to match the newly-created answer by calling <a href="../RTCPeerConnection/setLocalDescription.html" title="receiverPC.setLocalDescription()"><code>receiverPC.setLocalDescription()</code></a>.</li>
  <li>Then the answer is "transmitted" to the caller by calling <a href="../RTCPeerConnection/setRemoteDescription.html" title="callerPC.setRemoteDescription()"><code>callerPC.setRemoteDescription()</code></a>. This lets the caller know what the receiver's configuration is.</li>
  <li>If at any time an error occurs, the <code>catch()</code> clause outputs an error message to the log.</li>
</ol>
<h4 id="tracking_other_state_changes">Tracking other state changes</h4>
<p>We can also watch for changes to the signaling state (by accepting <a href="../RTCPeerConnection/signalingstatechange_event.html" title="signalingstatechange"><code>signalingstatechange</code></a> events) and the ICE gathering state (by accepting <a href="../RTCPeerConnection/icegatheringstatechange_event.html" title="icegatheringstatechange"><code>icegatheringstatechange</code></a> events). We aren't using these for anything, so all we do is log them. We could have not set up these event listeners at all.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleCallerSignalingStateChangeEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Caller's signaling state changed to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>callerPC<span class="token punctuation">.</span>signalingState<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">handleCallerGatheringStateChangeEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Caller's ICE gathering state changed to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>callerPC<span class="token punctuation">.</span>iceGatheringState<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h4 id="adding_candidates_to_the_receiver">Adding candidates to the receiver</h4>
<p>When the receiver's <code>RTCPeerConnection</code> ICE layer comes up with a new candidate to propose, it issues an <a href="../RTCPeerConnection/icecandidate_event.html" title="icecandidate"><code>icecandidate</code></a> event to <code>receiverPC</code>. The <code>icecandidate</code> event handler's job is to transmit the candidate to the caller. In our example, we are directly controlling both the caller and the receiver, so we can just directly add the candidate to the caller by calling its <a href="../RTCPeerConnection/addIceCandidate.html" title="addIceCandidate()"><code>addIceCandidate()</code></a> method. That's handled by <code>handleReceiverIceEvent()</code>.</p>
<p>This code is analogous to the <code>icecandidate</code> event handler for the caller, seen in <a href="#adding_candidates_to_the_caller">Adding candidates to the caller</a> above.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleReceiverIceEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Adding candidate to caller: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">.</span>candidate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    callerPC
      <span class="token punctuation">.</span><span class="token function">addIceCandidate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RTCIceCandidate</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error adding candidate to caller: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Receiver is out of candidates."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>If the <a href="../RTCPeerConnection/icecandidate_event.html" title="icecandidate"><code>icecandidate</code></a> event has a non-<code>null</code> <code>candidate</code> property, we create a new <a href="../RTCIceCandidate.html"><code>RTCIceCandidate</code></a> object from the <code>event.candidate</code> string and deliver it to the caller by passing that into <code>callerPC.addIceCandidate()</code>. If <code>addIceCandidate()</code> fails, the <code>catch()</code> clause outputs the error to our log box.</p>
<p>If <code>event.candidate</code> is <code>null</code>, that indicates that there are no more candidates available, and we log that information.</p>
<h4 id="adding_media_to_the_receiver">Adding media to the receiver</h4>
<p>When the receiver begins to receive media, an event is delivered to the receiver's <a href="../RTCPeerConnection.html"><code>RTCPeerConnection</code></a>, <code>receiverPC</code>. As explained in <a href="#starting_the_connection_process">Starting the connection process</a>, the current WebRTC specification uses the <a href="../RTCPeerConnection/track_event.html" title="track"><code>track</code></a> event for this, but some browsers haven't been updated to support this yet, so we also need to handle the <a href="../RTCPeerConnection/addstream_event.html" title="addstream"><code>addstream</code></a> event. The <code>handleReceiverTrackEvent()</code> and <code>handleReceiverAddStreamEvent()</code> methods, shown below, handle these.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">handleReceiverTrackEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> event<span class="token punctuation">.</span>streams<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">handleReceiverAddStreamEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> event<span class="token punctuation">.</span>stream<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>The <code>track</code> event includes a <a href="../RTCTrackEvent/streams.html" title="streams"><code>streams</code></a> property containing an array of the streams the track is a member of (one track can be part of many streams). We take the first stream and attach it to the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio"><code>&lt;audio&gt;</code></a> element.</p>
<p>The <code>addstream</code> event includes a <a class="page-not-created" title="The documentation about this has not yet been written; please consider contributing!"><code>stream</code></a> property specifying a single stream added to the track. We attach it to the <code>&lt;audio&gt;</code> element.</p>
<h4 id="logging">Logging</h4>
<p>A simple <code>log()</code> function is used throughout the code to append HTML to a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> box for displaying status and errors to the user.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  logElement<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;br/&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div></section><section aria-labelledby="result"><h3 id="result"><a href="#result">Result</a></h3><div class="section-content"><p>You can try this example here. When you click the "Dial" button, you should see a series of logging messages output, then the dialing will begin. If your browser plays the tones audibly as part of its user experience, you should hear them as they're transmitted.</p><iframe class="sample-code-frame" title="Simple example sample" id="frame_simple_example" width="600" height="500" src="../../../../../../yari-demos.prod.mdn.mozit.cloud/en-US/docs/Web/API/WebRTC_API/Using_DTMF/_sample_.simple_example.html" allow="microphone" loading="lazy"></iframe>
<p>Once transmission of the tones is complete, the connection is closed. You can click "Dial" again to reconnect and send the tones again.</p></div></section><section aria-labelledby="see_also"><a class="dashAnchor" name="//apple_ref/Section/See%20also"></a><h2 id="see_also"><a href="#see_also">See also</a></h2><div class="section-content"><ul>
  <li><a href="../WebRTC_API.html">WebRTC API</a></li>
  <li><a href="Session_lifetime.html">Lifetime of a WebRTC session</a></li>
  <li><a href="Signaling_and_video_calling.html">Signaling and video calling</a> (a tutorial and example which explains the signaling process in more detail)</li>
  <li><a href="Protocols.html">Introduction to WebRTC protocols</a></li>
</ul></div></section><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a content problem with this page?</h3><ul><li>Edit the page <a href="https://github.com/mdn/content/edit/main/files/en-us/web/api/webrtc_api/using_dtmf/index.md" title="This will take you to GitHub, where you'll need to sign in first." target="_blank" rel="noopener noreferrer">on GitHub</a>.</li><li>Report the <a href="https://github.com/mdn/content/issues/new?template=page-report.yml&amp;mdn-url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebRTC_API%2FUsing_DTMF&amp;metadata=%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EPage+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Fapi%2Fwebrtc_api%2Fusing_dtmf%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebRTC_API%2FUsing_DTMF%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fmain%2Ffiles%2Fen-us%2Fweb%2Fapi%2Fwebrtc_api%2Fusing_dtmf%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2F3f7036e4dbe83e50c873c42a88a5a7d1d80a478e%0A*+Document+last+modified%3A+2022-11-25T08%3A33%3A02.000Z%0A%0A%3C%2Fdetails%3E" title="This will take you to GitHub to file a new issue." target="_blank" rel="noopener noreferrer">content issue</a>.</li><li>View the source <a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/webrtc_api/using_dtmf/index.md?plain=1" title="Folder: en-us/web/api/webrtc_api/using_dtmf (Opens in a new tab)" target="_blank" rel="noopener noreferrer">on GitHub</a>.</li></ul>Want to get more involved? Learn<!-- --> <a href="https://github.com/mdn/content/blob/main/CONTRIBUTING.md" title="This will take you to our contribution guidelines on GitHub." target="_blank" rel="noopener noreferrer">how to contribute</a>.</div><p class="last-modified-date">This page was last modified on<!-- --> <time datetime="2022-11-25T08:33:02.000Z">Nov 25, 2022</time> by<!-- --> <a href="Using_DTMF/contributors.txt">MDN contributors</a>.</p></div></aside></article></main></div><footer id="nav-footer" class="page-footer"><div><a href="http://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Using_DTMF">Using DTMF with WebRTC</a> by <a href="http://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Using_DTMF$history">Mozilla Contributors</a> is licensed under <a href="http://creativecommons.org/licenses/by-sa/2.5/">CC-BY-SA 2.5</a>.</div></footer></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Using DTMF with WebRTC","mdn_url":"/en-US/docs/Web/API/WebRTC_API/Using_DTMF","locale":"en-US","native":"English (US)","sidebarHTML":"<ol><li><strong><a href=\"/en-US/docs/Web/API/WebRTC_API\">WebRTC API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>Guides</summary><ol><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Protocols\">Introduction to WebRTC protocols</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Connectivity\">WebRTC connectivity</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Session_lifetime\">Lifetime of a WebRTC session</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling\">Signaling and video calling</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Using_data_channels\">Using WebRTC data channels</a></li><li><em><a href=\"/en-US/docs/Web/API/WebRTC_API/Using_DTMF\" aria-current=\"page\">Using DTMF with WebRTC</a></em></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API#interoperability\">WebRTC API</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample\">A simple RTCDataChannel sample</a></li><li><a href=\"/en-US/docs/Web/API/WebRTC_API/Build_a_phone_with_peerjs\">Building an Internet-Connected Phone with PeerJS</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCSessionDescription\"><code>RTCSessionDescription</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceCandidate\"><code>RTCIceCandidate</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnectionIceEvent\"><code>RTCPeerConnectionIceEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnectionIceErrorEvent\"><code>RTCPeerConnectionIceErrorEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCCertificate\"><code>RTCCertificate</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCRtpSender\"><code>RTCRtpSender</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCRtpReceiver\"><code>RTCRtpReceiver</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCRtpTransceiver\"><code>RTCRtpTransceiver</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDtlsTransport\"><code>RTCDtlsTransport</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceTransport\"><code>RTCIceTransport</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCTrackEvent\"><code>RTCTrackEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCSctpTransport\"><code>RTCSctpTransport</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel\"><code>RTCDataChannel</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannelEvent\"><code>RTCDataChannelEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDTMFSender\"><code>RTCDTMFSender</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDTMFToneChangeEvent\"><code>RTCDTMFToneChangeEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCStatsReport\"><code>RTCStatsReport</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCErrorEvent\"><code>RTCErrorEvent</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Properties</summary><ol><li><a href=\"/en-US/docs/Web/API/Navigator/mediaDevices\"><code>Navigator.mediaDevices</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Methods</summary><ol><li><a href=\"/en-US/docs/Web/API/MediaDevices/getUserMedia\"><code>MediaDevices.getUserMedia()</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Events</summary><ol><li><a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\"><code>RTCDTMFSender</code>: <code>tonechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/bufferedamountlow_event\"><code>RTCDataChannel</code>: <code>bufferedamountlow</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/close_event\"><code>RTCDataChannel</code>: <code>close</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/closing_event\"><code>RTCDataChannel</code>: <code>closing</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/error_event\"><code>RTCDataChannel</code>: <code>error</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/message_event\"><code>RTCDataChannel</code>: <code>message</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDataChannel/open_event\"><code>RTCDataChannel</code>: <code>open</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDtlsTransport/error_event\"><code>RTCDtlsTransport</code>: <code>error</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCDtlsTransport/statechange_event\"><code>RTCDtlsTransport</code>: <code>statechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceTransport/error_event\"><code>RTCIceTransport</code>: <code>error</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceTransport/gatheringstatechange_event\"><code>RTCIceTransport</code>: <code>gatheringstatechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceTransport/selectedcandidatepairchange_event\"><code>RTCIceTransport</code>: <code>selectedcandidatepairchange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCIceTransport/statechange_event\"><code>RTCIceTransport</code>: <code>statechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/connectionstatechange_event\"><code>RTCPeerConnection</code>: <code>connectionstatechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/datachannel_event\"><code>RTCPeerConnection</code>: <code>datachannel</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event\"><code>RTCPeerConnection</code>: <code>icecandidate</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidateerror_event\"><code>RTCPeerConnection</code>: <code>icecandidateerror</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/iceconnectionstatechange_event\"><code>RTCPeerConnection</code>: <code>iceconnectionstatechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/icegatheringstatechange_event\"><code>RTCPeerConnection</code>: <code>icegatheringstatechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/negotiationneeded_event\"><code>RTCPeerConnection</code>: <code>negotiationneeded</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/signalingstatechange_event\"><code>RTCPeerConnection</code>: <code>signalingstatechange</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCPeerConnection/track_event\"><code>RTCPeerConnection</code>: <code>track</code></a></li><li><a href=\"/en-US/docs/Web/API/RTCSctpTransport/error_event\"><code>RTCSctpTransport</code>: <code>error</code></a></li></ol></details></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>In order to more fully support audio/video conferencing, <a href=\"/en-US/docs/Web/API/WebRTC_API\">WebRTC</a> supports sending <a href=\"/en-US/docs/Glossary/DTMF\">DTMF</a> to the remote peer on an <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a>. This article offers a brief high-level overview of how DTMF works over WebRTC, then provides a guide for everyday developers about how to send DTMF over an <code>RTCPeerConnection</code>. The DTMF system is often referred to as \"touch tone,\" after an old trade name for the system.</p>\n<p>WebRTC doesn't send DTMF codes as audio data. Instead, they're sent out-of-band, as RTP payloads. Note, however, that although it's possible to <em>send</em> DTMF using WebRTC, there is currently no way to detect or receive <em>incoming</em> DTMF. WebRTC currently ignores these payloads; this is because WebRTC's DTMF support is primarily intended for use with legacy telephone services that rely on DTMF tones to perform tasks such as:</p>\n<ul>\n  <li>Teleconferencing systems</li>\n  <li>Menu systems</li>\n  <li>Voicemail systems</li>\n  <li>Entry of credit card or other payment information</li>\n  <li>Passcode entry</li>\n</ul>\n<div class=\"notecard note\" id=\"sect1\">\n  <p><strong>Note:</strong> While the DTMF is not sent to the remote peer as audio, browsers may choose to play the corresponding tone to the local user as part of their user experience, since users are typically used to hearing their phone play the tones audibly.</p>\n</div>"}},{"type":"prose","value":{"id":"sending_dtmf_on_an_rtcpeerconnection","title":"Sending DTMF on an RTCPeerConnection","isH3":false,"content":"<p>A given <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a> can have multiple media tracks sent or received on it. When you wish to transmit DTMF signals, you first need to decide which track to send them on, since DTMF is sent as a series of out-of-band payloads on the <a href=\"/en-US/docs/Web/API/RTCRtpSender\"><code>RTCRtpSender</code></a> responsible for transmitting that track's data to the other peer.</p>\n<p>Once the track is selected, you can obtain from its <code>RTCRtpSender</code> the <a href=\"/en-US/docs/Web/API/RTCDTMFSender\"><code>RTCDTMFSender</code></a> object you'll use for sending DTMF. From there, you can call <a href=\"/en-US/docs/Web/API/RTCDTMFSender/insertDTMF\"><code>RTCDTMFSender.insertDTMF()</code></a> to enqueue DTMF signals to be sent on the track to the other peer. The <code>RTCRtpSender</code> will then send the tones to the other peer as packets alongside the track's audio data.</p>\n<p>Each time a tone is sent, the <code>RTCPeerConnection</code> receives a <a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\"><code>tonechange</code></a> event with a <a href=\"/en-US/docs/Web/API/RTCDTMFToneChangeEvent/tone\" title=\"tone\"><code>tone</code></a> property specifying which tone finished playing, which is an opportunity to update interface elements, for example. When the tone buffer is empty, indicating that all the tones have been sent, a <code>tonechange</code> event with its <code>tone</code> property set to \"\" (an empty string) is delivered to the connection object.</p>\n<p>If you'd like to know more about how this works, read <a href=\"https://datatracker.ietf.org/doc/html/rfc3550\" class=\"external\" target=\"_blank\">RFC 3550: RTP: A Transport Protocol for Real-Time Applications</a> and <a href=\"https://datatracker.ietf.org/doc/html/rfc4733\" class=\"external\" target=\"_blank\">RFC 4733: RTP Payload for DTMF Digits, Telephony Tones, and Telephony Signals</a>. The details of how DTMF payloads are handled on RTP are beyond the scope of this article. Instead, we'll focus on how to use DTMF within the context of an <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a> by studying how an example works.</p>"}},{"type":"prose","value":{"id":"simple_example","title":"Simple example","isH3":false,"content":"<p>This simple example constructs two <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a>s, establishes a connection between them, then waits for the user to click a \"Dial\" button. When the button is clicked, a DTMF string is sent over the connection using <a href=\"/en-US/docs/Web/API/RTCDTMFSender/insertDTMF\"><code>RTCDTMFSender.insertDTMF()</code></a>. Once the tones finish transmitting, the connection is closed.</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> This example is obviously somewhat contrived, since normally the two <code>RTCPeerConnection</code> objects would exist on different devices, and signaling would be done over the network instead of it all being linked up inline as it is here.</p>\n</div>"}},{"type":"prose","value":{"id":"html","title":"HTML","isH3":true,"content":"<p>The HTML for this example is very basic; there are only three elements of importance:</p>\n<ul>\n  <li>An <a href=\"/en-US/docs/Web/HTML/Element/audio\"><code>&lt;audio&gt;</code></a> element to play the audio received by the <code>RTCPeerConnection</code> being \"called.\"</li>\n  <li>A <a href=\"/en-US/docs/Web/HTML/Element/button\"><code>&lt;button&gt;</code></a> element to trigger creating and connecting the two <code>RTCPeerConnection</code> objects, then sending the DTMF tones.</li>\n  <li>A <a href=\"/en-US/docs/Web/HTML/Element/div\"><code>&lt;div&gt;</code></a> to receive and display log text to show status information.</li>\n</ul>\n<div class=\"code-example\"><pre class=\"brush: html notranslate\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n  This example demonstrates the use of DTMF in WebRTC. Note that this example is\n  \"cheating\" by generating both peers in one code stream, rather than having\n  each be a truly separate entity.\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>audio</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>audio<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">autoplay</span> <span class=\"token attr-name\">controls</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>audio</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dial<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dial<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Dial<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>log<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"javascript","title":"JavaScript","isH3":true,"content":"<p>Let's take a look at the JavaScript code next. Keep in mind that the process of establishing the connection is somewhat contrived here; you normally don't build both ends of the connection in the same document.</p>\n<h4 id=\"global_variables\">Global variables</h4>\n<p>First, we establish global variables.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">let</span> dialString <span class=\"token operator\">=</span> <span class=\"token string\">\"12024561111\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> callerPC <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> receiverPC <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> dtmfSender <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> hasAddTrack <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> mediaConstraints <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">audio</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">video</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> offerOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">offerToReceiveAudio</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">offerToReceiveVideo</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> dialButton <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> logElement <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>These are, in order:</p>\n<dl>\n  <dt id=\"dialstring\"><code>dialString</code></dt>\n  <dd>\n    <p>The DTMF string the caller will send when the \"Dial\" button is clicked.</p>\n  </dd>\n  <dt id=\"callerpc\"><code>callerPC</code> and <code>receiverPC</code></dt>\n  <dd>\n    <p>The <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a> objects representing the caller and the receiver, respectively. These will be initialized when the call starts up, in our <code>connectAndDial()</code> function, as shown in <a href=\"#starting_the_connection_process\">Starting the connection process</a> below.</p>\n  </dd>\n  <dt id=\"dtmfsender\"><code>dtmfSender</code></dt>\n  <dd>\n    <p>The <a href=\"/en-US/docs/Web/API/RTCDTMFSender\"><code>RTCDTMFSender</code></a> object for the connection. This will be obtained while setting up the connection, in the <code>gotStream()</code> function shown in <a href=\"#adding_the_audio_to_the_connection\">Adding the audio to the connection</a>.</p>\n  </dd>\n  <dt id=\"hasaddtrack\"><code>hasAddTrack</code></dt>\n  <dd>\n    <p>Because some browsers have not yet implemented <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addTrack\"><code>RTCPeerConnection.addTrack()</code></a>, therefore requiring the use of the obsolete <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addStream\" title=\"addStream()\"><code>addStream()</code></a> method, we use this Boolean to determine whether or not the user agent supports <code>addTrack()</code>; if it doesn't, we'll fall back to <code>addStream()</code>. This gets figured out in <code>connectAndDial()</code>, as shown in <a href=\"#starting_the_connection_process\">Starting the connection process</a>.</p>\n  </dd>\n  <dt id=\"mediaconstraints\"><code>mediaConstraints</code></dt>\n  <dd>\n    <p>An object conforming to the <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\"><code>MediaConstraints</code></a> dictionary specifying the constraints to use when starting the connection. We want an audio-only connection, so <code>video</code> is <code>false</code>, while <code>audio</code> is <code>true</code>.</p>\n  </dd>\n  <dt id=\"offeroptions\"><code>offerOptions</code></dt>\n  <dd>\n    <p>An object providing options to specify when calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/createOffer\"><code>RTCPeerConnection.createOffer()</code></a>. In this case, we state that we want to receive audio but not video.</p>\n  </dd>\n  <dt id=\"dialbutton\"><code>dialButton</code> and <code>logElement</code></dt>\n  <dd>\n    <p>These variables will be used to store references to the dial button and the <a href=\"/en-US/docs/Web/HTML/Element/div\"><code>&lt;div&gt;</code></a> into which logging information will be written. They'll get set up when the page is first loaded. See <a href=\"#initialization\">Initialization</a> below.</p>\n  </dd>\n</dl>\n<h4 id=\"initialization\">Initialization</h4>\n<p>When the page loads, we do some basic setup: we fetch references to the dial button and the log output box elements, and we use <a href=\"/en-US/docs/Web/API/EventTarget/addEventListener\" title=\"addEventListener()\"><code>addEventListener()</code></a> to add an event listener to the dial button so that clicking it calls the <code>connectAndDial()</code> function to begin the connection process.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"load\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  logElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".log\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  dialButton <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#dial\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  dialButton<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> connectAndDial<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h4 id=\"starting_the_connection_process\">Starting the connection process</h4>\n<p>When the dial button is clicked, <code>connectAndDial()</code> is called. This starts building the WebRTC connection in preparation for sending the DTMF codes.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">connectAndDial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  callerPC <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCPeerConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  hasAddTrack <span class=\"token operator\">=</span> callerPC<span class=\"token punctuation\">.</span>addTrack <span class=\"token operator\">!==</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n\n  callerPC<span class=\"token punctuation\">.</span>onicecandidate <span class=\"token operator\">=</span> handleCallerIceEvent<span class=\"token punctuation\">;</span>\n  callerPC<span class=\"token punctuation\">.</span>onnegotiationneeded <span class=\"token operator\">=</span> handleCallerNegotiationNeeded<span class=\"token punctuation\">;</span>\n  callerPC<span class=\"token punctuation\">.</span>oniceconnectionstatechange <span class=\"token operator\">=</span> handleCallerIceConnectionStateChange<span class=\"token punctuation\">;</span>\n  callerPC<span class=\"token punctuation\">.</span>onsignalingstatechange <span class=\"token operator\">=</span> handleCallerSignalingStateChangeEvent<span class=\"token punctuation\">;</span>\n  callerPC<span class=\"token punctuation\">.</span>onicegatheringstatechange <span class=\"token operator\">=</span> handleCallerGatheringStateChangeEvent<span class=\"token punctuation\">;</span>\n\n  receiverPC <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCPeerConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  receiverPC<span class=\"token punctuation\">.</span>onicecandidate <span class=\"token operator\">=</span> handleReceiverIceEvent<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hasAddTrack<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    receiverPC<span class=\"token punctuation\">.</span>ontrack <span class=\"token operator\">=</span> handleReceiverTrackEvent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    receiverPC<span class=\"token punctuation\">.</span>onaddstream <span class=\"token operator\">=</span> handleReceiverAddStreamEvent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  navigator<span class=\"token punctuation\">.</span>mediaDevices\n    <span class=\"token punctuation\">.</span><span class=\"token function\">getUserMedia</span><span class=\"token punctuation\">(</span>mediaConstraints<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>gotStream<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>After creating the <code>RTCPeerConnection</code> for the caller (<code>callerPC</code>), we look to see if it has an <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addTrack\" title=\"addTrack()\"><code>addTrack()</code></a> method. If it does, we set <code>hasAddTrack</code> to <code>true</code>; otherwise, we set it to <code>false</code>. This variable will let the example operate even on browsers not yet implementing the newer <code>addTrack()</code> method; we'll do so by falling back to the older <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addStream\" title=\"addStream()\"><code>addStream()</code></a> method.</p>\n<p>Next, the event handlers for the caller are established. We'll cover these in detail later.</p>\n<p>Then a second <code>RTCPeerConnection</code>, this one representing the receiving end of the call, is created and stored in <code>receiverPC</code>; its <code>onicecandidate</code> event handler is set up too.</p>\n<p>If <code>addTrack()</code> is supported, we set up the receiver's <code>ontrack</code> event handler; otherwise, we set up <code>onaddstream</code>. The <a href=\"/en-US/docs/Web/API/RTCPeerConnection/track_event\" title=\"track\"><code>track</code></a> and <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addstream_event\" title=\"addstream\"><code>addstream</code></a> events are sent when media is added to the connection.</p>\n<p>Finally, we call <a href=\"/en-US/docs/Web/API/MediaDevices/getUserMedia\" title=\"getUserMedia()\"><code>getUserMedia()</code></a> to obtain access to the caller's microphone. If successful, the function <code>gotStream()</code> is called, otherwise we log the error because calling has failed.</p>\n<h4 id=\"adding_the_audio_to_the_connection\">Adding the audio to the connection</h4>\n<p>As mentioned above, when the audio input from the microphone is obtained, <code>gotStream()</code> is called. Its job is to build the stream being sent to the receiver, so the actual process of starting to transmit can begin. It also gets access to the <code>RTCDTMFSender</code> we'll use to issue DTMF on the connection.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">gotStream</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">stream</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Got access to the microphone.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> audioTracks <span class=\"token operator\">=</span> stream<span class=\"token punctuation\">.</span><span class=\"token function\">getAudioTracks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hasAddTrack<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>audioTracks<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      audioTracks<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">track</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">addTrack</span><span class=\"token punctuation\">(</span>track<span class=\"token punctuation\">,</span> stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"Your browser doesn't support RTCPeerConnection.addTrack(). Falling \"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"back to the &lt;strong&gt;deprecated&lt;/strong&gt; addStream() method…\"</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">addStream</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>callerPC<span class=\"token punctuation\">.</span>getSenders<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    dtmfSender <span class=\"token operator\">=</span> callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">getSenders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>dtmf<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"Your browser doesn't support RTCPeerConnection.getSenders(), so \"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"falling back to use &lt;strong&gt;deprecated&lt;/strong&gt; createDTMFSender() \"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"instead.\"</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    dtmfSender <span class=\"token operator\">=</span> callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">createDTMFSender</span><span class=\"token punctuation\">(</span>audioTracks<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  dtmfSender<span class=\"token punctuation\">.</span>ontonechange <span class=\"token operator\">=</span> handleToneChangeEvent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>After setting <code>audioTracks</code> to be a list of the audio tracks on the stream from the user's microphone, it's time to add the media to the caller's <code>RTCPeerConnection</code>. If <code>addTrack()</code> is available on the <code>RTCPeerConnection</code>, we add each of the stream's audio tracks, one by one, to the connection using <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addTrack\"><code>RTCPeerConnection.addTrack()</code></a>. Otherwise we call <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addStream\"><code>RTCPeerConnection.addStream()</code></a> to add the stream to the call as a single unit.</p>\n<p>Next we look to see if the <a href=\"/en-US/docs/Web/API/RTCPeerConnection/getSenders\"><code>RTCPeerConnection.getSenders()</code></a> method is implemented. If it is, we call it on <code>callerPC</code> and get the first entry in the returned list of senders; this is the <a href=\"/en-US/docs/Web/API/RTCRtpSender\"><code>RTCRtpSender</code></a> responsible for transmitting data for the first audio track on the call (which is the track we'll send DTMF over). We then obtain the <code>RTCRtpSender</code>'s <a href=\"/en-US/docs/Web/API/RTCRtpSender/dtmf\" title=\"dtmf\"><code>dtmf</code></a> property, which is an <a href=\"/en-US/docs/Web/API/RTCDTMFSender\"><code>RTCDTMFSender</code></a> object that can send DTMF on the connection, from the caller to the receiver.</p>\n<p>If <code>getSenders()</code> isn't available, we instead call <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\"><code>RTCPeerConnection.createDTMFSender()</code></a> to get the <code>RTCDTMFSender</code> object. Although this method is obsolete, this example supports it as a fallback to let older browsers (and those not yet updated to support the current WebRTC DTMF API) run the example.</p>\n<p>Finally, we set the DTMF sender's <a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\" title=\"ontonechange\"><code>ontonechange</code></a> event handler so we get notified each time a DTMF tone finishes playing.</p>\n<p>You can find the log function at the bottom of the documentation.</p>\n<h4 id=\"when_a_tone_finishes_playing\">When a tone finishes playing</h4>\n<p>Each time a DTMF tone finishes playing, a <a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\"><code>tonechange</code></a> event is delivered to <code>callerPC</code>. The event listener for these is implemented as the <code>handleToneChangeEvent()</code> function.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleToneChangeEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>tone <span class=\"token operator\">!==</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Tone played: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>event<span class=\"token punctuation\">.</span>tone<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"All tones have played. Disconnecting.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">getLocalStreams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">stream</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      stream<span class=\"token punctuation\">.</span><span class=\"token function\">getTracks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">track</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        track<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    receiverPC<span class=\"token punctuation\">.</span><span class=\"token function\">getLocalStreams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">stream</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      stream<span class=\"token punctuation\">.</span><span class=\"token function\">getTracks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">track</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        track<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    audio<span class=\"token punctuation\">.</span><span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    audio<span class=\"token punctuation\">.</span>srcObject <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    receiverPC<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The <a href=\"/en-US/docs/Web/API/RTCDTMFSender/tonechange_event\"><code>tonechange</code></a> event is used both to indicate when an individual tone has played and when all tones have finished playing. The event's <a href=\"/en-US/docs/Web/API/RTCDTMFToneChangeEvent/tone\" title=\"tone\"><code>tone</code></a> property is a string indicating which tone just finished playing. If all tones have finished playing, <code>tone</code> is an empty string; when that's the case, <a href=\"/en-US/docs/Web/API/RTCDTMFSender/toneBuffer\"><code>RTCDTMFSender.toneBuffer</code></a> is empty.</p>\n<p>In this example, we log to the screen which tone just finished playing. In a more advanced application, you might update the user interface, for example, to indicate which note is currently playing.</p>\n<p>On the other hand, if the tone buffer is empty, our example is designed to disconnect the call. This is done by stopping each stream on both the caller and the receiver by iterating over each <code>RTCPeerConnection</code>'s track list (as returned by its <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\"><code>getTracks()</code></a> method) and calling each track's <a href=\"/en-US/docs/Web/API/MediaStreamTrack/stop\" title=\"stop()\"><code>stop()</code></a> method.</p>\n<p>Once both the caller's and the receiver's media tracks are all stopped, we pause the <a href=\"/en-US/docs/Web/HTML/Element/audio\"><code>&lt;audio&gt;</code></a> element and set its <a href=\"/en-US/docs/Web/API/HTMLMediaElement/srcObject\" title=\"srcObject\"><code>srcObject</code></a> to <code>null</code>. This detaches the audio stream from the <a href=\"/en-US/docs/Web/HTML/Element/audio\"><code>&lt;audio&gt;</code></a> element.</p>\n<p>Then, finally, each <code>RTCPeerConnection</code> is closed by calling its <a href=\"/en-US/docs/Web/API/RTCPeerConnection/close\" title=\"close()\"><code>close()</code></a> method.</p>\n<h4 id=\"adding_candidates_to_the_caller\">Adding candidates to the caller</h4>\n<p>When the caller's <code>RTCPeerConnection</code> ICE layer comes up with a new candidate to propose, it issues an <a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event\" title=\"icecandidate\"><code>icecandidate</code></a> event to <code>callerPC</code>. The <code>icecandidate</code> event handler's job is to transmit the candidate to the receiver. In our example, we are directly controlling both the caller and the receiver, so we can just directly add the candidate to the receiver by calling its <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addIceCandidate\" title=\"addIceCandidate()\"><code>addIceCandidate()</code></a> method. That's handled by <code>handleCallerIceEvent()</code>:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleCallerIceEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Adding candidate to receiver: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">.</span>candidate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    receiverPC\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addIceCandidate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCIceCandidate</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error adding candidate to receiver: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Caller is out of candidates.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>If the <a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event\" title=\"icecandidate\"><code>icecandidate</code></a> event has a non-<code>null</code> <code>candidate</code> property, we create a new <a href=\"/en-US/docs/Web/API/RTCIceCandidate\"><code>RTCIceCandidate</code></a> object from the <code>event.candidate</code> string and \"transmit\" it to the receiver by calling <code>receiverPC.addIceCandidate()</code>, providing the new <code>RTCIceCandidate</code> as its input. If <code>addIceCandidate()</code> fails, the <code>catch()</code> clause outputs the error to our log box.</p>\n<p>If <code>event.candidate</code> is <code>null</code>, that indicates that there are no more candidates available, and we log that information.</p>\n<h4 id=\"dialing_once_the_connection_is_open\">Dialing once the connection is open</h4>\n<p>Our design requires that when the connection is established, we immediately send the DTMF string. To accomplish that, we watch for the caller to receive an <a href=\"/en-US/docs/Web/API/RTCPeerConnection/iceconnectionstatechange_event\" title=\"iceconnectionstatechange\"><code>iceconnectionstatechange</code></a> event. This event is sent when one of a number of changes occurs to the state of the ICE connection process, including the successful establishment of a connection.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleCallerIceConnectionStateChange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Caller's connection state changed to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>callerPC<span class=\"token punctuation\">.</span>iceConnectionState<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>callerPC<span class=\"token punctuation\">.</span>iceConnectionState <span class=\"token operator\">===</span> <span class=\"token string\">\"connected\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Sending DTMF: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dialString<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    dtmfSender<span class=\"token punctuation\">.</span><span class=\"token function\">insertDTMF</span><span class=\"token punctuation\">(</span>dialString<span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The <code>iceconnectionstatechange</code> event doesn't actually include within it the new state, so we get the connection process's current state from <code>callerPC</code>'s <a href=\"/en-US/docs/Web/API/RTCPeerConnection/iceConnectionState\"><code>RTCPeerConnection.iceConnectionState</code></a> property. After logging the new state, we look to see if the state is <code>\"connected\"</code>. If so, we log the fact that we're about to send the DTMF, then we call <a href=\"/en-US/docs/Web/API/RTCDTMFSender/insertDTMF\" title=\"dtmf.insertDTMF()\"><code>dtmf.insertDTMF()</code></a> to send the DTMF on the same track as the audio data method on the <code>RTCDTMFSender</code> object we <a href=\"#adding_the_audio_to_the_connection\">previously stored</a> in <code>dtmfSender</code>.</p>\n<p>Our call to <code>insertDTMF()</code> specifies not only the DTMF to send (<code>dialString</code>), but also the length of each tone in milliseconds (400 ms) and the amount of time between tones (50 ms).</p>\n<h4 id=\"negotiating_the_connection\">Negotiating the connection</h4>\n<p>When the calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a> begins to receive media (after the microphone's stream is added to it), a <a href=\"/en-US/docs/Web/API/RTCPeerConnection/negotiationneeded_event\" title=\"negotiationneeded\"><code>negotiationneeded</code></a> event is delivered to the caller, letting it know that it's time to start negotiating the connection with the receiver. As previously mentioned, our example is simplified somewhat because we control both the caller and the receiver, so <code>handleCallerNegotiationNeeded()</code> is able to quickly construct the connection by chaining the required calls together for both the caller and receiver, as shown below.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleCallerNegotiationNeeded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Negotiating…\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  callerPC\n    <span class=\"token punctuation\">.</span><span class=\"token function\">createOffer</span><span class=\"token punctuation\">(</span>offerOptions<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">offer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Setting caller's local description: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>offer<span class=\"token punctuation\">.</span>sdp<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">setLocalDescription</span><span class=\"token punctuation\">(</span>offer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"Setting receiver's remote description to the same as caller's local\"</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> receiverPC<span class=\"token punctuation\">.</span><span class=\"token function\">setRemoteDescription</span><span class=\"token punctuation\">(</span>callerPC<span class=\"token punctuation\">.</span>localDescription<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Creating answer\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> receiverPC<span class=\"token punctuation\">.</span><span class=\"token function\">createAnswer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">answer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Setting receiver's local description to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>answer<span class=\"token punctuation\">.</span>sdp<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> receiverPC<span class=\"token punctuation\">.</span><span class=\"token function\">setLocalDescription</span><span class=\"token punctuation\">(</span>answer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Setting caller's remote description to match\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> callerPC<span class=\"token punctuation\">.</span><span class=\"token function\">setRemoteDescription</span><span class=\"token punctuation\">(</span>receiverPC<span class=\"token punctuation\">.</span>localDescription<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error during negotiation: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token punctuation\">.</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Since the various methods involved in negotiating the connection return <a href=\"/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\"><code>promise</code></a>s, we can chain them together like this:</p>\n<ol>\n  <li>Call <a href=\"/en-US/docs/Web/API/RTCPeerConnection/createOffer\" title=\"callerPC.createOffer()\"><code>callerPC.createOffer()</code></a> to get an offer.</li>\n  <li>Then take that offer and set the caller's local description to match by calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/setLocalDescription\" title=\"callerPC.setLocalDescription()\"><code>callerPC.setLocalDescription()</code></a>.</li>\n  <li>Then \"transmit\" the offer to the receiver by calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/setRemoteDescription\" title=\"receiverPC.setRemoteDescription()\"><code>receiverPC.setRemoteDescription()</code></a>. This configures the receiver so that it knows how the caller is configured.</li>\n  <li>Then the receiver creates an answer by calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/createAnswer\" title=\"receiverPC.createAnswer()\"><code>receiverPC.createAnswer()</code></a>.</li>\n  <li>Then the receiver sets its local description to match the newly-created answer by calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/setLocalDescription\" title=\"receiverPC.setLocalDescription()\"><code>receiverPC.setLocalDescription()</code></a>.</li>\n  <li>Then the answer is \"transmitted\" to the caller by calling <a href=\"/en-US/docs/Web/API/RTCPeerConnection/setRemoteDescription\" title=\"callerPC.setRemoteDescription()\"><code>callerPC.setRemoteDescription()</code></a>. This lets the caller know what the receiver's configuration is.</li>\n  <li>If at any time an error occurs, the <code>catch()</code> clause outputs an error message to the log.</li>\n</ol>\n<h4 id=\"tracking_other_state_changes\">Tracking other state changes</h4>\n<p>We can also watch for changes to the signaling state (by accepting <a href=\"/en-US/docs/Web/API/RTCPeerConnection/signalingstatechange_event\" title=\"signalingstatechange\"><code>signalingstatechange</code></a> events) and the ICE gathering state (by accepting <a href=\"/en-US/docs/Web/API/RTCPeerConnection/icegatheringstatechange_event\" title=\"icegatheringstatechange\"><code>icegatheringstatechange</code></a> events). We aren't using these for anything, so all we do is log them. We could have not set up these event listeners at all.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleCallerSignalingStateChangeEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Caller's signaling state changed to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>callerPC<span class=\"token punctuation\">.</span>signalingState<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleCallerGatheringStateChangeEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Caller's ICE gathering state changed to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>callerPC<span class=\"token punctuation\">.</span>iceGatheringState<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"adding_candidates_to_the_receiver\">Adding candidates to the receiver</h4>\n<p>When the receiver's <code>RTCPeerConnection</code> ICE layer comes up with a new candidate to propose, it issues an <a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event\" title=\"icecandidate\"><code>icecandidate</code></a> event to <code>receiverPC</code>. The <code>icecandidate</code> event handler's job is to transmit the candidate to the caller. In our example, we are directly controlling both the caller and the receiver, so we can just directly add the candidate to the caller by calling its <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addIceCandidate\" title=\"addIceCandidate()\"><code>addIceCandidate()</code></a> method. That's handled by <code>handleReceiverIceEvent()</code>.</p>\n<p>This code is analogous to the <code>icecandidate</code> event handler for the caller, seen in <a href=\"#adding_candidates_to_the_caller\">Adding candidates to the caller</a> above.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleReceiverIceEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Adding candidate to caller: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">.</span>candidate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    callerPC\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addIceCandidate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RTCIceCandidate</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>candidate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error adding candidate to caller: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Receiver is out of candidates.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>If the <a href=\"/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event\" title=\"icecandidate\"><code>icecandidate</code></a> event has a non-<code>null</code> <code>candidate</code> property, we create a new <a href=\"/en-US/docs/Web/API/RTCIceCandidate\"><code>RTCIceCandidate</code></a> object from the <code>event.candidate</code> string and deliver it to the caller by passing that into <code>callerPC.addIceCandidate()</code>. If <code>addIceCandidate()</code> fails, the <code>catch()</code> clause outputs the error to our log box.</p>\n<p>If <code>event.candidate</code> is <code>null</code>, that indicates that there are no more candidates available, and we log that information.</p>\n<h4 id=\"adding_media_to_the_receiver\">Adding media to the receiver</h4>\n<p>When the receiver begins to receive media, an event is delivered to the receiver's <a href=\"/en-US/docs/Web/API/RTCPeerConnection\"><code>RTCPeerConnection</code></a>, <code>receiverPC</code>. As explained in <a href=\"#starting_the_connection_process\">Starting the connection process</a>, the current WebRTC specification uses the <a href=\"/en-US/docs/Web/API/RTCPeerConnection/track_event\" title=\"track\"><code>track</code></a> event for this, but some browsers haven't been updated to support this yet, so we also need to handle the <a href=\"/en-US/docs/Web/API/RTCPeerConnection/addstream_event\" title=\"addstream\"><code>addstream</code></a> event. The <code>handleReceiverTrackEvent()</code> and <code>handleReceiverAddStreamEvent()</code> methods, shown below, handle these.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">handleReceiverTrackEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  audio<span class=\"token punctuation\">.</span>srcObject <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>streams<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleReceiverAddStreamEvent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  audio<span class=\"token punctuation\">.</span>srcObject <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>stream<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>The <code>track</code> event includes a <a href=\"/en-US/docs/Web/API/RTCTrackEvent/streams\" title=\"streams\"><code>streams</code></a> property containing an array of the streams the track is a member of (one track can be part of many streams). We take the first stream and attach it to the <a href=\"/en-US/docs/Web/HTML/Element/audio\"><code>&lt;audio&gt;</code></a> element.</p>\n<p>The <code>addstream</code> event includes a <a class=\"page-not-created\" title=\"The documentation about this has not yet been written; please consider contributing!\"><code>stream</code></a> property specifying a single stream added to the track. We attach it to the <code>&lt;audio&gt;</code> element.</p>\n<h4 id=\"logging\">Logging</h4>\n<p>A simple <code>log()</code> function is used throughout the code to append HTML to a <a href=\"/en-US/docs/Web/HTML/Element/div\"><code>&lt;div&gt;</code></a> box for displaying status and errors to the user.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  logElement<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>msg<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;br/&gt;</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"result","title":"Result","isH3":true,"content":"<p>You can try this example here. When you click the \"Dial\" button, you should see a series of logging messages output, then the dialing will begin. If your browser plays the tones audibly as part of its user experience, you should hear them as they're transmitted.</p><iframe class=\"sample-code-frame\" title=\"Simple example sample\" id=\"frame_simple_example\" width=\"600\" height=\"500\" src=\"https://yari-demos.prod.mdn.mozit.cloud/en-US/docs/Web/API/WebRTC_API/Using_DTMF/_sample_.simple_example.html\" allow=\"microphone\" loading=\"lazy\"></iframe>\n<p>Once transmission of the tones is complete, the connection is closed. You can click \"Dial\" again to reconnect and send the tones again.</p>"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"/en-US/docs/Web/API/WebRTC_API\">WebRTC API</a></li>\n  <li><a href=\"/en-US/docs/Web/API/WebRTC_API/Session_lifetime\">Lifetime of a WebRTC session</a></li>\n  <li><a href=\"/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling\">Signaling and video calling</a> (a tutorial and example which explains the signaling process in more detail)</li>\n  <li><a href=\"/en-US/docs/Web/API/WebRTC_API/Protocols\">Introduction to WebRTC protocols</a></li>\n</ul>"}}],"toc":[{"text":"Sending DTMF on an RTCPeerConnection","id":"sending_dtmf_on_an_rtcpeerconnection"},{"text":"Simple example","id":"simple_example"},{"text":"See also","id":"see_also"}],"summary":"In order to more fully support audio/video conferencing, WebRTC supports sending DTMF to the remote peer on an RTCPeerConnection. This article offers a brief high-level overview of how DTMF works over WebRTC, then provides a guide for everyday developers about how to send DTMF over an RTCPeerConnection. The DTMF system is often referred to as \"touch tone,\" after an old trade name for the system.","popularity":0,"modified":"2022-11-25T08:33:02.000Z","source":{"folder":"en-us/web/api/webrtc_api/using_dtmf","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/api/webrtc_api/using_dtmf/index.md","last_commit_url":"https://github.com/mdn/content/commit/3f7036e4dbe83e50c873c42a88a5a7d1d80a478e","filename":"index.md"},"short_title":"Using DTMF with WebRTC","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/WebRTC_API","title":"WebRTC API"},{"uri":"/en-US/docs/Web/API/WebRTC_API/Using_DTMF","title":"Using DTMF with WebRTC"}],"pageTitle":"Using DTMF with WebRTC - Web APIs | MDN","noIndexing":false}}</script>
<!-- Mirrored from developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Using_DTMF by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Feb 2023 04:49:48 GMT -->
</body></html>