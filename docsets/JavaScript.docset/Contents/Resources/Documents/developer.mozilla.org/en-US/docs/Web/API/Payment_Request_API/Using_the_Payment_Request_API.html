<html><!-- Mirrored from developer.mozilla.org/en-US/docs/Web/API/Payment_Request_API/Using_the_Payment_Request_API by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Feb 2023 04:47:45 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="../../../../../favicon-48x48.cbbd161b.png"><link rel="apple-touch-icon" href="../../../../../apple-touch-icon.6803c6f0.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="../../../../../manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="https://developer.mozilla.org/opensearch.xml" title="MDN Web Docs"><title>Using the Payment Request API</title><meta name="robots" content="index, follow"><meta name="description" content="The Payment Request API provides a browser-based method of connecting users and their preferred payment systems and platforms to merchants that they want to pay for goods and services. This article is a guide to making use of the Payment Request API, with examples and suggested best practices."><meta property="og:url" content="Using_the_Payment_Request_API.html"><meta property="og:title" content="Using the Payment Request API - Web APIs | MDN"><meta property="og:locale" content="en-US"><meta property="og:description" content="The Payment Request API provides a browser-based method of connecting users and their preferred payment systems and platforms to merchants that they want to pay for goods and services. This article is a guide to making use of the Payment Request API, with examples and suggested best practices."><meta property="og:image" content="../../../../../mdn-social-share.cd6c4a5a.png"><meta property="twitter:card" content="summary_large_image"><link rel="canonical" href="Using_the_Payment_Request_API.html"><style media="print">.article-actions-container,.document-toc-container,.language-menu,.main-menu-toggle,.mdn-cta-container,.on-github,.page-footer,.sidebar,.top-navigation-main,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><script src="../../../../../static/js/ga.js" defer=""></script><script defer="defer" src="../../../../../static/js/main.5c9d40d0.js"></script><link href="../../../../../static/css/main.7d378400.css" rel="stylesheet"></head><body><script>document.body.addEventListener("load",(t=>{t.target.classList.contains("interactive")&&t.target.setAttribute("data-readystate","complete")}),{capture:!0});const c={light:"#ffffff",dark:"#1b1b1b"};if(window&&document.documentElement)try{const t=window.localStorage.getItem("theme");t&&(document.documentElement.className=t,document.documentElement.style.backgroundColor=c[t])}catch(t){console.warn("Unable to read theme from localStorage",t)}</script><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#top-nav-search-input">Skip to search</a></li><li><a id="skip-select-language" href="#languages-switcher-button">Skip to select language</a></li></ul><div class="page-wrapper  category-api document-page"><div class="main-document-header-container"><header class="main-document-header-container top-navigation 
      
      "><div class="container "><div class="top-navigation-wrap"><a href="https://developer.mozilla.org/en-US/" class="logo" aria-label="MDN homepage"><svg id="mdn-docs-logo" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 694.9 104.4" style="enable-background:new 0 0 694.9 104.4" xml:space="preserve" role="img"><title>MDN Web Docs</title><style>.logo-m{fill:var(--text-link)}</style><g class="logo-m"><path d="M40.3 0 11.7 92.1H0L28.5 0h11.8zM50.7 0v92.1H40.3V0h10.4zM91 0 62.5 92.1H50.8L79.3 0H91zM101.4 0v92.1H91V0h10.4z"></path></g><path class="logo-m" d="M627.9 95.6h67v8.8h-67v-8.8z"></path><g style="fill:var(--text-primary)"><path d="M367 42h-4l-10.7 30.8h-5.5l-10.8-26h-.4l-10.5 26h-5.2L308.7 42h-3.8v-5.6H323V42h-6.5l6.8 20.4h.4l10.3-26h4.7l11.2 26h.5l5.7-20.3h-6.2v-5.6H367V42zM401.9 62c-.4 3.2-2 5.9-4.7 8.2-2.8 2.3-6.5 3.4-11.3 3.4-5.4 0-9.7-1.6-13.1-4.7-3.3-3.2-5-7.7-5-13.7 0-5.7 1.6-10.3 4.7-14s7.4-5.5 12.9-5.5c5.1 0 9.1 1.6 11.9 4.7s4.3 6.9 4.3 11.3c0 1.5-.2 3-.5 4.7h-25.6c.3 7.7 4 11.6 10.9 11.6 2.9 0 5.1-.7 6.5-2 1.5-1.4 2.5-3 3-4.9l6 .9zM394 51.3c.2-2.4-.4-4.7-1.8-6.9s-3.8-3.3-7-3.3c-3.1 0-5.3 1-6.9 3-1.5 2-2.5 4.4-2.8 7.2H394zM445 53.7c0 5-1.3 9.5-4 13.7s-6.9 6.2-12.7 6.2c-6 0-10.3-2.2-12.7-6.7-.1.4-.2 1.4-.4 2.9s-.3 2.5-.4 2.9h-7.3c.3-1.7.6-3.5.8-5.3.3-1.8.4-3.7.4-5.5V22.3h-6v-5.6H416v27c1.1-2.2 2.7-4.1 4.7-5.7 2-1.6 4.8-2.4 8.4-2.4 4.6 0 8.4 1.6 11.4 4.7 3 3.2 4.5 7.6 4.5 13.4zm-7.7.6c0-4.2-1-7.4-3-9.5-2-2.2-4.4-3.3-7.4-3.3-3.4 0-6 1.2-8 3.7-1.9 2.4-2.9 5-3 7.7V57c0 3 1 5.6 3 7.7s4.5 3.1 7.6 3.1c3.6 0 6.3-1.3 8.1-3.9 1.8-2.7 2.7-5.9 2.7-9.6zM506.5 72.8h-13.2v-7.2c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2 5.7 0 9.8 2.2 12.3 6.5V22.3h-8.6v-5.6h15.8v50.6h6v5.5zM493.2 56v-4.4c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zM546.3 54.6c0 5.6-1.8 10.2-5.3 13.7s-8.2 5.3-13.9 5.3-10.1-1.7-13.4-5.1c-3.3-3.4-5-7.9-5-13.5 0-5.3 1.6-9.9 4.7-13.7 3.2-3.8 7.9-5.7 14.2-5.7s11 1.9 14.1 5.7c3 3.7 4.6 8.1 4.6 13.3zm-7.7-.2c0-4-1-7.2-3-9.5s-4.8-3.5-8.2-3.5c-3.6 0-6.4 1.2-8.3 3.7s-2.9 5.6-2.9 9.5c0 3.7.9 6.8 2.8 9.4 1.9 2.6 4.6 3.9 8.3 3.9 3.6 0 6.4-1.3 8.4-3.8 1.9-2.6 2.9-5.8 2.9-9.7zM583.6 60.2c-.4 3.2-1.9 6.3-4.4 9.1-2.5 2.9-6.4 4.3-11.8 4.3-5.2 0-9.4-1.6-12.6-4.8-3.2-3.2-4.8-7.7-4.8-13.7 0-5.5 1.6-10.1 4.7-13.9 3.2-3.8 7.6-5.7 13.2-5.7 2.3 0 4.6.3 6.7.8 2.2.5 4.2 1.5 6.2 2.9l1.5 9.5-5.9.7-1.3-6.1c-2.1-1.2-4.5-1.8-7.2-1.8-3.5 0-6.1 1.2-7.7 3.7-1.7 2.5-2.5 5.7-2.5 9.6 0 4.1.9 7.3 2.7 9.5 1.8 2.3 4.4 3.4 7.8 3.4 5.2 0 8.2-2.9 9.2-8.8l6.2 1.3zM618.3 62.1c0 3.6-1.5 6.5-4.6 8.5s-7 3-11.7 3c-5.7 0-10.6-1.2-14.6-3.6l1.2-8.8 5.7.6-.2 4.7c1.1.5 2.3.9 3.6 1.1s2.6.3 3.9.3c2.4 0 4.5-.4 6.5-1.3 1.9-.9 2.9-2.2 2.9-4.1 0-1.8-.8-3.1-2.3-3.8s-3.5-1.3-5.8-1.7-4.6-.9-6.9-1.4c-2.3-.6-4.2-1.6-5.7-2.9-1.6-1.4-2.3-3.5-2.3-6.3 0-4.1 1.5-6.9 4.6-8.5s6.4-2.4 9.9-2.4c2.6 0 5 .3 7.2.9 2.2.6 4.3 1.4 6.1 2.4l.8 8.8-5.8.7-.8-5.7c-2.3-1-4.7-1.6-7.2-1.6-2.1 0-3.7.4-5.1 1.1-1.3.8-2 2-2 3.8 0 1.7.8 2.9 2.3 3.6 1.5.7 3.4 1.2 5.7 1.6 2.2.4 4.5.8 6.7 1.4 2.2.6 4.1 1.6 5.7 3 1.4 1.6 2.2 3.7 2.2 6.6zM197.6 73.2h-17.1v-5.5h3.8V51.9c0-3.7-.7-6.3-2.1-7.9-1.4-1.6-3.3-2.3-5.7-2.3-3.2 0-5.6 1.1-7.2 3.4s-2.4 4.6-2.5 6.9v15.6h6v5.5h-17.1v-5.5h3.8V51.9c0-3.8-.7-6.4-2.1-7.9-1.4-1.5-3.3-2.3-5.6-2.3-3.2 0-5.5 1.1-7.2 3.3-1.6 2.2-2.4 4.5-2.5 6.9v15.8h6.9v5.5h-20.2v-5.5h6V42.4h-6.1v-5.6h13.4v6.4c1.2-2.1 2.7-3.8 4.7-5.2 2-1.3 4.4-2 7.3-2s5.3.7 7.5 2.1c2.2 1.4 3.7 3.5 4.5 6.4 1.1-2.5 2.7-4.5 4.9-6.1s4.8-2.4 7.9-2.4c3.5 0 6.5 1.1 8.9 3.3s3.7 5.6 3.7 10.2v18.2h6.1v5.5zm42.5 0h-13.2V66c-1.2 2.2-2.8 4.1-4.9 5.6-2.1 1.6-4.8 2.4-8.3 2.4-4.8 0-8.7-1.6-11.6-4.9-2.9-3.2-4.3-7.7-4.3-13.3 0-5 1.3-9.6 4-13.7 2.6-4.1 6.9-6.2 12.8-6.2s9.8 2.2 12.3 6.5V22.7h-8.6v-5.6h15.8v50.6h6v5.5zm-13.3-16.8V52c-.1-3-1.2-5.5-3.2-7.3s-4.4-2.8-7.2-2.8c-3.6 0-6.3 1.3-8.2 3.9-1.9 2.6-2.8 5.8-2.8 9.6 0 4.1 1 7.3 3 9.5s4.5 3.3 7.4 3.3c3.2 0 5.8-1.3 7.8-3.8 2.1-2.6 3.1-5.3 3.2-8zm61.5 16.8H269v-5.5h6V51.9c0-3.7-.7-6.3-2.2-7.9-1.4-1.6-3.4-2.3-5.7-2.3-3.1 0-5.6 1-7.4 3s-2.8 4.4-2.9 7v15.9h6v5.5h-19.3v-5.5h6V42.4h-6.2v-5.6h13.6V43c2.6-4.6 6.8-6.9 12.7-6.9 3.6 0 6.7 1.1 9.2 3.3s3.7 5.6 3.7 10.2v18.2h6v5.4h-.2z"></path></g></svg></a><button title="Open main menu" type="button" class="button action has-icon main-menu-toggle" aria-haspopup="menu" aria-label="Open main menu" aria-expanded="false"><span class="button-wrap"><span class="icon icon-menu "></span><span class="visually-hidden">Open main menu</span></span></button></div><div class="top-navigation-main"><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button type="button" id="references-button" class="top-level-entry menu-toggle" aria-controls="references-menu" aria-expanded="false">References</button><a href="https://developer.mozilla.org/en-US/docs/Web" class="top-level-entry">References</a><ul id="references-menu" class="submenu references hidden inline-submenu-lg" aria-labelledby="references-button"><li class="apis-link-container mobile-only "><a href="https://developer.mozilla.org/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li><li class="html-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Structure of content on the web</p></div></a></li><li class="css-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Code used to describe document style</p></div></a></li><li class="javascript-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">General-purpose scripting language</p></div></a></li><li class="http-link-container "><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP" class="submenu-item "><div class="submenu-icon http"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTTP</div><p class="submenu-item-description">Protocol for transmitting web resources</p></div></a></li><li class="apis-link-container "><a href="../../API.html" class="submenu-item "><div class="submenu-icon apis"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web APIs</div><p class="submenu-item-description">Interfaces for building web applications</p></div></a></li><li class="apis-link-container "><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Extensions</div><p class="submenu-item-description">Developing extensions for web browsers</p></div></a></li><li class="apis-link-container desktop-only "><a href="https://developer.mozilla.org/en-US/docs/Web" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Web Technology</div><p class="submenu-item-description">Web technology reference for developers</p></div></a></li></ul></li><li class="top-level-entry-container"><button type="button" id="guides-button" class="top-level-entry menu-toggle" aria-controls="guides-menu" aria-expanded="false">Guides</button><a href="https://developer.mozilla.org/en-US/docs/Learn" class="top-level-entry">Guides</a><ul id="guides-menu" class="submenu guides hidden inline-submenu-lg" aria-labelledby="guides-button"><li class="apis-link-container mobile-only "><a href="https://developer.mozilla.org/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview / MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="apis-link-container desktop-only "><a href="https://developer.mozilla.org/en-US/docs/Learn" class="submenu-item "><div class="submenu-icon learn"></div><div class="submenu-content-container"><div class="submenu-item-heading">MDN Learning Area</div><p class="submenu-item-description">Learn web development</p></div></a></li><li class="html-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML" class="submenu-item "><div class="submenu-icon html"></div><div class="submenu-content-container"><div class="submenu-item-heading">HTML</div><p class="submenu-item-description">Learn to structure web content with HTML</p></div></a></li><li class="css-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/CSS" class="submenu-item "><div class="submenu-icon css"></div><div class="submenu-content-container"><div class="submenu-item-heading">CSS</div><p class="submenu-item-description">Learn to style content using CSS</p></div></a></li><li class="javascript-link-container "><a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript" class="submenu-item "><div class="submenu-icon javascript"></div><div class="submenu-content-container"><div class="submenu-item-heading">JavaScript</div><p class="submenu-item-description">Learn to run scripts in the browser</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Accessibility</div><p class="submenu-item-description">Learn to make the web accessible to all</p></div></a></li></ul></li><li class="top-level-entry-container"><button type="button" id="mdn-plus-button" class="top-level-entry menu-toggle" aria-controls="mdn-plus-menu" aria-expanded="false">MDN Plus</button><a href="https://developer.mozilla.org/en-US/plus" class="top-level-entry">MDN Plus</a><ul id="mdn-plus-menu" class="submenu mdn-plus hidden inline-submenu-lg" aria-labelledby="mdn-plus-button"><li class=" "><a href="https://developer.mozilla.org/en-US/plus" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Overview</div><p class="submenu-item-description">A customized MDN experience</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/updates" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Updates</div><p class="submenu-item-description">All browser compatibility updates at a glance</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/docs/features/overview" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">Documentation</div><p class="submenu-item-description">Learn how to use MDN Plus</p></div></a></li><li class=" "><a href="https://developer.mozilla.org/en-US/plus/docs/faq" class="submenu-item "><div class="submenu-icon"></div><div class="submenu-content-container"><div class="submenu-item-heading">FAQ</div><p class="submenu-item-description">Frequently asked questions about MDN Plus</p></div></a></li></ul></li></ul></nav><div class="header-search"><form action="https://developer.mozilla.org/en-US/search" role="search" aria-haspopup="listbox" aria-owns="top-nav-search-menu" aria-expanded="false" class="search-form search-widget" id="top-nav-search-form"><label id="top-nav-search-label" for="top-nav-search-input" class="visually-hidden">Search MDN</label><input id="top-nav-search-input" aria-autocomplete="list" aria-controls="top-nav-search-menu" aria-labelledby="top-nav-search-label" autocomplete="off" type="search" class="search-input-field" name="q" placeholder="   " required="" value=""><button type="button" class="button action has-icon clear-search-button"><span class="button-wrap"><span class="icon icon-cancel "></span><span class="visually-hidden">Clear search input</span></span></button><button type="submit" class="button action has-icon search-button"><span class="button-wrap"><span class="icon icon-search "></span><span class="visually-hidden">Search</span></span></button><div id="top-nav-search-menu" role="listbox" aria-labelledby="top-nav-search-label"></div></form></div><div class="theme-switcher-menu"><button type="button" class="button action has-icon theme-switcher-menu small" aria-haspopup="menu"><span class="button-wrap"><span class="icon icon-theme-os-default "></span>Theme</span></button></div><ul class="auth-container"><li><a href="https://developer.mozilla.org/users/fxa/login/authenticate/?next=%2Fen-US%2Fdocs%2FWeb%2FAPI%2FPayment_Request_API%2FUsing_the_Payment_Request_API" class="signin-link" rel="nofollow">Already a subscriber?</a></li><li><a class="button primary mdn-plus-subscribe-link" href="https://developer.mozilla.org/en-US/plus"><span class="button-wrap">Get MDN Plus</span></a></li></ul></div></div></header><div class="article-actions-container"><div class="container"><button type="button" class="button action has-icon sidebar-button" aria-label="Expand sidebar" aria-expanded="false" aria-controls="sidebar-quicklinks"><span class="button-wrap"><span class="icon icon-sidebar "></span></span></button><nav class="breadcrumbs-container" aria-label="Breadcrumb"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="https://developer.mozilla.org/en-US/docs/Web"><span property="name">References</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="../../API.html"><span property="name">Web APIs</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="../Payment_Request_API.html"><span property="name">Payment Request API</span></a><meta property="position" content="3"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="Using_the_Payment_Request_API.html"><span property="name">Using the Payment Request API</span></a><meta property="position" content="4"></li></ol></nav></div></div></div><div class="main-wrapper"><aside id="sidebar-quicklinks" class="sidebar"><button type="button" class="button action backdrop" aria-label="Collapse sidebar"><span class="button-wrap"></span></button><nav aria-label="Related Topics" class="sidebar-inner"><div class="in-nav-toc"><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#the_basics_of_making_a_payment">The basics of making a payment</a></li><li class="document-toc-item "><a class="document-toc-link" href="#detecting_availability_of_the_payment_request_api">Detecting availability of the Payment Request API</a></li><li class="document-toc-item "><a class="document-toc-link" href="#checking_whether_users_can_make_payments">Checking whether users can make payments</a></li><li class="document-toc-item "><a class="document-toc-link" href="#recommending_a_payment_app_when_user_has_no_apps">Recommending a payment app when user has no apps</a></li><li class="document-toc-item "><a class="document-toc-link" href="#showing_additional_user_interface_after_successful_payments">Showing additional user interface after successful payments</a></li><li class="document-toc-item "><a class="document-toc-link" href="#pre-authorizing_transactions">Pre-authorizing transactions</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></div><div><ol><li><strong><a href="../Payment_Request_API.html">Payment Request API</a></strong></li><li class="toggle"><details open=""><summary>Guides</summary><ol><li><em><a href="Using_the_Payment_Request_API.html" aria-current="page">Using the Payment Request API</a></em></li><li><a href="Concepts.html">Payment processing concepts</a></li></ol></details></li><li class="toggle"><details open=""><summary>Interfaces</summary><ol><li><a href="../MerchantValidationEvent.html"><code>MerchantValidationEvent</code></a></li><li><a href="../PaymentAddress.html"><code>PaymentAddress</code></a></li><li><a href="../PaymentMethodChangeEvent.html"><code>PaymentMethodChangeEvent</code></a></li><li><a href="../PaymentRequest.html"><code>PaymentRequest</code></a></li><li><a href="../PaymentRequestUpdateEvent.html"><code>PaymentRequestUpdateEvent</code></a></li><li><a href="../PaymentResponse.html"><code>PaymentResponse</code></a></li></ol></details></li><li class="toggle"><details open=""><summary>Properties</summary><ol><li><a href="../HTMLIFrameElement/allowPaymentRequest.html"><code>HTMLIFrameElement.allowPaymentRequest</code></a></li></ol></details></li></ol></div></nav></aside><aside class="toc"><nav><div class="document-toc-container"><section class="document-toc"><header><h2 class="document-toc-heading">In this article</h2></header><ul class="document-toc-list"><li class="document-toc-item "><a class="document-toc-link" href="#the_basics_of_making_a_payment">The basics of making a payment</a></li><li class="document-toc-item "><a class="document-toc-link" href="#detecting_availability_of_the_payment_request_api">Detecting availability of the Payment Request API</a></li><li class="document-toc-item "><a class="document-toc-link" href="#checking_whether_users_can_make_payments">Checking whether users can make payments</a></li><li class="document-toc-item "><a class="document-toc-link" href="#recommending_a_payment_app_when_user_has_no_apps">Recommending a payment app when user has no apps</a></li><li class="document-toc-item "><a class="document-toc-link" href="#showing_additional_user_interface_after_successful_payments">Showing additional user interface after successful payments</a></li><li class="document-toc-item "><a class="document-toc-link" href="#pre-authorizing_transactions">Pre-authorizing transactions</a></li><li class="document-toc-item "><a class="document-toc-link" href="#see_also">See also</a></li></ul></section></div></nav></aside><main id="content" class="main-content  "><article class="main-page-content" lang="en-US"><h1>Using the Payment Request API</h1><div class="section-content"><div class="notecard secure" id="sect1"><p><strong>Secure context:</strong> This feature is available only in <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts">secure contexts</a> (HTTPS), in some or all <a href="#browser_compatibility">supporting browsers</a>.</p></div>
<p>The <a href="../Payment_Request_API.html">Payment Request API</a> provides a browser-based method of connecting users and their preferred payment systems and platforms to merchants that they want to pay for goods and services. This article is a guide to making use of the <a href="../Payment_Request_API.html">Payment Request API</a>, with examples and suggested best practices.</p></div><section aria-labelledby="the_basics_of_making_a_payment"><a class="dashAnchor" name="//apple_ref/Section/The%20basics%20of%20making%20a%20payment"></a><h2 id="the_basics_of_making_a_payment"><a href="#the_basics_of_making_a_payment">The basics of making a payment</a></h2><div class="section-content"><p>This section details the basics of using the Payment Request API to make a payment.</p>
<div class="notecard note" id="sect2">
  <p><strong>Note:</strong> The code snippets from this section are from our <a href="https://github.com/mdn/dom-examples/blob/main/payment-request/feature-detect-support.html" class="external" target="_blank">Feature detect support demo</a>.</p>
</div></div></section><section aria-labelledby="creating_a_new_payment_request_object"><h3 id="creating_a_new_payment_request_object"><a href="#creating_a_new_payment_request_object">Creating a new payment request object</a></h3><div class="section-content"><p>A payment request always starts with the creation of a new <a href="../PaymentRequest.html"><code>PaymentRequest</code></a> object — using the <a href="../PaymentRequest/PaymentRequest.html" title="PaymentRequest()"><code>PaymentRequest()</code></a> constructor. This takes two mandatory parameters and one option parameter:</p>
<ul>
  <li><code>methodData</code> — an object containing information concerning the payment provider, such as what payment methods are supported, etc.</li>
  <li><code>details</code> — an object containing information concerning the specific payment, such as the total payment amount, tax, shipping cost, etc.</li>
  <li><code>options</code> (optional) — an object containing additional options related to the payment.</li>
</ul>
<p>So for example, you could create a new <code>PaymentRequest</code> instance like so:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span><span class="token function">buildSupportedPaymentMethodData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                   <span class="token function">buildShoppingCartDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>The functions invoked inside the constructor return the required object parameters:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">function</span> <span class="token function">buildSupportedPaymentMethodData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Example supported payment methods:</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">supportedMethods</span><span class="token operator">:</span> <span class="token string">'https://example.com/pay'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">buildShoppingCartDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Hardcoded for demo purposes:</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'order-123'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">displayItems</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'Example item'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">currency</span><span class="token operator">:</span> <span class="token string">'USD'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'1.00'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'Total'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">currency</span><span class="token operator">:</span> <span class="token string">'USD'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'1.00'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div></section><section aria-labelledby="starting_the_payment_process"><h3 id="starting_the_payment_process"><a href="#starting_the_payment_process">Starting the payment process</a></h3><div class="section-content"><p>Once the <code>PaymentRequest</code> object has been created, you call the <a href="../PaymentRequest/show.html"><code>PaymentRequest.show()</code></a> method on it to initiate the payment request. This returns a promise that fulfills with a <a href="../PaymentResponse.html"><code>PaymentResponse</code></a> object if the payment is successful:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>request<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">paymentResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Here we would process the payment. For this demo, simulate immediate success:</span>
  paymentResponse<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// For demo purposes:</span>
      introPanel<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
      successPanel<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div>
<p>This object provides the developer with access to details they can use to complete the logical steps required after the payment completes, such as an email address to contact the customer, a shipping address for mailing goods out to them, etc. In the code above, you'll see that we've called the <a href="../PaymentResponse/complete.html"><code>PaymentResponse.complete()</code></a> method to signal that the interaction has finished — you'd use this to carry out finishing steps, like updating the user interface to tell the user the transaction is complete, etc.</p></div></section><section aria-labelledby="other_useful_payment_request_methods"><h3 id="other_useful_payment_request_methods"><a href="#other_useful_payment_request_methods">Other useful payment request methods</a></h3><div class="section-content"><p>There are some other useful payment request methods worth knowing about.</p>
<p><a href="../PaymentRequest/canMakePayment.html"><code>PaymentRequest.canMakePayment()</code></a> can be used to check whether the <code>PaymentRequest</code> object is capable of making a payment before you start the payment process. It returns a promise that fulfills with a boolean indicating whether it is or not, for example:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">// Dummy payment request to check whether payment can be made</span>
<span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span><span class="token function">buildSupportedPaymentMethodData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"Stub"</span><span class="token punctuation">,</span> <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">currency</span><span class="token operator">:</span> <span class="token string">"USD"</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">"0.01"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">canMakePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Real payment request</span>
      <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span>
        <span class="token function">buildSupportedPaymentMethodData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        checkoutObject<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      request<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">paymentResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Here we would process the payment.</span>
        paymentResponse<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// Finish handling payment</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p><a href="../PaymentRequest/abort.html"><code>PaymentRequest.abort()</code></a> can be used to abort the payment request if required.</p></div></section><section aria-labelledby="detecting_availability_of_the_payment_request_api"><a class="dashAnchor" name="//apple_ref/Section/Detecting%20availability%20of%20the%20Payment%20Request%20API"></a><h2 id="detecting_availability_of_the_payment_request_api"><a href="#detecting_availability_of_the_payment_request_api">Detecting availability of the Payment Request API</a></h2><div class="section-content"><p>You can effectively detect support for the Payment Request API by checking if the user's browser supports <a href="../PaymentRequest.html"><code>PaymentRequest</code></a>, i.e. <code>if (window.PaymentRequest)</code>.</p>
<p>In the following snippet, a merchant page performs this check, and if it returns <code>true</code> updates the checkout button to use <code>PaymentRequest</code> instead of legacy web forms.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> checkoutButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'checkout-button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>PaymentRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span>
    <span class="token function">buildSupportedPaymentMethodNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">buildShoppingCartDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  checkoutButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    request<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">paymentResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Handle successful payment</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Handle cancelled or failed payment. For example, redirect to</span>
      <span class="token comment">// the legacy web form checkout:</span>
      window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/legacy-web-form-checkout'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Every click on the checkout button should use a new instance of</span>
    <span class="token comment">// PaymentRequest object, because PaymentRequest.show() can be</span>
    <span class="token comment">// called only once per instance.</span>
    request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span>
      <span class="token function">buildSupportedPaymentMethodNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">buildShoppingCartDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="notecard note" id="sect3">
  <p><strong>Note:</strong> See our <a href="../../../../../../mdn.github.io/dom-examples/payment-request/feature-detect-support.html" class="external" target="_blank">Feature detect support demo</a> for the full code.</p>
</div></div></section><section aria-labelledby="checking_whether_users_can_make_payments"><a class="dashAnchor" name="//apple_ref/Section/Checking%20whether%20users%20can%20make%20payments"></a><h2 id="checking_whether_users_can_make_payments"><a href="#checking_whether_users_can_make_payments">Checking whether users can make payments</a></h2><div class="section-content"><p>Checking whether users can make payments is always useful. Here's a couple of related techniques.</p></div></section><section aria-labelledby="customizing_the_payment_button"><h3 id="customizing_the_payment_button"><a href="#customizing_the_payment_button">Customizing the payment button</a></h3><div class="section-content"><p>One useful technique to employ is customizing the payment request button depending on whether users can make payments.</p>
<p>In the following snippet we do just this — depending on whether the user can make a fast payment or needs to add payment credentials first, the title of the checkout button changes between "Fast Checkout with W3C" and "Setup W3C Checkout". In both cases, the checkout button calls <a href="../PaymentRequest/show.html"><code>PaymentRequest.show()</code></a>.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> checkoutButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'checkout-button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
checkoutButton<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"Loading…"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>PaymentRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span>
    <span class="token function">buildSupportedPaymentMethodNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">buildShoppingCartDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  request<span class="token punctuation">.</span><span class="token function">canMakePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">canMakeAFastPayment</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    checkoutButton<span class="token punctuation">.</span>textContent <span class="token operator">=</span> canMakeAFastPayment <span class="token operator">?</span> <span class="token string">"Fast Checkout with W3C"</span> <span class="token operator">:</span> <span class="token string">"Setup W3C Checkout"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// The user may have turned off the querying functionality in their</span>
    <span class="token comment">// privacy settings. The website does not know whether they can make</span>
    <span class="token comment">// a fast payment, so pick a generic title.</span>
    checkoutButton<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">"Checkout with W3C"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="notecard note" id="sect4">
  <p><strong>Note:</strong> See our <a href="../../../../../../mdn.github.io/dom-examples/payment-request/customize-button-can-make-payment.html" class="external" target="_blank">Customizing the payment button demo</a> for the full code.</p>
</div></div></section><section aria-labelledby="checking_before_all_prices_are_known"><h3 id="checking_before_all_prices_are_known"><a href="#checking_before_all_prices_are_known">Checking before all prices are known</a></h3><div class="section-content"><p>If the checkout flow needs to know whether <a href="../PaymentRequest/canMakePayment.html"><code>PaymentRequest.canMakePayment()</code></a> will return <code>true</code> even before all line items and their prices are known, you can instantiate <code>PaymentRequest</code> with dummy data and pre-query <code>.canMakePayment()</code>. If you call <code>.canMakePayment()</code> multiple times, keep in mind that the first parameter to the <code>PaymentRequest</code> constructor should contain the same method names and data.</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">// The page has loaded. Should the page use PaymentRequest?</span>
<span class="token comment">// If PaymentRequest fails, should the page fallback to manual</span>
<span class="token comment">// web form checkout?</span>
<span class="token keyword">const</span> supportedPaymentMethods <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token comment">/* supported methods */</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> shouldCallPaymentRequest <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fallbackToLegacyOnPaymentRequestFailure <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span>supportedPaymentMethods<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'Stub'</span><span class="token punctuation">,</span> <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">currency</span><span class="token operator">:</span> <span class="token string">'USD'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'0.01'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">canMakePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    shouldCallPaymentRequest <span class="token operator">=</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// The user may have turned off query ability in their privacy settings.</span>
    <span class="token comment">// Let's use PaymentRequest by default and fallback to legacy</span>
    <span class="token comment">// web form based checkout.</span>
    shouldCallPaymentRequest <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    fallbackToLegacyOnPaymentRequestFailure <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// User has clicked on the checkout button. We know</span>
<span class="token comment">// what's in the cart, but we don't have a `Checkout` object.</span>
<span class="token keyword">function</span> <span class="token function">onCheckoutButtonClicked</span><span class="token punctuation">(</span><span class="token parameter">lineItems</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">callServerToRetrieveCheckoutDetails</span><span class="token punctuation">(</span>lineItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// The server has constructed the `Checkout` object. Now we know</span>
<span class="token comment">// all of the prices and shipping options.</span>
<span class="token keyword">function</span> <span class="token function">onServerCheckoutDetailsRetrieved</span><span class="token punctuation">(</span><span class="token parameter">checkoutObject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldCallPaymentRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span>supportedPaymentMethods<span class="token punctuation">,</span> checkoutObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">paymentResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Post the results to the server and call `paymeResponse.complete()`.</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>fallbackToLegacyOnPaymentRequestFailure<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/legacy-web-form-checkout'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">showCheckoutErrorToUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/legacy-web-form-checkout'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="notecard note" id="sect5">
  <p><strong>Note:</strong> See our <a href="../../../../../../mdn.github.io/dom-examples/payment-request/check-user-can-make-payment.html" class="external" target="_blank">Checking user can make payments before prices are known demo</a> for the full code.</p>
</div></div></section><section aria-labelledby="recommending_a_payment_app_when_user_has_no_apps"><a class="dashAnchor" name="//apple_ref/Section/Recommending%20a%20payment%20app%20when%20user%20has%20no%20apps"></a><h2 id="recommending_a_payment_app_when_user_has_no_apps"><a href="#recommending_a_payment_app_when_user_has_no_apps">Recommending a payment app when user has no apps</a></h2><div class="section-content"><p>If you select to pay with the BobPay demo payment provider on this merchant page, it tries to call <code>PaymentRequest.show()</code>, while intercepting the <code>NOTSUPPORTEDERR</code> exception. If this payment method is not supported, it redirects to the signup page for BobPay.</p>
<p>The code looks something like this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>checkoutButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span><span class="token function">buildSupportedPaymentMethodData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">buildShoppingCartDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">paymentResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Here we would process the payment. For this demo, simulate immediate success:</span>
    paymentResponse<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// For demo purposes:</span>
        introPanel<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
        successPanel<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>code <span class="token operator">===</span> DOMException<span class="token punctuation">.</span><span class="token constant">NOT_SUPPORTED_ERR</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span>
        <span class="token string">'https://bobpay.xyz/#download'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Other kinds of errors; cancelled or failed payment. For demo purposes:</span>
      introPanel<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
      legacyPanel<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="notecard note" id="sect6">
  <p><strong>Note:</strong> See our <a href="../../../../../../mdn.github.io/dom-examples/payment-request/recommend-payment-app.html" class="external" target="_blank">Recommending a payment app when user has no apps demo</a> for the full code.</p>
</div></div></section><section aria-labelledby="showing_additional_user_interface_after_successful_payments"><a class="dashAnchor" name="//apple_ref/Section/Showing%20additional%20user%20interface%20after%20successful%20payments"></a><h2 id="showing_additional_user_interface_after_successful_payments"><a href="#showing_additional_user_interface_after_successful_payments">Showing additional user interface after successful payments</a></h2><div class="section-content"><p>If the merchant desires to collect additional information not part of the API (e.g., additional delivery instructions), the merchant can show a page with additional <code>&lt;input type="text"&gt;</code> fields after the checkout.</p>
<div class="code-example"><pre class="brush: js notranslate"><code>request<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">paymentResponse</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Process payment here.</span>
    <span class="token comment">// Close the UI:</span>
    paymentResponse<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Request additional shipping address details.</span>
      <span class="token keyword">const</span> additionalDetailsContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'additional-details-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      additionalDetailsContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
      window<span class="token punctuation">.</span><span class="token function">scrollto</span><span class="token punctuation">(</span>additionalDetailsContainer<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Handle error.</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle error.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="notecard note" id="sect7">
  <p><strong>Note:</strong> See our <a href="../../../../../../mdn.github.io/dom-examples/payment-request/show-additional-ui-after-payment.html" class="external" target="_blank">Show additional user interface after successful payment demo</a> for the full code.</p>
</div></div></section><section aria-labelledby="pre-authorizing_transactions"><a class="dashAnchor" name="//apple_ref/Section/Pre%2Dauthorizing%20transactions"></a><h2 id="pre-authorizing_transactions"><a href="#pre-authorizing_transactions">Pre-authorizing transactions</a></h2><div class="section-content"><p>Some use cases (e.g., paying for fuel at a service station) involve pre-authorization of payment. One way to do this is through a Payment Handler (see the <a href="https://w3c.github.io/payment-handler/" class="external" target="_blank">Payment Handler API</a>). At time of writing, that specification includes a <code>CanMakePayment</code> event that a Payment Handler could make use of to return authorization status.</p>
<p>The merchant code would look like this:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token keyword">const</span> paymentRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaymentRequest</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">supportedMethods</span><span class="token operator">:</span> <span class="token string">'https://example.com/preauth'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> details<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send `CanMakePayment` event to the payment handler.</span>
paymentRequest<span class="token punctuation">.</span><span class="token function">canMakePayment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// The payment handler has pre-authorized a transaction</span>
     <span class="token comment">// with some static amount, e.g., USD $1.00.</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Pre-authorization failed or payment handler not installed.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Unexpected error occurred.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>The payment handler would include the following code:</p>
<div class="code-example"><pre class="brush: js notranslate"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'canmakepayment'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Pre-authorize here.</span>
  <span class="token keyword">const</span> preAuthSuccess <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  evt<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>preAuthSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>This payment handler would need to live in a service worker at <code>https://example.com/preauth</code> scope.</p>
<div class="notecard note" id="sect8">
  <p><strong>Note:</strong> See our <a href="../../../../../../mdn.github.io/dom-examples/payment-request/pre-authorize-transaction.html" class="external" target="_blank">Pre-authorizing transactions demo</a> for the full code.</p>
</div></div></section><section aria-labelledby="see_also"><a class="dashAnchor" name="//apple_ref/Section/See%20also"></a><h2 id="see_also"><a href="#see_also">See also</a></h2><div class="section-content"><ul>
  <li><a href="https://googlechrome.github.io/samples/paymentrequest/" class="external" target="_blank">Google PaymentRequest Samples</a></li>
</ul></div></section><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a content problem with this page?</h3><ul><li>Edit the page <a href="https://github.com/mdn/content/edit/main/files/en-us/web/api/payment_request_api/using_the_payment_request_api/index.md" title="This will take you to GitHub, where you'll need to sign in first." target="_blank" rel="noopener noreferrer">on GitHub</a>.</li><li>Report the <a href="https://github.com/mdn/content/issues/new?template=page-report.yml&amp;mdn-url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FPayment_Request_API%2FUsing_the_Payment_Request_API&amp;metadata=%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EPage+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Fapi%2Fpayment_request_api%2Fusing_the_payment_request_api%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FPayment_Request_API%2FUsing_the_Payment_Request_API%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fmain%2Ffiles%2Fen-us%2Fweb%2Fapi%2Fpayment_request_api%2Fusing_the_payment_request_api%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2F20a58f1383da377a634b48902bff9b4fde9227c3%0A*+Document+last+modified%3A+2022-09-11T19%3A36%3A48.000Z%0A%0A%3C%2Fdetails%3E" title="This will take you to GitHub to file a new issue." target="_blank" rel="noopener noreferrer">content issue</a>.</li><li>View the source <a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/payment_request_api/using_the_payment_request_api/index.md?plain=1" title="Folder: en-us/web/api/payment_request_api/using_the_payment_request_api (Opens in a new tab)" target="_blank" rel="noopener noreferrer">on GitHub</a>.</li></ul>Want to get more involved? Learn<!-- --> <a href="https://github.com/mdn/content/blob/main/CONTRIBUTING.md" title="This will take you to our contribution guidelines on GitHub." target="_blank" rel="noopener noreferrer">how to contribute</a>.</div><p class="last-modified-date">This page was last modified on<!-- --> <time datetime="2022-09-11T19:36:48.000Z">Sep 11, 2022</time> by<!-- --> <a href="Using_the_Payment_Request_API/contributors.txt">MDN contributors</a>.</p></div></aside></article></main></div><footer id="nav-footer" class="page-footer"><div><a href="http://developer.mozilla.org/en-US/docs/Web/API/Payment_Request_API/Using_the_Payment_Request_API">Using the Payment Request API</a> by <a href="http://developer.mozilla.org/en-US/docs/Web/API/Payment_Request_API/Using_the_Payment_Request_API$history">Mozilla Contributors</a> is licensed under <a href="http://creativecommons.org/licenses/by-sa/2.5/">CC-BY-SA 2.5</a>.</div></footer></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"Using the Payment Request API","mdn_url":"/en-US/docs/Web/API/Payment_Request_API/Using_the_Payment_Request_API","locale":"en-US","native":"English (US)","sidebarHTML":"<ol><li><strong><a href=\"/en-US/docs/Web/API/Payment_Request_API\">Payment Request API</a></strong></li><li class=\"toggle\"><details open=\"\"><summary>Guides</summary><ol><li><em><a href=\"/en-US/docs/Web/API/Payment_Request_API/Using_the_Payment_Request_API\" aria-current=\"page\">Using the Payment Request API</a></em></li><li><a href=\"/en-US/docs/Web/API/Payment_Request_API/Concepts\">Payment processing concepts</a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Interfaces</summary><ol><li><a href=\"/en-US/docs/Web/API/MerchantValidationEvent\"><code>MerchantValidationEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/PaymentAddress\"><code>PaymentAddress</code></a></li><li><a href=\"/en-US/docs/Web/API/PaymentMethodChangeEvent\"><code>PaymentMethodChangeEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/PaymentRequest\"><code>PaymentRequest</code></a></li><li><a href=\"/en-US/docs/Web/API/PaymentRequestUpdateEvent\"><code>PaymentRequestUpdateEvent</code></a></li><li><a href=\"/en-US/docs/Web/API/PaymentResponse\"><code>PaymentResponse</code></a></li></ol></details></li><li class=\"toggle\"><details open=\"\"><summary>Properties</summary><ol><li><a href=\"/en-US/docs/Web/API/HTMLIFrameElement/allowPaymentRequest\"><code>HTMLIFrameElement.allowPaymentRequest</code></a></li></ol></details></li></ol>","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<div class=\"notecard secure\" id=\"sect1\"><p><strong>Secure context:</strong> This feature is available only in <a href=\"/en-US/docs/Web/Security/Secure_Contexts\">secure contexts</a> (HTTPS), in some or all <a href=\"#browser_compatibility\">supporting browsers</a>.</p></div>\n<p>The <a href=\"/en-US/docs/Web/API/Payment_Request_API\">Payment Request API</a> provides a browser-based method of connecting users and their preferred payment systems and platforms to merchants that they want to pay for goods and services. This article is a guide to making use of the <a href=\"/en-US/docs/Web/API/Payment_Request_API\">Payment Request API</a>, with examples and suggested best practices.</p>"}},{"type":"prose","value":{"id":"the_basics_of_making_a_payment","title":"The basics of making a payment","isH3":false,"content":"<p>This section details the basics of using the Payment Request API to make a payment.</p>\n<div class=\"notecard note\" id=\"sect2\">\n  <p><strong>Note:</strong> The code snippets from this section are from our <a href=\"https://github.com/mdn/dom-examples/blob/main/payment-request/feature-detect-support.html\" class=\"external\" target=\"_blank\">Feature detect support demo</a>.</p>\n</div>"}},{"type":"prose","value":{"id":"creating_a_new_payment_request_object","title":"Creating a new payment request object","isH3":true,"content":"<p>A payment request always starts with the creation of a new <a href=\"/en-US/docs/Web/API/PaymentRequest\"><code>PaymentRequest</code></a> object — using the <a href=\"/en-US/docs/Web/API/PaymentRequest/PaymentRequest\" title=\"PaymentRequest()\"><code>PaymentRequest()</code></a> constructor. This takes two mandatory parameters and one option parameter:</p>\n<ul>\n  <li><code>methodData</code> — an object containing information concerning the payment provider, such as what payment methods are supported, etc.</li>\n  <li><code>details</code> — an object containing information concerning the specific payment, such as the total payment amount, tax, shipping cost, etc.</li>\n  <li><code>options</code> (optional) — an object containing additional options related to the payment.</li>\n</ul>\n<p>So for example, you could create a new <code>PaymentRequest</code> instance like so:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span><span class=\"token function\">buildSupportedPaymentMethodData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                   <span class=\"token function\">buildShoppingCartDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The functions invoked inside the constructor return the required object parameters:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">buildSupportedPaymentMethodData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Example supported payment methods:</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">supportedMethods</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://example.com/pay'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">buildShoppingCartDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Hardcoded for demo purposes:</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">'order-123'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">displayItems</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">label</span><span class=\"token operator\">:</span> <span class=\"token string\">'Example item'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">'USD'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">'1.00'</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">total</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">label</span><span class=\"token operator\">:</span> <span class=\"token string\">'Total'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">'USD'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">'1.00'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>"}},{"type":"prose","value":{"id":"starting_the_payment_process","title":"Starting the payment process","isH3":true,"content":"<p>Once the <code>PaymentRequest</code> object has been created, you call the <a href=\"/en-US/docs/Web/API/PaymentRequest/show\"><code>PaymentRequest.show()</code></a> method on it to initiate the payment request. This returns a promise that fulfills with a <a href=\"/en-US/docs/Web/API/PaymentResponse\"><code>PaymentResponse</code></a> object if the payment is successful:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>request<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">paymentResponse</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Here we would process the payment. For this demo, simulate immediate success:</span>\n  paymentResponse<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'success'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// For demo purposes:</span>\n      introPanel<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">;</span>\n      successPanel<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'block'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>This object provides the developer with access to details they can use to complete the logical steps required after the payment completes, such as an email address to contact the customer, a shipping address for mailing goods out to them, etc. In the code above, you'll see that we've called the <a href=\"/en-US/docs/Web/API/PaymentResponse/complete\"><code>PaymentResponse.complete()</code></a> method to signal that the interaction has finished — you'd use this to carry out finishing steps, like updating the user interface to tell the user the transaction is complete, etc.</p>"}},{"type":"prose","value":{"id":"other_useful_payment_request_methods","title":"Other useful payment request methods","isH3":true,"content":"<p>There are some other useful payment request methods worth knowing about.</p>\n<p><a href=\"/en-US/docs/Web/API/PaymentRequest/canMakePayment\"><code>PaymentRequest.canMakePayment()</code></a> can be used to check whether the <code>PaymentRequest</code> object is capable of making a payment before you start the payment process. It returns a promise that fulfills with a boolean indicating whether it is or not, for example:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// Dummy payment request to check whether payment can be made</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span><span class=\"token function\">buildSupportedPaymentMethodData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">total</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">label</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Stub\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">\"USD\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.01\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">canMakePayment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Real payment request</span>\n      <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span>\n        <span class=\"token function\">buildSupportedPaymentMethodData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        checkoutObject<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      request<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">paymentResponse</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Here we would process the payment.</span>\n        paymentResponse<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// Finish handling payment</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><a href=\"/en-US/docs/Web/API/PaymentRequest/abort\"><code>PaymentRequest.abort()</code></a> can be used to abort the payment request if required.</p>"}},{"type":"prose","value":{"id":"detecting_availability_of_the_payment_request_api","title":"Detecting availability of the Payment Request API","isH3":false,"content":"<p>You can effectively detect support for the Payment Request API by checking if the user's browser supports <a href=\"/en-US/docs/Web/API/PaymentRequest\"><code>PaymentRequest</code></a>, i.e. <code>if (window.PaymentRequest)</code>.</p>\n<p>In the following snippet, a merchant page performs this check, and if it returns <code>true</code> updates the checkout button to use <code>PaymentRequest</code> instead of legacy web forms.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> checkoutButton <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'checkout-button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>PaymentRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">buildSupportedPaymentMethodNames</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">buildShoppingCartDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  checkoutButton<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    request<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">paymentResponse</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Handle successful payment</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Handle cancelled or failed payment. For example, redirect to</span>\n      <span class=\"token comment\">// the legacy web form checkout:</span>\n      window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token string\">'/legacy-web-form-checkout'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Every click on the checkout button should use a new instance of</span>\n    <span class=\"token comment\">// PaymentRequest object, because PaymentRequest.show() can be</span>\n    <span class=\"token comment\">// called only once per instance.</span>\n    request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">buildSupportedPaymentMethodNames</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">buildShoppingCartDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect3\">\n  <p><strong>Note:</strong> See our <a href=\"https://mdn.github.io/dom-examples/payment-request/feature-detect-support.html\" class=\"external\" target=\"_blank\">Feature detect support demo</a> for the full code.</p>\n</div>"}},{"type":"prose","value":{"id":"checking_whether_users_can_make_payments","title":"Checking whether users can make payments","isH3":false,"content":"<p>Checking whether users can make payments is always useful. Here's a couple of related techniques.</p>"}},{"type":"prose","value":{"id":"customizing_the_payment_button","title":"Customizing the payment button","isH3":true,"content":"<p>One useful technique to employ is customizing the payment request button depending on whether users can make payments.</p>\n<p>In the following snippet we do just this — depending on whether the user can make a fast payment or needs to add payment credentials first, the title of the checkout button changes between \"Fast Checkout with W3C\" and \"Setup W3C Checkout\". In both cases, the checkout button calls <a href=\"/en-US/docs/Web/API/PaymentRequest/show\"><code>PaymentRequest.show()</code></a>.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> checkoutButton <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'checkout-button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncheckoutButton<span class=\"token punctuation\">.</span>innerText <span class=\"token operator\">=</span> <span class=\"token string\">\"Loading…\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>PaymentRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">buildSupportedPaymentMethodNames</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">buildShoppingCartDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  request<span class=\"token punctuation\">.</span><span class=\"token function\">canMakePayment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">canMakeAFastPayment</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    checkoutButton<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> canMakeAFastPayment <span class=\"token operator\">?</span> <span class=\"token string\">\"Fast Checkout with W3C\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"Setup W3C Checkout\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// The user may have turned off the querying functionality in their</span>\n    <span class=\"token comment\">// privacy settings. The website does not know whether they can make</span>\n    <span class=\"token comment\">// a fast payment, so pick a generic title.</span>\n    checkoutButton<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">\"Checkout with W3C\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect4\">\n  <p><strong>Note:</strong> See our <a href=\"https://mdn.github.io/dom-examples/payment-request/customize-button-can-make-payment.html\" class=\"external\" target=\"_blank\">Customizing the payment button demo</a> for the full code.</p>\n</div>"}},{"type":"prose","value":{"id":"checking_before_all_prices_are_known","title":"Checking before all prices are known","isH3":true,"content":"<p>If the checkout flow needs to know whether <a href=\"/en-US/docs/Web/API/PaymentRequest/canMakePayment\"><code>PaymentRequest.canMakePayment()</code></a> will return <code>true</code> even before all line items and their prices are known, you can instantiate <code>PaymentRequest</code> with dummy data and pre-query <code>.canMakePayment()</code>. If you call <code>.canMakePayment()</code> multiple times, keep in mind that the first parameter to the <code>PaymentRequest</code> constructor should contain the same method names and data.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// The page has loaded. Should the page use PaymentRequest?</span>\n<span class=\"token comment\">// If PaymentRequest fails, should the page fallback to manual</span>\n<span class=\"token comment\">// web form checkout?</span>\n<span class=\"token keyword\">const</span> supportedPaymentMethods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">/* supported methods */</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> shouldCallPaymentRequest <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> fallbackToLegacyOnPaymentRequestFailure <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span>supportedPaymentMethods<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">total</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">label</span><span class=\"token operator\">:</span> <span class=\"token string\">'Stub'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">'USD'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">'0.01'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">canMakePayment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    shouldCallPaymentRequest <span class=\"token operator\">=</span> result<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// The user may have turned off query ability in their privacy settings.</span>\n    <span class=\"token comment\">// Let's use PaymentRequest by default and fallback to legacy</span>\n    <span class=\"token comment\">// web form based checkout.</span>\n    shouldCallPaymentRequest <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    fallbackToLegacyOnPaymentRequestFailure <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// User has clicked on the checkout button. We know</span>\n<span class=\"token comment\">// what's in the cart, but we don't have a `Checkout` object.</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">onCheckoutButtonClicked</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">lineItems</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">callServerToRetrieveCheckoutDetails</span><span class=\"token punctuation\">(</span>lineItems<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// The server has constructed the `Checkout` object. Now we know</span>\n<span class=\"token comment\">// all of the prices and shipping options.</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">onServerCheckoutDetailsRetrieved</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">checkoutObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>shouldCallPaymentRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span>supportedPaymentMethods<span class=\"token punctuation\">,</span> checkoutObject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    request<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">paymentResponse</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Post the results to the server and call `paymeResponse.complete()`.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fallbackToLegacyOnPaymentRequestFailure<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token string\">'/legacy-web-form-checkout'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">showCheckoutErrorToUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token string\">'/legacy-web-form-checkout'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect5\">\n  <p><strong>Note:</strong> See our <a href=\"https://mdn.github.io/dom-examples/payment-request/check-user-can-make-payment.html\" class=\"external\" target=\"_blank\">Checking user can make payments before prices are known demo</a> for the full code.</p>\n</div>"}},{"type":"prose","value":{"id":"recommending_a_payment_app_when_user_has_no_apps","title":"Recommending a payment app when user has no apps","isH3":false,"content":"<p>If you select to pay with the BobPay demo payment provider on this merchant page, it tries to call <code>PaymentRequest.show()</code>, while intercepting the <code>NOTSUPPORTEDERR</code> exception. If this payment method is not supported, it redirects to the signup page for BobPay.</p>\n<p>The code looks something like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>checkoutButton<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span><span class=\"token function\">buildSupportedPaymentMethodData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">buildShoppingCartDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    request<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">paymentResponse</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Here we would process the payment. For this demo, simulate immediate success:</span>\n    paymentResponse<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'success'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// For demo purposes:</span>\n        introPanel<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">;</span>\n        successPanel<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'block'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">.</span>code <span class=\"token operator\">===</span> DOMException<span class=\"token punctuation\">.</span><span class=\"token constant\">NOT_SUPPORTED_ERR</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span>\n        <span class=\"token string\">'https://bobpay.xyz/#download'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Other kinds of errors; cancelled or failed payment. For demo purposes:</span>\n      introPanel<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">;</span>\n      legacyPanel<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'block'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect6\">\n  <p><strong>Note:</strong> See our <a href=\"https://mdn.github.io/dom-examples/payment-request/recommend-payment-app.html\" class=\"external\" target=\"_blank\">Recommending a payment app when user has no apps demo</a> for the full code.</p>\n</div>"}},{"type":"prose","value":{"id":"showing_additional_user_interface_after_successful_payments","title":"Showing additional user interface after successful payments","isH3":false,"content":"<p>If the merchant desires to collect additional information not part of the API (e.g., additional delivery instructions), the merchant can show a page with additional <code>&lt;input type=\"text\"&gt;</code> fields after the checkout.</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>request<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">paymentResponse</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Process payment here.</span>\n    <span class=\"token comment\">// Close the UI:</span>\n    paymentResponse<span class=\"token punctuation\">.</span><span class=\"token function\">complete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'success'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Request additional shipping address details.</span>\n      <span class=\"token keyword\">const</span> additionalDetailsContainer <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'additional-details-container'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      additionalDetailsContainer<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'block'</span><span class=\"token punctuation\">;</span>\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">scrollto</span><span class=\"token punctuation\">(</span>additionalDetailsContainer<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Handle error.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Handle error.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"notecard note\" id=\"sect7\">\n  <p><strong>Note:</strong> See our <a href=\"https://mdn.github.io/dom-examples/payment-request/show-additional-ui-after-payment.html\" class=\"external\" target=\"_blank\">Show additional user interface after successful payment demo</a> for the full code.</p>\n</div>"}},{"type":"prose","value":{"id":"pre-authorizing_transactions","title":"Pre-authorizing transactions","isH3":false,"content":"<p>Some use cases (e.g., paying for fuel at a service station) involve pre-authorization of payment. One way to do this is through a Payment Handler (see the <a href=\"https://w3c.github.io/payment-handler/\" class=\"external\" target=\"_blank\">Payment Handler API</a>). At time of writing, that specification includes a <code>CanMakePayment</code> event that a Payment Handler could make use of to return authorization status.</p>\n<p>The merchant code would look like this:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token keyword\">const</span> paymentRequest <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PaymentRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">supportedMethods</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://example.com/preauth'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> details<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Send `CanMakePayment` event to the payment handler.</span>\npaymentRequest<span class=\"token punctuation\">.</span><span class=\"token function\">canMakePayment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token comment\">// The payment handler has pre-authorized a transaction</span>\n     <span class=\"token comment\">// with some static amount, e.g., USD $1.00.</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Pre-authorization failed or payment handler not installed.</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Unexpected error occurred.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The payment handler would include the following code:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canmakepayment'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">evt</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Pre-authorize here.</span>\n  <span class=\"token keyword\">const</span> preAuthSuccess <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  evt<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>preAuthSuccess<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>This payment handler would need to live in a service worker at <code>https://example.com/preauth</code> scope.</p>\n<div class=\"notecard note\" id=\"sect8\">\n  <p><strong>Note:</strong> See our <a href=\"https://mdn.github.io/dom-examples/payment-request/pre-authorize-transaction.html\" class=\"external\" target=\"_blank\">Pre-authorizing transactions demo</a> for the full code.</p>\n</div>"}},{"type":"prose","value":{"id":"see_also","title":"See also","isH3":false,"content":"<ul>\n  <li><a href=\"https://googlechrome.github.io/samples/paymentrequest/\" class=\"external\" target=\"_blank\">Google PaymentRequest Samples</a></li>\n</ul>"}}],"toc":[{"text":"The basics of making a payment","id":"the_basics_of_making_a_payment"},{"text":"Detecting availability of the Payment Request API","id":"detecting_availability_of_the_payment_request_api"},{"text":"Checking whether users can make payments","id":"checking_whether_users_can_make_payments"},{"text":"Recommending a payment app when user has no apps","id":"recommending_a_payment_app_when_user_has_no_apps"},{"text":"Showing additional user interface after successful payments","id":"showing_additional_user_interface_after_successful_payments"},{"text":"Pre-authorizing transactions","id":"pre-authorizing_transactions"},{"text":"See also","id":"see_also"}],"summary":"The Payment Request API provides a browser-based method of connecting users and their preferred payment systems and platforms to merchants that they want to pay for goods and services. This article is a guide to making use of the Payment Request API, with examples and suggested best practices.","popularity":0,"modified":"2022-09-11T19:36:48.000Z","source":{"folder":"en-us/web/api/payment_request_api/using_the_payment_request_api","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/api/payment_request_api/using_the_payment_request_api/index.md","last_commit_url":"https://github.com/mdn/content/commit/20a58f1383da377a634b48902bff9b4fde9227c3","filename":"index.md"},"short_title":"Using the Payment Request API","parents":[{"uri":"/en-US/docs/Web","title":"References"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/Payment_Request_API","title":"Payment Request API"},{"uri":"/en-US/docs/Web/API/Payment_Request_API/Using_the_Payment_Request_API","title":"Using the Payment Request API"}],"pageTitle":"Using the Payment Request API - Web APIs | MDN","noIndexing":false}}</script>
<!-- Mirrored from developer.mozilla.org/en-US/docs/Web/API/Payment_Request_API/Using_the_Payment_Request_API by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 Feb 2023 04:47:45 GMT -->
</body></html>